flowchart TD
    A[开始emitMir函数] --> B[记录日志: mir指令长度]
    B --> C[循环遍历每条mir指令]
    C --> D[将mir_index和code长度存入code_offset_mapping]
    D --> E[调用lowerMir生成lowered指令]
    E --> F[循环处理每条lowered_inst]
    F --> G[记录start_offset并编码指令]
    G --> H[处理关联的relocs]
    H --> I{当前reloc类型}
    I -->|inst| J[添加普通重定位]
    I -->|load_symbol_reloc| K[添加HI20和LO12_I重定位]
    I -->|load_tlv_reloc| L[添加TPREL系列重定位]
    I -->|call_extern_fn_reloc| M[添加CALL_PLT重定位]
    J --> H
    K --> H
    L --> H
    M --> H
    H --> N{还有未处理的reloc?}
    N -->|是| H
    N -->|否| O[检查lowered_inst是否为空]
    O -->|是| P{处理伪指令类型}
    O -->|否| F
    P -->|pseudo_dbg_prologue_end| Q[设置dwarf调试断点]
    P -->|pseudo_dbg_line_column| R[更新PC和行号]
    P -->|pseudo_dbg_epilogue_begin| S[设置dwarf调试断点]
    P -->|pseudo_dead| T[空操作]
    Q --> F
    R --> F
    S --> F
    T --> F
    C --> U[所有mir指令处理完毕?]
    U -->|否| C
    U -->|是| V[调用fixupRelocs修复重定位]
    V --> W[结束函数]
