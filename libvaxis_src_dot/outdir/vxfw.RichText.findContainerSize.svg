<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="905pt" height="798pt"
 viewBox="0.00 0.00 904.54 797.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 793.74)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-793.74 900.54,-793.74 900.54,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<ellipse fill="#ffa07a" stroke="black" cx="453.54" cy="-771.74" rx="29.5" ry="18"/>
<text text-anchor="middle" x="453.54" y="-768.04" font-family="Arial" font-size="14.00">开始</text>
</g>
<!-- init -->
<g id="node2" class="node">
<title>init</title>
<polygon fill="#d3d3d3" stroke="black" points="552.54,-716.74 354.54,-716.74 354.54,-663.74 552.54,-663.74 552.54,-716.74"/>
<text text-anchor="middle" x="453.54" y="-701.54" font-family="Arial" font-size="14.00">初始化</text>
<text text-anchor="middle" x="453.54" y="-686.54" font-family="Arial" font-size="14.00">row = 0</text>
<text text-anchor="middle" x="453.54" y="-671.54" font-family="Arial" font-size="14.00">max_width = iter.ctx.min.width</text>
</g>
<!-- start&#45;&gt;init -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init</title>
<path fill="none" stroke="black" d="M453.54,-753.49C453.54,-745.73 453.54,-736.25 453.54,-727.06"/>
<polygon fill="black" stroke="black" points="457.04,-726.92 453.54,-716.92 450.04,-726.92 457.04,-726.92"/>
</g>
<!-- check_softwrap -->
<g id="node3" class="node">
<title>check_softwrap</title>
<polygon fill="#d3d3d3" stroke="black" points="453.54,-626.74 326.01,-608.74 453.54,-590.74 581.06,-608.74 453.54,-626.74"/>
<text text-anchor="middle" x="453.54" y="-605.04" font-family="Arial" font-size="14.00">self.softwrap 为真？</text>
</g>
<!-- init&#45;&gt;check_softwrap -->
<g id="edge2" class="edge">
<title>init&#45;&gt;check_softwrap</title>
<path fill="none" stroke="black" d="M453.54,-663.65C453.54,-655.22 453.54,-645.82 453.54,-637.26"/>
<polygon fill="black" stroke="black" points="457.04,-637 453.54,-627 450.04,-637 457.04,-637"/>
</g>
<!-- softwrap_loop -->
<g id="node4" class="node">
<title>softwrap_loop</title>
<polygon fill="#d3d3d3" stroke="black" points="316.04,-539.74 167.04,-539.74 167.04,-501.74 316.04,-501.74 316.04,-539.74"/>
<text text-anchor="middle" x="241.54" y="-524.54" font-family="Arial" font-size="14.00">循环处理软换行</text>
<text text-anchor="middle" x="241.54" y="-509.54" font-family="Arial" font-size="14.00">while (iter.next()) |line|</text>
</g>
<!-- check_softwrap&#45;&gt;softwrap_loop -->
<g id="edge3" class="edge">
<title>check_softwrap&#45;&gt;softwrap_loop</title>
<path fill="none" stroke="black" d="M422.26,-595.05C388.99,-581.55 335.74,-559.95 295.64,-543.69"/>
<polygon fill="black" stroke="black" points="296.85,-540.4 286.27,-539.89 294.22,-546.89 296.85,-540.4"/>
<text text-anchor="middle" x="374.04" y="-561.54" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- hardwrap_loop -->
<g id="node8" class="node">
<title>hardwrap_loop</title>
<polygon fill="#d3d3d3" stroke="black" points="772.04,-539.74 559.04,-539.74 559.04,-501.74 772.04,-501.74 772.04,-539.74"/>
<text text-anchor="middle" x="665.54" y="-524.54" font-family="Arial" font-size="14.00">循环处理硬换行</text>
<text text-anchor="middle" x="665.54" y="-509.54" font-family="Arial" font-size="14.00">while (iter.nextHardBreak()) |line|</text>
</g>
<!-- check_softwrap&#45;&gt;hardwrap_loop -->
<g id="edge4" class="edge">
<title>check_softwrap&#45;&gt;hardwrap_loop</title>
<path fill="none" stroke="black" d="M484.82,-595.05C518.09,-581.55 571.34,-559.95 611.43,-543.69"/>
<polygon fill="black" stroke="black" points="612.85,-546.89 620.81,-539.89 610.22,-540.4 612.85,-546.89"/>
<text text-anchor="middle" x="580.04" y="-561.54" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- check_soft_height -->
<g id="node5" class="node">
<title>check_soft_height</title>
<polygon fill="#d3d3d3" stroke="black" points="241.54,-464.74 38.54,-426.74 241.54,-388.74 444.54,-426.74 241.54,-464.74"/>
<text text-anchor="middle" x="241.54" y="-430.54" font-family="Arial" font-size="14.00">iter.ctx.max.outsideHeight(row)</text>
<text text-anchor="middle" x="241.54" y="-415.54" font-family="Arial" font-size="14.00">超出最大高度？</text>
</g>
<!-- softwrap_loop&#45;&gt;check_soft_height -->
<g id="edge5" class="edge">
<title>softwrap_loop&#45;&gt;check_soft_height</title>
<path fill="none" stroke="black" d="M241.54,-501.56C241.54,-493.87 241.54,-484.52 241.54,-475.09"/>
<polygon fill="black" stroke="black" points="245.04,-474.9 241.54,-464.9 238.04,-474.9 245.04,-474.9"/>
</g>
<!-- update_soft_max -->
<g id="node6" class="node">
<title>update_soft_max</title>
<polygon fill="#d3d3d3" stroke="black" points="324.54,-322.74 48.54,-322.74 48.54,-284.74 324.54,-284.74 324.54,-322.74"/>
<text text-anchor="middle" x="186.54" y="-307.54" font-family="Arial" font-size="14.00">更新max_width</text>
<text text-anchor="middle" x="186.54" y="-292.54" font-family="Arial" font-size="14.00">max_width = @max(max_width, line.width)</text>
</g>
<!-- check_soft_height&#45;&gt;update_soft_max -->
<g id="edge6" class="edge">
<title>check_soft_height&#45;&gt;update_soft_max</title>
<path fill="none" stroke="black" d="M220.09,-392.63C215.96,-385.56 211.89,-378.02 208.54,-370.74 202.96,-358.6 198.09,-344.63 194.37,-332.68"/>
<polygon fill="black" stroke="black" points="197.62,-331.36 191.39,-322.79 190.92,-333.38 197.62,-331.36"/>
<text text-anchor="middle" x="216.04" y="-359.54" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- width_basis -->
<g id="node13" class="node">
<title>width_basis</title>
<polygon fill="#d3d3d3" stroke="black" points="512.54,-322.74 350.54,-322.74 350.54,-284.74 512.54,-284.74 512.54,-322.74"/>
<text text-anchor="middle" x="431.54" y="-307.54" font-family="Arial" font-size="14.00">计算 result_width</text>
<text text-anchor="middle" x="431.54" y="-292.54" font-family="Arial" font-size="14.00">switch (self.width_basis)</text>
</g>
<!-- check_soft_height&#45;&gt;width_basis -->
<g id="edge7" class="edge">
<title>check_soft_height&#45;&gt;width_basis</title>
<path fill="none" stroke="black" d="M286.57,-397.06C319.43,-376.14 363.44,-348.11 394.32,-328.44"/>
<polygon fill="black" stroke="black" points="396.5,-331.2 403.05,-322.88 392.74,-325.3 396.5,-331.2"/>
<text text-anchor="middle" x="356.04" y="-359.54" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- inc_row_soft -->
<g id="node7" class="node">
<title>inc_row_soft</title>
<polygon fill="#d3d3d3" stroke="black" points="79.54,-210.24 9.54,-210.24 9.54,-174.24 79.54,-174.24 79.54,-210.24"/>
<text text-anchor="middle" x="44.54" y="-188.54" font-family="Arial" font-size="14.00">row += 1</text>
</g>
<!-- update_soft_max&#45;&gt;inc_row_soft -->
<g id="edge8" class="edge">
<title>update_soft_max&#45;&gt;inc_row_soft</title>
<path fill="none" stroke="black" d="M163.09,-284.66C138.92,-266.02 101.15,-236.9 74.76,-216.54"/>
<polygon fill="black" stroke="black" points="76.67,-213.6 66.62,-210.27 72.4,-219.15 76.67,-213.6"/>
</g>
<!-- inc_row_soft&#45;&gt;softwrap_loop -->
<g id="edge9" class="edge">
<title>inc_row_soft&#45;&gt;softwrap_loop</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36.67,-210.44C16.68,-257.01 -30.4,-387.27 29.54,-464.74 45.47,-485.33 105.01,-499.63 156.95,-508.48"/>
<polygon fill="black" stroke="black" points="156.44,-511.94 166.88,-510.12 157.59,-505.03 156.44,-511.94"/>
</g>
<!-- check_hard_height -->
<g id="node9" class="node">
<title>check_hard_height</title>
<polygon fill="#d3d3d3" stroke="black" points="665.54,-464.74 462.54,-426.74 665.54,-388.74 868.54,-426.74 665.54,-464.74"/>
<text text-anchor="middle" x="665.54" y="-430.54" font-family="Arial" font-size="14.00">iter.ctx.max.outsideHeight(row)</text>
<text text-anchor="middle" x="665.54" y="-415.54" font-family="Arial" font-size="14.00">超出最大高度？</text>
</g>
<!-- hardwrap_loop&#45;&gt;check_hard_height -->
<g id="edge10" class="edge">
<title>hardwrap_loop&#45;&gt;check_hard_height</title>
<path fill="none" stroke="black" d="M665.54,-501.56C665.54,-493.87 665.54,-484.52 665.54,-475.09"/>
<polygon fill="black" stroke="black" points="669.04,-474.9 665.54,-464.9 662.04,-474.9 669.04,-474.9"/>
</g>
<!-- calc_hard_width -->
<g id="node10" class="node">
<title>calc_hard_width</title>
<polygon fill="#d3d3d3" stroke="black" points="779.54,-337.74 633.54,-337.74 633.54,-269.74 779.54,-269.74 779.54,-337.74"/>
<text text-anchor="middle" x="706.54" y="-322.54" font-family="Arial" font-size="14.00">计算行宽</text>
<text text-anchor="middle" x="706.54" y="-307.54" font-family="Arial" font-size="14.00">w = 0</text>
<text text-anchor="middle" x="706.54" y="-292.54" font-family="Arial" font-size="14.00">for (line) |cell|</text>
<text text-anchor="middle" x="706.54" y="-277.54" font-family="Arial" font-size="14.00"> &#160;w +|= cell.char.width</text>
</g>
<!-- check_hard_height&#45;&gt;calc_hard_width -->
<g id="edge11" class="edge">
<title>check_hard_height&#45;&gt;calc_hard_width</title>
<path fill="none" stroke="black" d="M677.4,-390.74C681.97,-377.24 687.25,-361.68 692.04,-347.52"/>
<polygon fill="black" stroke="black" points="695.38,-348.59 695.27,-338 688.75,-346.34 695.38,-348.59"/>
<text text-anchor="middle" x="695.04" y="-359.54" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- check_hard_height&#45;&gt;width_basis -->
<g id="edge12" class="edge">
<title>check_hard_height&#45;&gt;width_basis</title>
<path fill="none" stroke="black" d="M612.73,-398.43C571.3,-377.01 514.32,-347.54 475.38,-327.41"/>
<polygon fill="black" stroke="black" points="476.87,-324.24 466.38,-322.76 473.66,-330.46 476.87,-324.24"/>
<text text-anchor="middle" x="564.04" y="-359.54" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- update_hard_max -->
<g id="node11" class="node">
<title>update_hard_max</title>
<polygon fill="#d3d3d3" stroke="black" points="835.54,-211.24 605.54,-211.24 605.54,-173.24 835.54,-173.24 835.54,-211.24"/>
<text text-anchor="middle" x="720.54" y="-196.04" font-family="Arial" font-size="14.00">更新max_width</text>
<text text-anchor="middle" x="720.54" y="-181.04" font-family="Arial" font-size="14.00">max_width = @max(max_width, w)</text>
</g>
<!-- calc_hard_width&#45;&gt;update_hard_max -->
<g id="edge13" class="edge">
<title>calc_hard_width&#45;&gt;update_hard_max</title>
<path fill="none" stroke="black" d="M710.78,-269.59C712.75,-254.19 715.06,-236.08 716.94,-221.36"/>
<polygon fill="black" stroke="black" points="720.43,-221.69 718.23,-211.33 713.49,-220.8 720.43,-221.69"/>
</g>
<!-- inc_row_hard -->
<g id="node12" class="node">
<title>inc_row_hard</title>
<polygon fill="#d3d3d3" stroke="black" points="881.54,-127.74 811.54,-127.74 811.54,-91.74 881.54,-91.74 881.54,-127.74"/>
<text text-anchor="middle" x="846.54" y="-106.04" font-family="Arial" font-size="14.00">row += 1</text>
</g>
<!-- update_hard_max&#45;&gt;inc_row_hard -->
<g id="edge14" class="edge">
<title>update_hard_max&#45;&gt;inc_row_hard</title>
<path fill="none" stroke="black" d="M748.81,-173.17C767.19,-161.44 791.29,-146.04 810.96,-133.47"/>
<polygon fill="black" stroke="black" points="813.11,-136.25 819.65,-127.92 809.34,-130.35 813.11,-136.25"/>
</g>
<!-- inc_row_hard&#45;&gt;hardwrap_loop -->
<g id="edge15" class="edge">
<title>inc_row_hard&#45;&gt;hardwrap_loop</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M865.16,-128.02C879.37,-143.17 896.54,-166.56 896.54,-191.24 896.54,-427.74 896.54,-427.74 896.54,-427.74 896.54,-446.23 891.97,-453.19 877.54,-464.74 850.39,-486.48 815.57,-499.7 782.04,-507.72"/>
<polygon fill="black" stroke="black" points="781.14,-504.34 772.15,-509.95 782.68,-511.17 781.14,-504.34"/>
</g>
<!-- longest_line -->
<g id="node14" class="node">
<title>longest_line</title>
<polygon fill="#d3d3d3" stroke="black" points="580.04,-218.74 331.04,-218.74 331.04,-165.74 580.04,-165.74 580.04,-218.74"/>
<text text-anchor="middle" x="455.54" y="-203.54" font-family="Arial" font-size="14.00">取较小值</text>
<text text-anchor="middle" x="455.54" y="-188.54" font-family="Arial" font-size="14.00">result_width = @min(max, max_width)</text>
<text text-anchor="middle" x="455.54" y="-173.54" font-family="Arial" font-size="14.00">（若iter.ctx.max.width存在）</text>
</g>
<!-- width_basis&#45;&gt;longest_line -->
<g id="edge16" class="edge">
<title>width_basis&#45;&gt;longest_line</title>
<path fill="none" stroke="black" d="M435.5,-284.66C438.8,-269.59 443.61,-247.66 447.69,-229.06"/>
<polygon fill="black" stroke="black" points="451.14,-229.65 449.86,-219.13 444.3,-228.15 451.14,-229.65"/>
<text text-anchor="middle" x="484.54" y="-240.54" font-family="Arial" font-size="14.00">.longest_line</text>
</g>
<!-- parent_case -->
<g id="node15" class="node">
<title>parent_case</title>
<polygon fill="#d3d3d3" stroke="black" points="313.04,-211.24 104.04,-211.24 104.04,-173.24 313.04,-173.24 313.04,-211.24"/>
<text text-anchor="middle" x="208.54" y="-196.04" font-family="Arial" font-size="14.00">result_width = iter.ctx.max.width</text>
<text text-anchor="middle" x="208.54" y="-181.04" font-family="Arial" font-size="14.00">（断言非空）</text>
</g>
<!-- width_basis&#45;&gt;parent_case -->
<g id="edge17" class="edge">
<title>width_basis&#45;&gt;parent_case</title>
<path fill="none" stroke="black" d="M394.71,-284.66C356.3,-265.8 296,-236.19 254.49,-215.81"/>
<polygon fill="black" stroke="black" points="255.94,-212.61 245.42,-211.35 252.85,-218.9 255.94,-212.61"/>
<text text-anchor="middle" x="349.04" y="-240.54" font-family="Arial" font-size="14.00">.parent</text>
</g>
<!-- final_height -->
<g id="node16" class="node">
<title>final_height</title>
<polygon fill="#d3d3d3" stroke="black" points="459.04,-128.74 206.04,-128.74 206.04,-90.74 459.04,-90.74 459.04,-128.74"/>
<text text-anchor="middle" x="332.54" y="-113.54" font-family="Arial" font-size="14.00">确定最终高度</text>
<text text-anchor="middle" x="332.54" y="-98.54" font-family="Arial" font-size="14.00">height = @max(row, iter.ctx.min.height)</text>
</g>
<!-- longest_line&#45;&gt;final_height -->
<g id="edge18" class="edge">
<title>longest_line&#45;&gt;final_height</title>
<path fill="none" stroke="black" d="M416.28,-165.55C401,-155.55 383.6,-144.16 368.64,-134.37"/>
<polygon fill="black" stroke="black" points="370.43,-131.36 360.14,-128.81 366.59,-137.21 370.43,-131.36"/>
</g>
<!-- parent_case&#45;&gt;final_height -->
<g id="edge19" class="edge">
<title>parent_case&#45;&gt;final_height</title>
<path fill="none" stroke="black" d="M236.37,-173.17C254.08,-161.68 277.19,-146.67 296.33,-134.25"/>
<polygon fill="black" stroke="black" points="298.32,-137.13 304.8,-128.75 294.51,-131.26 298.32,-137.13"/>
</g>
<!-- return -->
<g id="node17" class="node">
<title>return</title>
<ellipse fill="#98fb98" stroke="black" cx="332.54" cy="-26.87" rx="77.15" ry="26.74"/>
<text text-anchor="middle" x="332.54" y="-30.67" font-family="Arial" font-size="14.00">返回 Size</text>
<text text-anchor="middle" x="332.54" y="-15.67" font-family="Arial" font-size="14.00">{ width, height }</text>
</g>
<!-- final_height&#45;&gt;return -->
<g id="edge20" class="edge">
<title>final_height&#45;&gt;return</title>
<path fill="none" stroke="black" d="M332.54,-90.39C332.54,-82.53 332.54,-73.07 332.54,-63.92"/>
<polygon fill="black" stroke="black" points="336.04,-63.81 332.54,-53.81 329.04,-63.81 336.04,-63.81"/>
</g>
</g>
</svg>
