graph TD
    Start[开始] --> A[处理output_mode和is_dyn_lib]
    A --> B{检查linker_export_table和import_table冲突}
    B -->|冲突| Error[返回error.ExportTableAndImportTableConflict]
    B -->|无冲突| C[初始化配置选项]
    C --> D[创建Compilation结构体]
    D --> E[设置缓存模式]
    E -->|incremental| F[初始化增量缓存目录]
    E -->|whole| G[准备全量缓存路径]
    F --> H[处理输出文件路径]
    G --> H
    H --> I[处理C源文件和资源文件]
    I --> J[添加C对象到工作队列]
    I --> K[添加Win32资源到队列]
    J --> L[处理平台特定依赖]
    K --> L
    L --> M{目标平台判断}
    M -->|Darwin| N[处理MachO相关]
    M -->|Musl| O[处理musl libc]
    M -->|GNU| P[处理glibc]
    M -->|WASI| Q[处理wasi-libc]
    M -->|MinGW| R[处理mingw库]
    M -->|其他| S[处理通用依赖]
    N --> T[生成任务队列]
    O --> T
    P --> T
    Q --> T
    R --> T
    S --> T
    T --> U[处理编译器运行时策略]
    U --> V[添加compiler_rt/ubsan_rt任务]
    V --> W[处理链接器依赖]
    W --> X[返回comp或错误]
    Error --> X
