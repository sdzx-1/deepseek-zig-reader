graph TD
    A[开始 airCtz] --> B[获取类型信息和操作数]
    B --> C{是否为向量类型?}
    C -->|是| D[报错: 未实现向量类型处理]
    C -->|否| E[处理源操作数]
    E --> F{源类型大小是否超过 BMI 支持?}
    F -->|是| G[处理大尺寸: 分解为多个块]
    G --> H[分配寄存器和帧地址]
    H --> I[初始化循环变量]
    I --> J[循环检查每个块]
    J --> K{当前块是否为0?}
    K -->|是| L[继续下一个块]
    K -->|否| M[找到非零块并计算位数]
    L --> J
    M --> N[合并结果并返回]
    F -->|否| O{是否支持BMI指令?}
    O -->|是| P[使用tzcnt指令优化]
    P --> Q[处理64位及以下或128位情况]
    Q --> R[是否需要掩码操作?]
    R -->|是| S[应用掩码后执行tzcnt]
    R -->|否| T[直接执行tzcnt]
    S --> U[返回结果]
    T --> U
    O -->|否| V[使用传统bsf指令]
    V --> W[处理特殊位宽和非2次幂情况]
    W --> X[使用条件移动优化结果]
    X --> U
    D --> Z[结束并报错]
    U --> Y[结束并返回结果]
    Y --> Z
