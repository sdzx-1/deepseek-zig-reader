graph TD
    A[开始cmdFetch] --> B[检查.fetch_command]
    B --> C[解析命令行参数]
    C --> D{参数处理}
    D --> |--help| E[输出帮助信息并退出]
    D --> |--global-cache-dir| F[设置全局缓存目录]
    D --> |--debug-hash| G[启用调试哈希]
    D --> |--save相关| H[设置保存模式]
    D --> |其他参数| I[报错退出]
    C --> J{是否有路径/URL参数?}
    J --> |否| K[报错退出]
    J --> |是| L[初始化线程池和HTTP客户端]
    L --> M[创建全局缓存目录]
    M --> N[初始化任务队列]
    N --> O[执行包获取操作]
    O --> P{获取成功?}
    P --> |失败| Q[收集错误信息并输出]
    Q --> R[退出代码1]
    P --> |成功| S[计算包哈希]
    S --> T{保存模式?}
    T --> |--no| U[输出哈希值并退出]
    T --> |--save/--save-exact| V[解析依赖名称]
    V --> W{是否存在同名依赖?}
    W --> |是| X[比较哈希和URL]
    X --> |相同| Y[提示已是最新并退出]
    X --> |不同| Z[替换现有依赖]
    W --> |否| AA[添加新依赖]
    Z --> AB[修改AST并写入文件]
    AA --> AB
    AB --> AC[成功退出]
