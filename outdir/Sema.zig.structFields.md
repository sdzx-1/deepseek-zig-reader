graph TD
    A[开始] --> B[获取pt, zcu, ip等上下文]
    B --> C[获取namespace_index和zir]
    C --> D[解析zir_index]
    D --> E{解析成功?}
    E -->|否| F[返回AnalysisFail错误]
    E -->|是| G[调用structZirInfo获取fields_len]
    G --> H{fields_len是否为0?}
    H -->|是| I[处理不同布局类型]
    I -->|packed| J[调用backingIntType]
    I -->|auto/extern| K[设置布局并返回]
    H -->|否| L[初始化block_scope]
    L --> M[定义Field结构并分配内存]
    M --> N[循环处理每个字段的标志位]
    N --> O[解析字段名、类型、对齐、初始化标志]
    O --> P{是否有类型体?}
    P -->|是| Q[记录类型体长度]
    P -->|否| R[记录类型引用]
    N --> S[处理对齐和初始化标志]
    S --> T[更新extra_index]
    N --> U{循环结束?}
    U -->|否| N
    U -->|是| V[第二次循环处理类型和对齐]
    V --> W[解析字段类型]
    W --> X{类型是否有效?}
    X -->|opaque/noreturn| Y[生成错误消息并返回]
    X -->|有效| Z[验证布局兼容性]
    Z -->|不兼容| AA[生成错误消息并返回]
    Z -->|兼容| AB[处理对齐信息]
    AB --> AC[更新字段对齐值]
    V --> AD{循环结束?}
    AD -->|否| V
    AD -->|是| AE[清除中间状态]
    AE --> AF[设置初始化标志]
    AF --> AG[刷新导出]
    AG --> AH[结束]
