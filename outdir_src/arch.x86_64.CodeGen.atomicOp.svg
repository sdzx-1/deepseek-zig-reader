<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: atomicOp Pages: 1 -->
<svg width="663pt" height="1120pt"
 viewBox="0.00 0.00 662.50 1120.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1116)">
<title>atomicOp</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1116 658.5,-1116 658.5,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_lock</title>
<polygon fill="none" stroke="black" points="8,-91 8,-478 178,-478 178,-91 8,-91"/>
<text text-anchor="middle" x="93" y="-462.8" font-family="Times,serif" font-size="14.00">LOCK策略</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_loop</title>
<polygon fill="none" stroke="black" points="186,-8 186,-478 374,-478 374,-8 186,-8"/>
<text text-anchor="middle" x="280" y="-462.8" font-family="Times,serif" font-size="14.00">LOOP策略</text>
</g>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="616,-1112 532,-1112 532,-1076 616,-1076 616,-1112"/>
<text text-anchor="middle" x="574" y="-1091.5" font-family="Courier,monospace" font-size="10.00">atomicOp开始</text>
</g>
<!-- lock_ptr -->
<g id="node2" class="node">
<title>lock_ptr</title>
<polygon fill="none" stroke="black" points="618,-1039 530,-1039 530,-1003 618,-1003 618,-1039"/>
<text text-anchor="middle" x="574" y="-1018.5" font-family="Courier,monospace" font-size="10.00">处理ptr_mcv锁</text>
</g>
<!-- start&#45;&gt;lock_ptr -->
<g id="edge1" class="edge">
<title>start&#45;&gt;lock_ptr</title>
<path fill="none" stroke="black" d="M574,-1075.81C574,-1067.79 574,-1058.05 574,-1049.07"/>
<polygon fill="black" stroke="black" points="577.5,-1049.03 574,-1039.03 570.5,-1049.03 577.5,-1049.03"/>
</g>
<!-- lock_val -->
<g id="node3" class="node">
<title>lock_val</title>
<polygon fill="none" stroke="black" points="571,-956 483,-956 483,-920 571,-920 571,-956"/>
<text text-anchor="middle" x="527" y="-935.5" font-family="Courier,monospace" font-size="10.00">处理val_mcv锁</text>
</g>
<!-- lock_ptr&#45;&gt;lock_val -->
<g id="edge2" class="edge">
<title>lock_ptr&#45;&gt;lock_val</title>
<path fill="none" stroke="black" d="M564.03,-1002.82C557.68,-991.87 549.32,-977.46 542.15,-965.11"/>
<polygon fill="black" stroke="black" points="545,-963.05 536.95,-956.15 538.94,-966.56 545,-963.05"/>
</g>
<!-- ptr_lock -->
<g id="node23" class="node">
<title>ptr_lock</title>
<polygon fill="none" stroke="black" points="654.5,-956 589.5,-956 589.5,-920 654.5,-920 654.5,-956"/>
<text text-anchor="middle" x="622" y="-935.5" font-family="Courier,monospace" font-size="10.00">ptr_lock</text>
</g>
<!-- lock_ptr&#45;&gt;ptr_lock -->
<g id="edge22" class="edge">
<title>lock_ptr&#45;&gt;ptr_lock</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M584.18,-1002.82C590.67,-991.87 599.21,-977.46 606.53,-965.11"/>
<polygon fill="black" stroke="black" points="609.75,-966.54 611.84,-956.15 603.73,-962.97 609.75,-966.54"/>
<text text-anchor="middle" x="625" y="-977" font-family="Courier,monospace" font-size="10.00">defer解锁</text>
</g>
<!-- calc_size -->
<g id="node4" class="node">
<title>calc_size</title>
<polygon fill="none" stroke="black" points="543,-873 377,-873 377,-837 543,-837 543,-873"/>
<text text-anchor="middle" x="460" y="-852.5" font-family="Courier,monospace" font-size="10.00">计算val_abi_size和mem_size</text>
</g>
<!-- lock_val&#45;&gt;calc_size -->
<g id="edge3" class="edge">
<title>lock_val&#45;&gt;calc_size</title>
<path fill="none" stroke="black" d="M512.79,-919.82C503.46,-908.55 491.11,-893.61 480.7,-881.02"/>
<polygon fill="black" stroke="black" points="483.26,-878.63 474.19,-873.15 477.87,-883.09 483.26,-878.63"/>
</g>
<!-- val_lock -->
<g id="node24" class="node">
<title>val_lock</title>
<polygon fill="none" stroke="black" points="626.5,-873 561.5,-873 561.5,-837 626.5,-837 626.5,-873"/>
<text text-anchor="middle" x="594" y="-852.5" font-family="Courier,monospace" font-size="10.00">val_lock</text>
</g>
<!-- lock_val&#45;&gt;val_lock -->
<g id="edge23" class="edge">
<title>lock_val&#45;&gt;val_lock</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M541.21,-919.82C550.54,-908.55 562.89,-893.61 573.3,-881.02"/>
<polygon fill="black" stroke="black" points="576.13,-883.09 579.81,-873.15 570.74,-878.63 576.13,-883.09"/>
<text text-anchor="middle" x="589" y="-894" font-family="Courier,monospace" font-size="10.00">defer解锁</text>
</g>
<!-- ptr_mem_switch -->
<g id="node5" class="node">
<title>ptr_mem_switch</title>
<polygon fill="none" stroke="black" points="460,-800 335.92,-782 460,-764 584.08,-782 460,-800"/>
<text text-anchor="middle" x="460" y="-779.5" font-family="Courier,monospace" font-size="10.00">处理ptr_mcv到ptr_mem转换</text>
</g>
<!-- calc_size&#45;&gt;ptr_mem_switch -->
<g id="edge4" class="edge">
<title>calc_size&#45;&gt;ptr_mem_switch</title>
<path fill="none" stroke="black" d="M460,-836.81C460,-828.79 460,-819.05 460,-810.07"/>
<polygon fill="black" stroke="black" points="463.5,-810.03 460,-800.03 456.5,-810.03 463.5,-810.03"/>
</g>
<!-- ptr_mem_mod_check -->
<g id="node6" class="node">
<title>ptr_mem_mod_check</title>
<polygon fill="none" stroke="black" points="376,-717 274.37,-699 376,-681 477.63,-699 376,-717"/>
<text text-anchor="middle" x="376" y="-696.5" font-family="Courier,monospace" font-size="10.00">检查ptr_mem.mod类型</text>
</g>
<!-- ptr_mem_switch&#45;&gt;ptr_mem_mod_check -->
<g id="edge5" class="edge">
<title>ptr_mem_switch&#45;&gt;ptr_mem_mod_check</title>
<path fill="none" stroke="black" d="M444.59,-766.14C431.61,-753.62 412.86,-735.54 398.24,-721.45"/>
<polygon fill="black" stroke="black" points="400.65,-718.91 391.03,-714.49 395.8,-723.95 400.65,-718.91"/>
<text text-anchor="middle" x="447.5" y="-738" font-family="Courier,monospace" font-size="10.00">case .rm</text>
</g>
<!-- fail_todo -->
<g id="node12" class="node">
<title>fail_todo</title>
<ellipse fill="none" stroke="black" cx="543" cy="-699" rx="47.19" ry="18"/>
<text text-anchor="middle" x="543" y="-696.5" font-family="Courier,monospace" font-size="10.00">返回TODO错误</text>
</g>
<!-- ptr_mem_switch&#45;&gt;fail_todo -->
<g id="edge6" class="edge">
<title>ptr_mem_switch&#45;&gt;fail_todo</title>
<path fill="none" stroke="black" d="M475.22,-766.14C487.46,-754.2 504.89,-737.19 519,-723.42"/>
<polygon fill="black" stroke="black" points="521.74,-725.64 526.45,-716.15 516.85,-720.63 521.74,-725.64"/>
<text text-anchor="middle" x="545.5" y="-738" font-family="Courier,monospace" font-size="10.00">其他情况返回错误</text>
</g>
<!-- handle_mem_lock -->
<g id="node7" class="node">
<title>handle_mem_lock</title>
<polygon fill="none" stroke="black" points="408.5,-634 343.5,-634 343.5,-598 408.5,-598 408.5,-634"/>
<text text-anchor="middle" x="376" y="-613.5" font-family="Courier,monospace" font-size="10.00">处理内存锁</text>
</g>
<!-- ptr_mem_mod_check&#45;&gt;handle_mem_lock -->
<g id="edge7" class="edge">
<title>ptr_mem_mod_check&#45;&gt;handle_mem_lock</title>
<path fill="none" stroke="black" d="M376,-680.82C376,-670.19 376,-656.31 376,-644.2"/>
<polygon fill="black" stroke="black" points="379.5,-644.15 376,-634.15 372.5,-644.15 379.5,-644.15"/>
<text text-anchor="middle" x="396" y="-655" font-family="Courier,monospace" font-size="10.00">通过检查</text>
</g>
<!-- strat_decision -->
<g id="node8" class="node">
<title>strat_decision</title>
<polygon fill="none" stroke="black" points="280,-551 138.45,-533 280,-515 421.55,-533 280,-551"/>
<text text-anchor="middle" x="280" y="-530.5" font-family="Courier,monospace" font-size="10.00">确定策略(lock/loop/libcall)</text>
</g>
<!-- handle_mem_lock&#45;&gt;strat_decision -->
<g id="edge8" class="edge">
<title>handle_mem_lock&#45;&gt;strat_decision</title>
<path fill="none" stroke="black" d="M355.64,-597.82C341.02,-585.48 321.2,-568.76 305.52,-555.53"/>
<polygon fill="black" stroke="black" points="307.65,-552.75 297.75,-548.97 303.13,-558.1 307.65,-552.75"/>
</g>
<!-- mem_lock -->
<g id="node25" class="node">
<title>mem_lock</title>
<polygon fill="none" stroke="black" points="504.5,-551 439.5,-551 439.5,-515 504.5,-515 504.5,-551"/>
<text text-anchor="middle" x="472" y="-530.5" font-family="Courier,monospace" font-size="10.00">mem_lock</text>
</g>
<!-- handle_mem_lock&#45;&gt;mem_lock -->
<g id="edge24" class="edge">
<title>handle_mem_lock&#45;&gt;mem_lock</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M396.36,-597.82C410.11,-586.22 428.44,-570.75 443.61,-557.95"/>
<polygon fill="black" stroke="black" points="446.28,-560.28 451.67,-551.15 441.77,-554.93 446.28,-560.28"/>
<text text-anchor="middle" x="454" y="-572" font-family="Courier,monospace" font-size="10.00">defer解锁</text>
</g>
<!-- lock_strategy -->
<g id="node9" class="node">
<title>lock_strategy</title>
<polygon fill="none" stroke="black" points="152,-447 72,-447 72,-411 152,-411 152,-447"/>
<text text-anchor="middle" x="112" y="-426.5" font-family="Courier,monospace" font-size="10.00">LOCK策略处理</text>
</g>
<!-- strat_decision&#45;&gt;lock_strategy -->
<g id="edge9" class="edge">
<title>strat_decision&#45;&gt;lock_strategy</title>
<path fill="none" stroke="black" d="M253.4,-518.24C233.46,-507.72 205.65,-492.58 182,-478 169.28,-470.16 155.66,-461 143.84,-452.8"/>
<polygon fill="black" stroke="black" points="145.79,-449.89 135.59,-447.03 141.78,-455.63 145.79,-449.89"/>
<text text-anchor="middle" x="228.5" y="-489" font-family="Courier,monospace" font-size="10.00">.lock</text>
</g>
<!-- loop_strategy -->
<g id="node10" class="node">
<title>loop_strategy</title>
<polygon fill="none" stroke="black" points="320,-447 240,-447 240,-411 320,-411 320,-447"/>
<text text-anchor="middle" x="280" y="-426.5" font-family="Courier,monospace" font-size="10.00">LOOP策略处理</text>
</g>
<!-- strat_decision&#45;&gt;loop_strategy -->
<g id="edge10" class="edge">
<title>strat_decision&#45;&gt;loop_strategy</title>
<path fill="none" stroke="black" d="M280,-514.7C280,-498.92 280,-475.36 280,-457.09"/>
<polygon fill="black" stroke="black" points="283.5,-457.05 280,-447.05 276.5,-457.05 283.5,-457.05"/>
<text text-anchor="middle" x="295.5" y="-489" font-family="Courier,monospace" font-size="10.00">.loop</text>
</g>
<!-- libcall_strategy -->
<g id="node11" class="node">
<title>libcall_strategy</title>
<polygon fill="none" stroke="black" points="521.5,-447 382.5,-447 382.5,-411 521.5,-411 521.5,-447"/>
<text text-anchor="middle" x="452" y="-426.5" font-family="Courier,monospace" font-size="10.00">LIBCALL策略处理(未实现)</text>
</g>
<!-- strat_decision&#45;&gt;libcall_strategy -->
<g id="edge11" class="edge">
<title>strat_decision&#45;&gt;libcall_strategy</title>
<path fill="none" stroke="black" d="M306.08,-518.29C325.99,-507.66 354,-492.37 378,-478 391.22,-470.09 405.47,-460.98 417.91,-452.84"/>
<polygon fill="black" stroke="black" points="420.17,-455.54 426.6,-447.12 416.32,-449.69 420.17,-455.54"/>
<text text-anchor="middle" x="386.5" y="-489" font-family="Courier,monospace" font-size="10.00">.libcall</text>
</g>
<!-- lock_start -->
<g id="node13" class="node">
<title>lock_start</title>
<polygon fill="none" stroke="black" points="141,-364 67,-364 67,-328 141,-328 141,-364"/>
<text text-anchor="middle" x="104" y="-343.5" font-family="Courier,monospace" font-size="10.00">生成MIR指令</text>
</g>
<!-- lock_strategy&#45;&gt;lock_start -->
<g id="edge12" class="edge">
<title>lock_strategy&#45;&gt;lock_start</title>
<path fill="none" stroke="black" d="M110.3,-410.82C109.25,-400.19 107.88,-386.31 106.69,-374.2"/>
<polygon fill="black" stroke="black" points="110.16,-373.76 105.69,-364.15 103.19,-374.45 110.16,-373.76"/>
</g>
<!-- loop_start -->
<g id="node17" class="node">
<title>loop_start</title>
<polygon fill="none" stroke="black" points="326.5,-364 233.5,-364 233.5,-328 326.5,-328 326.5,-364"/>
<text text-anchor="middle" x="280" y="-343.5" font-family="Courier,monospace" font-size="10.00">处理&lt;=8字节情况</text>
</g>
<!-- loop_strategy&#45;&gt;loop_start -->
<g id="edge16" class="edge">
<title>loop_strategy&#45;&gt;loop_start</title>
<path fill="none" stroke="black" d="M280,-410.82C280,-400.19 280,-386.31 280,-374.2"/>
<polygon fill="black" stroke="black" points="283.5,-374.15 280,-364.15 276.5,-374.15 283.5,-374.15"/>
</g>
<!-- fail_libcall -->
<g id="node22" class="node">
<title>fail_libcall</title>
<ellipse fill="none" stroke="black" cx="452" cy="-346" rx="57.88" ry="18"/>
<text text-anchor="middle" x="452" y="-343.5" font-family="Courier,monospace" font-size="10.00">返回LIBCALL错误</text>
</g>
<!-- libcall_strategy&#45;&gt;fail_libcall -->
<g id="edge21" class="edge">
<title>libcall_strategy&#45;&gt;fail_libcall</title>
<path fill="none" stroke="black" d="M452,-410.82C452,-400.19 452,-386.31 452,-374.2"/>
<polygon fill="black" stroke="black" points="455.5,-374.15 452,-364.15 448.5,-374.15 455.5,-374.15"/>
<text text-anchor="middle" x="486.5" y="-385" font-family="Courier,monospace" font-size="10.00">返回未实现错误</text>
</g>
<!-- handle_rmw_op -->
<g id="node14" class="node">
<title>handle_rmw_op</title>
<polygon fill="none" stroke="black" points="93,-291 15.66,-273 93,-255 170.34,-273 93,-291"/>
<text text-anchor="middle" x="93" y="-270.5" font-family="Courier,monospace" font-size="10.00">处理RMW操作类型</text>
</g>
<!-- lock_start&#45;&gt;handle_rmw_op -->
<g id="edge13" class="edge">
<title>lock_start&#45;&gt;handle_rmw_op</title>
<path fill="none" stroke="black" d="M101.34,-327.81C100.08,-319.67 98.54,-309.76 97.13,-300.67"/>
<polygon fill="black" stroke="black" points="100.55,-299.89 95.56,-290.54 93.63,-300.96 100.55,-299.89"/>
</g>
<!-- gen_instructions -->
<g id="node15" class="node">
<title>gen_instructions</title>
<polygon fill="none" stroke="black" points="130.5,-208 55.5,-208 55.5,-172 130.5,-172 130.5,-208"/>
<text text-anchor="middle" x="93" y="-187.5" font-family="Courier,monospace" font-size="10.00">生成汇编指令</text>
</g>
<!-- handle_rmw_op&#45;&gt;gen_instructions -->
<g id="edge14" class="edge">
<title>handle_rmw_op&#45;&gt;gen_instructions</title>
<path fill="none" stroke="black" d="M93,-254.82C93,-244.19 93,-230.31 93,-218.2"/>
<polygon fill="black" stroke="black" points="96.5,-218.15 93,-208.15 89.5,-218.15 96.5,-218.15"/>
<text text-anchor="middle" x="122.5" y="-229" font-family="Courier,monospace" font-size="10.00">匹配操作类型</text>
</g>
<!-- lock_end -->
<g id="node16" class="node">
<title>lock_end</title>
<polygon fill="none" stroke="black" points="121,-135 65,-135 65,-99 121,-99 121,-135"/>
<text text-anchor="middle" x="93" y="-114.5" font-family="Courier,monospace" font-size="10.00">返回结果</text>
</g>
<!-- gen_instructions&#45;&gt;lock_end -->
<g id="edge15" class="edge">
<title>gen_instructions&#45;&gt;lock_end</title>
<path fill="none" stroke="black" d="M93,-171.81C93,-163.79 93,-154.05 93,-145.07"/>
<polygon fill="black" stroke="black" points="96.5,-145.03 93,-135.03 89.5,-145.03 96.5,-145.03"/>
</g>
<!-- sse_check -->
<g id="node18" class="node">
<title>sse_check</title>
<polygon fill="none" stroke="black" points="280,-291 194.01,-273 280,-255 365.99,-273 280,-291"/>
<text text-anchor="middle" x="280" y="-270.5" font-family="Courier,monospace" font-size="10.00">是否需要SSE寄存器</text>
</g>
<!-- loop_start&#45;&gt;sse_check -->
<g id="edge17" class="edge">
<title>loop_start&#45;&gt;sse_check</title>
<path fill="none" stroke="black" d="M280,-327.81C280,-319.79 280,-310.05 280,-301.07"/>
<polygon fill="black" stroke="black" points="283.5,-301.03 280,-291.03 276.5,-301.03 283.5,-301.03"/>
</g>
<!-- handle_rmw_ops -->
<g id="node19" class="node">
<title>handle_rmw_ops</title>
<polygon fill="none" stroke="black" points="317,-208 243,-208 243,-172 317,-172 317,-208"/>
<text text-anchor="middle" x="280" y="-187.5" font-family="Courier,monospace" font-size="10.00">处理RMW操作</text>
</g>
<!-- sse_check&#45;&gt;handle_rmw_ops -->
<g id="edge18" class="edge">
<title>sse_check&#45;&gt;handle_rmw_ops</title>
<path fill="none" stroke="black" d="M280,-254.82C280,-244.19 280,-230.31 280,-218.2"/>
<polygon fill="black" stroke="black" points="283.5,-218.15 280,-208.15 276.5,-218.15 283.5,-218.15"/>
<text text-anchor="middle" x="293" y="-229" font-family="Courier,monospace" font-size="10.00">是/否</text>
</g>
<!-- cmpxchg_loop -->
<g id="node20" class="node">
<title>cmpxchg_loop</title>
<polygon fill="none" stroke="black" points="329,-135 231,-135 231,-99 329,-99 329,-135"/>
<text text-anchor="middle" x="280" y="-114.5" font-family="Courier,monospace" font-size="10.00">生成CMPXCHG循环</text>
</g>
<!-- handle_rmw_ops&#45;&gt;cmpxchg_loop -->
<g id="edge19" class="edge">
<title>handle_rmw_ops&#45;&gt;cmpxchg_loop</title>
<path fill="none" stroke="black" d="M280,-171.81C280,-163.79 280,-154.05 280,-145.07"/>
<polygon fill="black" stroke="black" points="283.5,-145.03 280,-135.03 276.5,-145.03 283.5,-145.03"/>
</g>
<!-- loop_end -->
<g id="node21" class="node">
<title>loop_end</title>
<polygon fill="none" stroke="black" points="308,-52 252,-52 252,-16 308,-16 308,-52"/>
<text text-anchor="middle" x="280" y="-31.5" font-family="Courier,monospace" font-size="10.00">返回结果</text>
</g>
<!-- cmpxchg_loop&#45;&gt;loop_end -->
<g id="edge20" class="edge">
<title>cmpxchg_loop&#45;&gt;loop_end</title>
<path fill="none" stroke="black" d="M280,-98.82C280,-88.19 280,-74.31 280,-62.2"/>
<polygon fill="black" stroke="black" points="283.5,-62.15 280,-52.15 276.5,-62.15 283.5,-62.15"/>
<text text-anchor="middle" x="300" y="-73" font-family="Courier,monospace" font-size="10.00">循环结束</text>
</g>
</g>
</svg>
