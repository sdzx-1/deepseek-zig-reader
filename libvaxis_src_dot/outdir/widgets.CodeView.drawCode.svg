<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: drawCode Pages: 1 -->
<svg width="651pt" height="1487pt"
 viewBox="0.00 0.00 651.00 1487.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1483)">
<title>drawCode</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1483 647,-1483 647,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="421,-1479 367,-1479 367,-1443 421,-1443 421,-1479"/>
<text text-anchor="middle" x="394" y="-1457.3" font-family="Arial" font-size="14.00">开始</text>
</g>
<!-- init_vars -->
<g id="node2" class="node">
<title>init_vars</title>
<polygon fill="none" stroke="black" points="514,-1406 274,-1406 274,-1353 514,-1353 514,-1406"/>
<text text-anchor="middle" x="394" y="-1390.8" font-family="Arial" font-size="14.00">初始化变量:</text>
<text text-anchor="middle" x="394" y="-1375.8" font-family="Arial" font-size="14.00">pos = {0,0}, byte_index=0</text>
<text text-anchor="middle" x="394" y="-1360.8" font-family="Arial" font-size="14.00">is_indentation=true, 获取边界bounds</text>
</g>
<!-- start&#45;&gt;init_vars -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init_vars</title>
<path fill="none" stroke="black" d="M394,-1442.75C394,-1434.99 394,-1425.51 394,-1416.32"/>
<polygon fill="black" stroke="black" points="397.5,-1416.18 394,-1406.18 390.5,-1416.18 397.5,-1416.18"/>
</g>
<!-- loop_start -->
<g id="node3" class="node">
<title>loop_start</title>
<polygon fill="none" stroke="black" points="494.5,-1316 293.5,-1316 293.5,-1280 494.5,-1280 494.5,-1316"/>
<text text-anchor="middle" x="394" y="-1294.3" font-family="Arial" font-size="14.00">遍历buffer.grapheme的每个项</text>
</g>
<!-- init_vars&#45;&gt;loop_start -->
<g id="edge2" class="edge">
<title>init_vars&#45;&gt;loop_start</title>
<path fill="none" stroke="black" d="M394,-1352.91C394,-1344.48 394,-1335.08 394,-1326.52"/>
<polygon fill="black" stroke="black" points="397.5,-1326.26 394,-1316.26 390.5,-1326.26 397.5,-1326.26"/>
</g>
<!-- check_above -->
<g id="node4" class="node">
<title>check_above</title>
<polygon fill="none" stroke="black" points="203,-1243 69.94,-1225 203,-1207 336.06,-1225 203,-1243"/>
<text text-anchor="middle" x="203" y="-1221.3" font-family="Arial" font-size="14.00">当前行在视图上方？</text>
</g>
<!-- loop_start&#45;&gt;check_above -->
<g id="edge3" class="edge">
<title>loop_start&#45;&gt;check_above</title>
<path fill="none" stroke="black" d="M348.25,-1279.99C317.28,-1268.48 276.62,-1253.37 246.2,-1242.06"/>
<polygon fill="black" stroke="black" points="247.3,-1238.74 236.71,-1238.53 244.87,-1245.3 247.3,-1238.74"/>
</g>
<!-- break_loop -->
<g id="node5" class="node">
<title>break_loop</title>
<polygon fill="none" stroke="black" points="74,-1156 0,-1156 0,-1120 74,-1120 74,-1156"/>
<text text-anchor="middle" x="37" y="-1134.3" font-family="Arial" font-size="14.00">跳出循环</text>
</g>
<!-- check_above&#45;&gt;break_loop -->
<g id="edge4" class="edge">
<title>check_above&#45;&gt;break_loop</title>
<path fill="none" stroke="black" d="M176.7,-1210.53C150.6,-1197.17 110.18,-1176.47 79.51,-1160.77"/>
<polygon fill="black" stroke="black" points="80.84,-1157.51 70.34,-1156.07 77.64,-1163.74 80.84,-1157.51"/>
<text text-anchor="middle" x="137.5" y="-1177.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- handle_newline -->
<g id="node6" class="node">
<title>handle_newline</title>
<polygon fill="none" stroke="black" points="203,-1156 109.49,-1138 203,-1120 296.51,-1138 203,-1156"/>
<text text-anchor="middle" x="203" y="-1134.3" font-family="Arial" font-size="14.00">遇到换行符？</text>
</g>
<!-- check_above&#45;&gt;handle_newline -->
<g id="edge5" class="edge">
<title>check_above&#45;&gt;handle_newline</title>
<path fill="none" stroke="black" d="M203,-1206.8C203,-1195.16 203,-1179.55 203,-1166.24"/>
<polygon fill="black" stroke="black" points="206.5,-1166.18 203,-1156.18 199.5,-1166.18 206.5,-1166.18"/>
<text text-anchor="middle" x="210.5" y="-1177.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- end -->
<g id="node23" class="node">
<title>end</title>
<polygon fill="none" stroke="black" points="55,-1069 1,-1069 1,-1033 55,-1033 55,-1069"/>
<text text-anchor="middle" x="28" y="-1047.3" font-family="Arial" font-size="14.00">结束</text>
</g>
<!-- break_loop&#45;&gt;end -->
<g id="edge30" class="edge">
<title>break_loop&#45;&gt;end</title>
<path fill="none" stroke="black" d="M35.18,-1119.8C33.95,-1108.16 32.29,-1092.55 30.88,-1079.24"/>
<polygon fill="black" stroke="black" points="34.35,-1078.75 29.82,-1069.18 27.39,-1079.49 34.35,-1078.75"/>
</g>
<!-- update_newline -->
<g id="node7" class="node">
<title>update_newline</title>
<polygon fill="none" stroke="black" points="141.5,-1015 10.5,-1015 10.5,-962 141.5,-962 141.5,-1015"/>
<text text-anchor="middle" x="76" y="-999.8" font-family="Arial" font-size="14.00">pos.y += 1</text>
<text text-anchor="middle" x="76" y="-984.8" font-family="Arial" font-size="14.00">pos.x=0</text>
<text text-anchor="middle" x="76" y="-969.8" font-family="Arial" font-size="14.00">is_indentation=true</text>
</g>
<!-- handle_newline&#45;&gt;update_newline -->
<g id="edge6" class="edge">
<title>handle_newline&#45;&gt;update_newline</title>
<path fill="none" stroke="black" d="M176.13,-1125.14C153.35,-1113.8 121.37,-1094.63 102,-1069 92.33,-1056.2 86.16,-1039.64 82.27,-1024.95"/>
<polygon fill="black" stroke="black" points="85.66,-1024.06 79.93,-1015.14 78.85,-1025.68 85.66,-1024.06"/>
<text text-anchor="middle" x="144.5" y="-1090.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- check_below -->
<g id="node8" class="node">
<title>check_below</title>
<polygon fill="none" stroke="black" points="244,-1069 110.94,-1051 244,-1033 377.06,-1051 244,-1069"/>
<text text-anchor="middle" x="244" y="-1047.3" font-family="Arial" font-size="14.00">当前行在视图下方？</text>
</g>
<!-- handle_newline&#45;&gt;check_below -->
<g id="edge7" class="edge">
<title>handle_newline&#45;&gt;check_below</title>
<path fill="none" stroke="black" d="M210.52,-1121.41C216.46,-1109.1 224.86,-1091.69 231.76,-1077.38"/>
<polygon fill="black" stroke="black" points="235.06,-1078.6 236.25,-1068.07 228.75,-1075.56 235.06,-1078.6"/>
<text text-anchor="middle" x="233.5" y="-1090.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- loop_end -->
<g id="node22" class="node">
<title>loop_end</title>
<polygon fill="none" stroke="black" points="292,-36 176,-36 176,0 292,0 292,-36"/>
<text text-anchor="middle" x="234" y="-14.3" font-family="Arial" font-size="14.00">继续下一个字符</text>
</g>
<!-- update_newline&#45;&gt;loop_end -->
<g id="edge8" class="edge">
<title>update_newline&#45;&gt;loop_end</title>
<path fill="none" stroke="black" d="M76,-961.58C76,-938.37 76,-903.41 76,-873 76,-873 76,-873 76,-90 76,-48.1 122.8,-30.78 165.46,-23.69"/>
<polygon fill="black" stroke="black" points="166.24,-27.11 175.62,-22.18 165.21,-20.19 166.24,-27.11"/>
</g>
<!-- skip_below -->
<g id="node9" class="node">
<title>skip_below</title>
<polygon fill="none" stroke="black" points="184,-890 110,-890 110,-854 184,-854 184,-890"/>
<text text-anchor="middle" x="147" y="-868.3" font-family="Arial" font-size="14.00">跳过处理</text>
</g>
<!-- check_below&#45;&gt;skip_below -->
<g id="edge9" class="edge">
<title>check_below&#45;&gt;skip_below</title>
<path fill="none" stroke="black" d="M234.68,-1033.93C222.73,-1013.25 201.47,-976.14 184,-944 175.99,-929.26 167.31,-912.63 160.37,-899.18"/>
<polygon fill="black" stroke="black" points="163.34,-897.31 155.66,-890.02 157.12,-900.51 163.34,-897.31"/>
<text text-anchor="middle" x="231.5" y="-984.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- check_highlight -->
<g id="node10" class="node">
<title>check_highlight</title>
<polygon fill="none" stroke="black" points="309,-944 193,-944 193,-908 309,-908 309,-944"/>
<text text-anchor="middle" x="251" y="-922.3" font-family="Arial" font-size="14.00">是否是高亮行？</text>
</g>
<!-- check_below&#45;&gt;check_highlight -->
<g id="edge10" class="edge">
<title>check_below&#45;&gt;check_highlight</title>
<path fill="none" stroke="black" d="M244.97,-1032.9C246.13,-1012.63 248.06,-978.6 249.43,-954.59"/>
<polygon fill="black" stroke="black" points="252.94,-954.54 250.01,-944.35 245.95,-954.14 252.94,-954.54"/>
<text text-anchor="middle" x="256.5" y="-984.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- skip_below&#45;&gt;loop_end -->
<g id="edge11" class="edge">
<title>skip_below&#45;&gt;loop_end</title>
<path fill="none" stroke="black" d="M136.56,-853.96C126.89,-836.54 114,-808.37 114,-782 114,-782 114,-782 114,-90 114,-61.74 138.95,-44.49 166.1,-34.09"/>
<polygon fill="black" stroke="black" points="167.49,-37.31 175.76,-30.68 165.16,-30.71 167.49,-37.31"/>
</g>
<!-- apply_style -->
<g id="node11" class="node">
<title>apply_style</title>
<polygon fill="none" stroke="black" points="296,-836 194,-836 194,-800 296,-800 296,-836"/>
<text text-anchor="middle" x="245" y="-814.3" font-family="Arial" font-size="14.00">应用高亮样式</text>
</g>
<!-- check_highlight&#45;&gt;apply_style -->
<g id="edge12" class="edge">
<title>check_highlight&#45;&gt;apply_style</title>
<path fill="none" stroke="black" d="M250.04,-907.97C249.1,-891.38 247.65,-865.88 246.55,-846.43"/>
<polygon fill="black" stroke="black" points="250.04,-846.13 245.98,-836.34 243.05,-846.52 250.04,-846.13"/>
<text text-anchor="middle" x="256.5" y="-868.3" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- check_style_map -->
<g id="node12" class="node">
<title>check_style_map</title>
<polygon fill="none" stroke="black" points="305,-763 198.26,-745 305,-727 411.74,-745 305,-763"/>
<text text-anchor="middle" x="305" y="-741.3" font-family="Arial" font-size="14.00">存在样式映射？</text>
</g>
<!-- check_highlight&#45;&gt;check_style_map -->
<g id="edge13" class="edge">
<title>check_highlight&#45;&gt;check_style_map</title>
<path fill="none" stroke="black" d="M265.3,-907.95C278.54,-890.96 297.31,-863.5 305,-836 310.78,-815.34 310.36,-790.96 308.73,-772.78"/>
<polygon fill="black" stroke="black" points="312.18,-772.19 307.63,-762.62 305.22,-772.94 312.18,-772.19"/>
<text text-anchor="middle" x="317.5" y="-814.3" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- apply_style&#45;&gt;check_style_map -->
<g id="edge14" class="edge">
<title>apply_style&#45;&gt;check_style_map</title>
<path fill="none" stroke="black" d="M259.52,-799.81C267.41,-790.49 277.25,-778.84 285.76,-768.77"/>
<polygon fill="black" stroke="black" points="288.46,-771 292.24,-761.1 283.11,-766.48 288.46,-771"/>
</g>
<!-- merge_styles -->
<g id="node13" class="node">
<title>merge_styles</title>
<polygon fill="none" stroke="black" points="381.5,-676 222.5,-676 222.5,-640 381.5,-640 381.5,-676"/>
<text text-anchor="middle" x="302" y="-654.3" font-family="Arial" font-size="14.00">合并样式并保留背景色</text>
</g>
<!-- check_style_map&#45;&gt;merge_styles -->
<g id="edge15" class="edge">
<title>check_style_map&#45;&gt;merge_styles</title>
<path fill="none" stroke="black" d="M304.39,-726.8C303.98,-715.16 303.43,-699.55 302.96,-686.24"/>
<polygon fill="black" stroke="black" points="306.46,-686.05 302.61,-676.18 299.46,-686.29 306.46,-686.05"/>
<text text-anchor="middle" x="311.5" y="-697.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- calc_width -->
<g id="node14" class="node">
<title>calc_width</title>
<polygon fill="none" stroke="black" points="429,-589 327,-589 327,-553 429,-553 429,-589"/>
<text text-anchor="middle" x="378" y="-567.3" font-family="Arial" font-size="14.00">计算字符宽度</text>
</g>
<!-- check_style_map&#45;&gt;calc_width -->
<g id="edge16" class="edge">
<title>check_style_map&#45;&gt;calc_width</title>
<path fill="none" stroke="black" d="M331.15,-731.36C351.37,-720 377.88,-701.21 390,-676 401.69,-651.68 395.78,-620.58 388.76,-598.75"/>
<polygon fill="black" stroke="black" points="392,-597.43 385.4,-589.14 385.39,-599.74 392,-597.43"/>
<text text-anchor="middle" x="404.5" y="-654.3" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- merge_styles&#45;&gt;calc_width -->
<g id="edge17" class="edge">
<title>merge_styles&#45;&gt;calc_width</title>
<path fill="none" stroke="black" d="M317.38,-639.8C328.4,-627.47 343.42,-610.68 355.75,-596.89"/>
<polygon fill="black" stroke="black" points="358.59,-598.96 362.64,-589.18 353.37,-594.3 358.59,-598.96"/>
</g>
<!-- check_col_inside -->
<g id="node15" class="node">
<title>check_col_inside</title>
<polygon fill="none" stroke="black" points="378,-516 257.68,-498 378,-480 498.32,-498 378,-516"/>
<text text-anchor="middle" x="378" y="-494.3" font-family="Arial" font-size="14.00">当前列在视图内？</text>
</g>
<!-- calc_width&#45;&gt;check_col_inside -->
<g id="edge18" class="edge">
<title>calc_width&#45;&gt;check_col_inside</title>
<path fill="none" stroke="black" d="M378,-552.81C378,-544.79 378,-535.05 378,-526.07"/>
<polygon fill="black" stroke="black" points="381.5,-526.03 378,-516.03 374.5,-526.03 381.5,-526.03"/>
</g>
<!-- check_indent -->
<g id="node16" class="node">
<title>check_indent</title>
<polygon fill="none" stroke="black" points="328,-429 142.16,-411 328,-393 513.84,-411 328,-429"/>
<text text-anchor="middle" x="328" y="-407.3" font-family="Arial" font-size="14.00">处于缩进状态且非空格字符？</text>
</g>
<!-- check_col_inside&#45;&gt;check_indent -->
<g id="edge19" class="edge">
<title>check_col_inside&#45;&gt;check_indent</title>
<path fill="none" stroke="black" d="M368.6,-481.01C361.31,-468.63 351.08,-451.23 342.71,-437.01"/>
<polygon fill="black" stroke="black" points="345.62,-435.05 337.53,-428.21 339.59,-438.6 345.62,-435.05"/>
<text text-anchor="middle" x="363.5" y="-450.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- check_col_inside&#45;&gt;loop_end -->
<g id="edge20" class="edge">
<title>check_col_inside&#45;&gt;loop_end</title>
<path fill="none" stroke="black" d="M441.88,-489.53C487.92,-480.17 542,-459.14 542,-412 542,-412 542,-412 542,-90 542,-41.19 393.27,-25.93 302.52,-21.16"/>
<polygon fill="black" stroke="black" points="302.46,-17.66 292.29,-20.66 302.11,-24.65 302.46,-17.66"/>
<text text-anchor="middle" x="549.5" y="-247.3" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- update_indent_flag -->
<g id="node17" class="node">
<title>update_indent_flag</title>
<polygon fill="none" stroke="black" points="344.5,-342 207.5,-342 207.5,-306 344.5,-306 344.5,-342"/>
<text text-anchor="middle" x="276" y="-320.3" font-family="Arial" font-size="14.00">is_indentation=false</text>
</g>
<!-- check_indent&#45;&gt;update_indent_flag -->
<g id="edge21" class="edge">
<title>check_indent&#45;&gt;update_indent_flag</title>
<path fill="none" stroke="black" d="M317.97,-393.61C310.57,-381.5 300.33,-364.77 291.83,-350.87"/>
<polygon fill="black" stroke="black" points="294.74,-348.92 286.53,-342.21 288.76,-352.57 294.74,-348.92"/>
<text text-anchor="middle" x="313.5" y="-363.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- check_indent_cond -->
<g id="node18" class="node">
<title>check_indent_cond</title>
<polygon fill="none" stroke="black" points="301,-269 154.71,-251 301,-233 447.29,-251 301,-269"/>
<text text-anchor="middle" x="301" y="-247.3" font-family="Arial" font-size="14.00">需要绘制缩进单元格？</text>
</g>
<!-- check_indent&#45;&gt;check_indent_cond -->
<g id="edge22" class="edge">
<title>check_indent&#45;&gt;check_indent_cond</title>
<path fill="none" stroke="black" d="M337.97,-393.69C349.37,-372.82 365.01,-335.8 353,-306 347.93,-293.43 338.38,-282.15 328.83,-273.19"/>
<polygon fill="black" stroke="black" points="331.08,-270.5 321.26,-266.52 326.45,-275.76 331.08,-270.5"/>
<text text-anchor="middle" x="365.5" y="-320.3" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- update_indent_flag&#45;&gt;check_indent_cond -->
<g id="edge23" class="edge">
<title>update_indent_flag&#45;&gt;check_indent_cond</title>
<path fill="none" stroke="black" d="M282.05,-305.81C284.98,-297.49 288.56,-287.33 291.82,-278.08"/>
<polygon fill="black" stroke="black" points="295.16,-279.13 295.18,-268.54 288.55,-276.81 295.16,-279.13"/>
</g>
<!-- draw_indent -->
<g id="node19" class="node">
<title>draw_indent</title>
<polygon fill="none" stroke="black" points="272,-182 156,-182 156,-146 272,-146 272,-182"/>
<text text-anchor="middle" x="214" y="-160.3" font-family="Arial" font-size="14.00">绘制缩进单元格</text>
</g>
<!-- check_indent_cond&#45;&gt;draw_indent -->
<g id="edge24" class="edge">
<title>check_indent_cond&#45;&gt;draw_indent</title>
<path fill="none" stroke="black" d="M285.45,-234.8C272.54,-222.2 253.95,-204.03 238.97,-189.4"/>
<polygon fill="black" stroke="black" points="241.11,-186.59 231.51,-182.11 236.22,-191.6 241.11,-186.59"/>
<text text-anchor="middle" x="270.5" y="-203.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- draw_char -->
<g id="node20" class="node">
<title>draw_char</title>
<polygon fill="none" stroke="black" points="364,-182 290,-182 290,-146 364,-146 364,-182"/>
<text text-anchor="middle" x="327" y="-160.3" font-family="Arial" font-size="14.00">绘制字符</text>
</g>
<!-- check_indent_cond&#45;&gt;draw_char -->
<g id="edge25" class="edge">
<title>check_indent_cond&#45;&gt;draw_char</title>
<path fill="none" stroke="black" d="M306.01,-233.61C309.61,-221.85 314.54,-205.73 318.72,-192.07"/>
<polygon fill="black" stroke="black" points="322.16,-192.8 321.73,-182.21 315.46,-190.75 322.16,-192.8"/>
<text text-anchor="middle" x="323.5" y="-203.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- fill_highlight -->
<g id="node21" class="node">
<title>fill_highlight</title>
<polygon fill="none" stroke="black" points="306.5,-109 161.5,-109 161.5,-73 306.5,-73 306.5,-109"/>
<text text-anchor="middle" x="234" y="-87.3" font-family="Arial" font-size="14.00">填充高亮行剩余部分</text>
</g>
<!-- draw_indent&#45;&gt;fill_highlight -->
<g id="edge26" class="edge">
<title>draw_indent&#45;&gt;fill_highlight</title>
<path fill="none" stroke="black" d="M218.84,-145.81C221.13,-137.7 223.91,-127.84 226.46,-118.78"/>
<polygon fill="black" stroke="black" points="229.86,-119.6 229.2,-109.03 223.12,-117.71 229.86,-119.6"/>
</g>
<!-- draw_char&#45;&gt;fill_highlight -->
<g id="edge27" class="edge">
<title>draw_char&#45;&gt;fill_highlight</title>
<path fill="none" stroke="black" d="M304.49,-145.81C292.49,-136.66 277.57,-125.26 264.54,-115.32"/>
<polygon fill="black" stroke="black" points="266.38,-112.32 256.31,-109.03 262.13,-117.88 266.38,-112.32"/>
</g>
<!-- fill_highlight&#45;&gt;loop_end -->
<g id="edge28" class="edge">
<title>fill_highlight&#45;&gt;loop_end</title>
<path fill="none" stroke="black" d="M234,-72.81C234,-64.79 234,-55.05 234,-46.07"/>
<polygon fill="black" stroke="black" points="237.5,-46.03 234,-36.03 230.5,-46.03 237.5,-46.03"/>
</g>
<!-- loop_end&#45;&gt;loop_start -->
<g id="edge29" class="edge">
<title>loop_end&#45;&gt;loop_start</title>
<path fill="none" stroke="black" d="M292.35,-18.95C392.16,-20.46 585,-31.01 585,-90 585,-1226 585,-1226 585,-1226 585,-1248 539.9,-1265.39 493.53,-1277.45"/>
<polygon fill="black" stroke="black" points="492.47,-1274.1 483.63,-1279.94 494.18,-1280.89 492.47,-1274.1"/>
<text text-anchor="middle" x="614" y="-610.8" font-family="Arial" font-size="14.00">继续循环</text>
</g>
</g>
</svg>
