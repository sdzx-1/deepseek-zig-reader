<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: KyberFlow Pages: 1 -->
<svg width="519pt" height="844pt"
 viewBox="0.00 0.00 519.00 844.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 840)">
<title>KyberFlow</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-840 515,-840 515,4 -4,4"/>
<!-- generateKeyPair -->
<g id="node1" class="node">
<title>generateKeyPair</title>
<path fill="none" stroke="black" d="M400,-836C400,-836 200,-836 200,-836 194,-836 188,-830 188,-824 188,-824 188,-812 188,-812 188,-806 194,-800 200,-800 200,-800 400,-800 400,-800 406,-800 412,-806 412,-812 412,-812 412,-824 412,-824 412,-830 406,-836 400,-836"/>
<text text-anchor="middle" x="300" y="-814.3" font-family="Times,serif" font-size="14.00">生成密钥对 (KeyPair.generate)</text>
</g>
<!-- generateDeterministic -->
<g id="node2" class="node">
<title>generateDeterministic</title>
<path fill="none" stroke="black" d="M441.5,-763C441.5,-763 158.5,-763 158.5,-763 152.5,-763 146.5,-757 146.5,-751 146.5,-751 146.5,-739 146.5,-739 146.5,-733 152.5,-727 158.5,-727 158.5,-727 441.5,-727 441.5,-727 447.5,-727 453.5,-733 453.5,-739 453.5,-739 453.5,-751 453.5,-751 453.5,-757 447.5,-763 441.5,-763"/>
<text text-anchor="middle" x="300" y="-741.3" font-family="Times,serif" font-size="14.00">确定性生成密钥对 (generateDeterministic)</text>
</g>
<!-- generateKeyPair&#45;&gt;generateDeterministic -->
<g id="edge1" class="edge">
<title>generateKeyPair&#45;&gt;generateDeterministic</title>
<path fill="none" stroke="black" d="M300,-799.81C300,-791.79 300,-782.05 300,-773.07"/>
<polygon fill="black" stroke="black" points="303.5,-773.03 300,-763.03 296.5,-773.03 303.5,-773.03"/>
</g>
<!-- innerKeyFromSeed -->
<g id="node3" class="node">
<title>innerKeyFromSeed</title>
<path fill="none" stroke="black" d="M415,-690C415,-690 185,-690 185,-690 179,-690 173,-684 173,-678 173,-678 173,-666 173,-666 173,-660 179,-654 185,-654 185,-654 415,-654 415,-654 421,-654 427,-660 427,-666 427,-666 427,-678 427,-678 427,-684 421,-690 415,-690"/>
<text text-anchor="middle" x="300" y="-668.3" font-family="Times,serif" font-size="14.00">内部密钥生成 (innerKeyFromSeed)</text>
</g>
<!-- generateDeterministic&#45;&gt;innerKeyFromSeed -->
<g id="edge2" class="edge">
<title>generateDeterministic&#45;&gt;innerKeyFromSeed</title>
<path fill="none" stroke="black" d="M300,-726.81C300,-718.79 300,-709.05 300,-700.07"/>
<polygon fill="black" stroke="black" points="303.5,-700.03 300,-690.03 296.5,-700.03 303.5,-700.03"/>
</g>
<!-- seedExpansion -->
<g id="node4" class="node">
<title>seedExpansion</title>
<path fill="none" stroke="black" d="M312.5,-617C312.5,-617 175.5,-617 175.5,-617 169.5,-617 163.5,-611 163.5,-605 163.5,-605 163.5,-593 163.5,-593 163.5,-587 169.5,-581 175.5,-581 175.5,-581 312.5,-581 312.5,-581 318.5,-581 324.5,-587 324.5,-593 324.5,-593 324.5,-605 324.5,-605 324.5,-611 318.5,-617 312.5,-617"/>
<text text-anchor="middle" x="244" y="-595.3" font-family="Times,serif" font-size="14.00">种子扩展 (SHA3&#45;512)</text>
</g>
<!-- innerKeyFromSeed&#45;&gt;seedExpansion -->
<g id="edge3" class="edge">
<title>innerKeyFromSeed&#45;&gt;seedExpansion</title>
<path fill="none" stroke="black" d="M286.44,-653.81C279.63,-645.18 271.25,-634.56 263.75,-625.03"/>
<polygon fill="black" stroke="black" points="266.37,-622.71 257.43,-617.03 260.88,-627.05 266.37,-622.71"/>
</g>
<!-- computeTh -->
<g id="node6" class="node">
<title>computeTh</title>
<path fill="none" stroke="black" d="M432,-443C432,-443 278,-443 278,-443 272,-443 266,-437 266,-431 266,-431 266,-419 266,-419 266,-413 272,-407 278,-407 278,-407 432,-407 432,-407 438,-407 444,-413 444,-419 444,-419 444,-431 444,-431 444,-437 438,-443 432,-443"/>
<text text-anchor="middle" x="355" y="-421.3" font-family="Times,serif" font-size="14.00">计算公钥向量 t (A s + e)</text>
</g>
<!-- innerKeyFromSeed&#45;&gt;computeTh -->
<g id="edge15" class="edge">
<title>innerKeyFromSeed&#45;&gt;computeTh</title>
<path fill="none" stroke="black" d="M313.84,-653.56C321.09,-643.47 329.4,-630.18 334,-617 353.46,-561.24 356.05,-491.27 355.79,-453.4"/>
<polygon fill="black" stroke="black" points="359.29,-453.12 355.65,-443.17 352.29,-453.21 359.29,-453.12"/>
<text text-anchor="middle" x="382.5" y="-551.8" font-family="Times,serif" font-size="14.00">生成公钥 t</text>
</g>
<!-- sampleSecret -->
<g id="node5" class="node">
<title>sampleSecret</title>
<path fill="none" stroke="black" d="M315,-530C315,-530 161,-530 161,-530 155,-530 149,-524 149,-518 149,-518 149,-506 149,-506 149,-500 155,-494 161,-494 161,-494 315,-494 315,-494 321,-494 327,-500 327,-506 327,-506 327,-518 327,-518 327,-524 321,-530 315,-530"/>
<text text-anchor="middle" x="238" y="-508.3" font-family="Times,serif" font-size="14.00">生成私钥向量 s (V.noise)</text>
</g>
<!-- seedExpansion&#45;&gt;sampleSecret -->
<g id="edge4" class="edge">
<title>seedExpansion&#45;&gt;sampleSecret</title>
<path fill="none" stroke="black" d="M242.79,-580.8C241.96,-569.16 240.86,-553.55 239.92,-540.24"/>
<polygon fill="black" stroke="black" points="243.41,-539.9 239.21,-530.18 236.43,-540.4 243.41,-539.9"/>
</g>
<!-- sampleSecret&#45;&gt;computeTh -->
<g id="edge5" class="edge">
<title>sampleSecret&#45;&gt;computeTh</title>
<path fill="none" stroke="black" d="M261.68,-493.8C279.36,-480.95 303.72,-463.26 323.11,-449.17"/>
<polygon fill="black" stroke="black" points="325.33,-451.88 331.36,-443.18 321.21,-446.22 325.33,-451.88"/>
</g>
<!-- decaps -->
<g id="node12" class="node">
<title>decaps</title>
<path fill="none" stroke="black" d="M233.5,-443C233.5,-443 30.5,-443 30.5,-443 24.5,-443 18.5,-437 18.5,-431 18.5,-431 18.5,-419 18.5,-419 18.5,-413 24.5,-407 30.5,-407 30.5,-407 233.5,-407 233.5,-407 239.5,-407 245.5,-413 245.5,-419 245.5,-419 245.5,-431 245.5,-431 245.5,-437 239.5,-443 233.5,-443"/>
<text text-anchor="middle" x="132" y="-421.3" font-family="Times,serif" font-size="14.00">私钥解封装 (SecretKey.decaps)</text>
</g>
<!-- sampleSecret&#45;&gt;decaps -->
<g id="edge17" class="edge">
<title>sampleSecret&#45;&gt;decaps</title>
<path fill="none" stroke="black" d="M216.55,-493.8C200.74,-481.13 179.06,-463.73 161.6,-449.74"/>
<polygon fill="black" stroke="black" points="163.41,-446.7 153.42,-443.18 159.03,-452.16 163.41,-446.7"/>
<text text-anchor="middle" x="234" y="-464.8" font-family="Times,serif" font-size="14.00">私钥参与解密</text>
</g>
<!-- encaps -->
<g id="node7" class="node">
<title>encaps</title>
<path fill="none" stroke="black" d="M450.5,-356C450.5,-356 263.5,-356 263.5,-356 257.5,-356 251.5,-350 251.5,-344 251.5,-344 251.5,-332 251.5,-332 251.5,-326 257.5,-320 263.5,-320 263.5,-320 450.5,-320 450.5,-320 456.5,-320 462.5,-326 462.5,-332 462.5,-332 462.5,-344 462.5,-344 462.5,-350 456.5,-356 450.5,-356"/>
<text text-anchor="middle" x="357" y="-334.3" font-family="Times,serif" font-size="14.00">公钥封装 (PublicKey.encaps)</text>
</g>
<!-- computeTh&#45;&gt;encaps -->
<g id="edge16" class="edge">
<title>computeTh&#45;&gt;encaps</title>
<path fill="none" stroke="black" d="M355.4,-406.8C355.68,-395.16 356.05,-379.55 356.36,-366.24"/>
<polygon fill="black" stroke="black" points="359.86,-366.26 356.6,-356.18 352.86,-366.09 359.86,-366.26"/>
<text text-anchor="middle" x="399" y="-377.8" font-family="Times,serif" font-size="14.00">公钥参与加密</text>
</g>
<!-- generateM -->
<g id="node8" class="node">
<title>generateM</title>
<path fill="none" stroke="black" d="M433.5,-283C433.5,-283 280.5,-283 280.5,-283 274.5,-283 268.5,-277 268.5,-271 268.5,-271 268.5,-259 268.5,-259 268.5,-253 274.5,-247 280.5,-247 280.5,-247 433.5,-247 433.5,-247 439.5,-247 445.5,-253 445.5,-259 445.5,-259 445.5,-271 445.5,-271 445.5,-277 439.5,-283 433.5,-283"/>
<text text-anchor="middle" x="357" y="-261.3" font-family="Times,serif" font-size="14.00">生成 m (随机或哈希种子)</text>
</g>
<!-- encaps&#45;&gt;generateM -->
<g id="edge6" class="edge">
<title>encaps&#45;&gt;generateM</title>
<path fill="none" stroke="black" d="M357,-319.81C357,-311.79 357,-302.05 357,-293.07"/>
<polygon fill="black" stroke="black" points="360.5,-293.03 357,-283.03 353.5,-293.03 360.5,-293.03"/>
</g>
<!-- generateKR -->
<g id="node9" class="node">
<title>generateKR</title>
<path fill="none" stroke="black" d="M446,-210C446,-210 268,-210 268,-210 262,-210 256,-204 256,-198 256,-198 256,-186 256,-186 256,-180 262,-174 268,-174 268,-174 446,-174 446,-174 452,-174 458,-180 458,-186 458,-186 458,-198 458,-198 458,-204 452,-210 446,-210"/>
<text text-anchor="middle" x="357" y="-188.3" font-family="Times,serif" font-size="14.00">生成 (K&#39;, r) = G(m ‖ H(pk))</text>
</g>
<!-- generateM&#45;&gt;generateKR -->
<g id="edge7" class="edge">
<title>generateM&#45;&gt;generateKR</title>
<path fill="none" stroke="black" d="M357,-246.81C357,-238.79 357,-229.05 357,-220.07"/>
<polygon fill="black" stroke="black" points="360.5,-220.03 357,-210.03 353.5,-220.03 360.5,-220.03"/>
</g>
<!-- innerEncrypt -->
<g id="node10" class="node">
<title>innerEncrypt</title>
<path fill="none" stroke="black" d="M470,-123C470,-123 244,-123 244,-123 238,-123 232,-117 232,-111 232,-111 232,-99 232,-99 232,-93 238,-87 244,-87 244,-87 470,-87 470,-87 476,-87 482,-93 482,-99 482,-99 482,-111 482,-111 482,-117 476,-123 470,-123"/>
<text text-anchor="middle" x="357" y="-101.3" font-family="Times,serif" font-size="14.00">加密生成密文 ct (InnerPk.encrypt)</text>
</g>
<!-- generateKR&#45;&gt;innerEncrypt -->
<g id="edge8" class="edge">
<title>generateKR&#45;&gt;innerEncrypt</title>
<path fill="none" stroke="black" d="M357,-173.8C357,-162.16 357,-146.55 357,-133.24"/>
<polygon fill="black" stroke="black" points="360.5,-133.18 357,-123.18 353.5,-133.18 360.5,-133.18"/>
</g>
<!-- deriveSharedSecret -->
<g id="node11" class="node">
<title>deriveSharedSecret</title>
<path fill="none" stroke="black" d="M476,-36C476,-36 238,-36 238,-36 232,-36 226,-30 226,-24 226,-24 226,-12 226,-12 226,-6 232,0 238,0 238,0 476,0 476,0 482,0 488,-6 488,-12 488,-12 488,-24 488,-24 488,-30 482,-36 476,-36"/>
<text text-anchor="middle" x="357" y="-14.3" font-family="Times,serif" font-size="14.00">生成共享密钥 (K&#39; 或 KDF(K&#39; ‖ H(ct)))</text>
</g>
<!-- innerEncrypt&#45;&gt;deriveSharedSecret -->
<g id="edge9" class="edge">
<title>innerEncrypt&#45;&gt;deriveSharedSecret</title>
<path fill="none" stroke="black" d="M357,-86.8C357,-75.16 357,-59.55 357,-46.24"/>
<polygon fill="black" stroke="black" points="360.5,-46.18 357,-36.18 353.5,-46.18 360.5,-46.18"/>
<text text-anchor="middle" x="434" y="-57.8" font-family="Times,serif" font-size="14.00">ML&#45;KEM/标准模式分支</text>
</g>
<!-- decryptM -->
<g id="node13" class="node">
<title>decryptM</title>
<path fill="none" stroke="black" d="M221.5,-356C221.5,-356 20.5,-356 20.5,-356 14.5,-356 8.5,-350 8.5,-344 8.5,-344 8.5,-332 8.5,-332 8.5,-326 14.5,-320 20.5,-320 20.5,-320 221.5,-320 221.5,-320 227.5,-320 233.5,-326 233.5,-332 233.5,-332 233.5,-344 233.5,-344 233.5,-350 227.5,-356 221.5,-356"/>
<text text-anchor="middle" x="121" y="-334.3" font-family="Times,serif" font-size="14.00">解密得到 m&#39; (InnerSk.decrypt)</text>
</g>
<!-- decaps&#45;&gt;decryptM -->
<g id="edge10" class="edge">
<title>decaps&#45;&gt;decryptM</title>
<path fill="none" stroke="black" d="M129.77,-406.8C128.27,-395.16 126.25,-379.55 124.52,-366.24"/>
<polygon fill="black" stroke="black" points="127.98,-365.64 123.22,-356.18 121.04,-366.54 127.98,-365.64"/>
</g>
<!-- regenerateKR2 -->
<g id="node14" class="node">
<title>regenerateKR2</title>
<path fill="none" stroke="black" d="M230,-283C230,-283 12,-283 12,-283 6,-283 0,-277 0,-271 0,-271 0,-259 0,-259 0,-253 6,-247 12,-247 12,-247 230,-247 230,-247 236,-247 242,-253 242,-259 242,-259 242,-271 242,-271 242,-277 236,-283 230,-283"/>
<text text-anchor="middle" x="121" y="-261.3" font-family="Times,serif" font-size="14.00">重新生成 (K&#39;&#39;, r&#39;) = G(m&#39; ‖ H(pk))</text>
</g>
<!-- decryptM&#45;&gt;regenerateKR2 -->
<g id="edge11" class="edge">
<title>decryptM&#45;&gt;regenerateKR2</title>
<path fill="none" stroke="black" d="M121,-319.81C121,-311.79 121,-302.05 121,-293.07"/>
<polygon fill="black" stroke="black" points="124.5,-293.03 121,-283.03 117.5,-293.03 124.5,-293.03"/>
</g>
<!-- compareCT -->
<g id="node15" class="node">
<title>compareCT</title>
<path fill="none" stroke="black" d="M160,-210C160,-210 82,-210 82,-210 76,-210 70,-204 70,-198 70,-198 70,-186 70,-186 70,-180 76,-174 82,-174 82,-174 160,-174 160,-174 166,-174 172,-180 172,-186 172,-186 172,-198 172,-198 172,-204 166,-210 160,-210"/>
<text text-anchor="middle" x="121" y="-188.3" font-family="Times,serif" font-size="14.00">比较 ct 和 ct&#39;</text>
</g>
<!-- regenerateKR2&#45;&gt;compareCT -->
<g id="edge12" class="edge">
<title>regenerateKR2&#45;&gt;compareCT</title>
<path fill="none" stroke="black" d="M121,-246.81C121,-238.79 121,-229.05 121,-220.07"/>
<polygon fill="black" stroke="black" points="124.5,-220.03 121,-210.03 117.5,-220.03 124.5,-220.03"/>
</g>
<!-- replaceK -->
<g id="node16" class="node">
<title>replaceK</title>
<path fill="none" stroke="black" d="M171.5,-123C171.5,-123 70.5,-123 70.5,-123 64.5,-123 58.5,-117 58.5,-111 58.5,-111 58.5,-99 58.5,-99 58.5,-93 64.5,-87 70.5,-87 70.5,-87 171.5,-87 171.5,-87 177.5,-87 183.5,-93 183.5,-99 183.5,-99 183.5,-111 183.5,-111 183.5,-117 177.5,-123 171.5,-123"/>
<text text-anchor="middle" x="121" y="-101.3" font-family="Times,serif" font-size="14.00">条件替换 K&#39;&#39; 为 z</text>
</g>
<!-- compareCT&#45;&gt;replaceK -->
<g id="edge13" class="edge">
<title>compareCT&#45;&gt;replaceK</title>
<path fill="none" stroke="black" d="M121,-173.8C121,-162.16 121,-146.55 121,-133.24"/>
<polygon fill="black" stroke="black" points="124.5,-133.18 121,-123.18 117.5,-133.18 124.5,-133.18"/>
<text text-anchor="middle" x="147" y="-144.8" font-family="Times,serif" font-size="14.00">ct ≠ ct&#39;</text>
</g>
<!-- finalSharedSecret -->
<g id="node17" class="node">
<title>finalSharedSecret</title>
<path fill="none" stroke="black" d="M174.5,-36C174.5,-36 67.5,-36 67.5,-36 61.5,-36 55.5,-30 55.5,-24 55.5,-24 55.5,-12 55.5,-12 55.5,-6 61.5,0 67.5,0 67.5,0 174.5,0 174.5,0 180.5,0 186.5,-6 186.5,-12 186.5,-12 186.5,-24 186.5,-24 186.5,-30 180.5,-36 174.5,-36"/>
<text text-anchor="middle" x="121" y="-14.3" font-family="Times,serif" font-size="14.00">生成最终共享密钥</text>
</g>
<!-- replaceK&#45;&gt;finalSharedSecret -->
<g id="edge14" class="edge">
<title>replaceK&#45;&gt;finalSharedSecret</title>
<path fill="none" stroke="black" d="M121,-86.8C121,-75.16 121,-59.55 121,-46.24"/>
<polygon fill="black" stroke="black" points="124.5,-46.18 121,-36.18 117.5,-46.18 124.5,-46.18"/>
</g>
</g>
</svg>
