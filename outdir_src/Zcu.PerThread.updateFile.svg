<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: updateFile_flowchart Pages: 1 -->
<svg width="470pt" height="1457pt"
 viewBox="0.00 0.00 470.00 1457.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1453)">
<title>updateFile_flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1453 466,-1453 466,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="197.5,-1449 85.5,-1449 85.5,-1413 197.5,-1413 197.5,-1449"/>
<text text-anchor="middle" x="141.5" y="-1427.3" font-family="Arial" font-size="14.00">Start updateFile</text>
</g>
<!-- initial_checks -->
<g id="node2" class="node">
<title>initial_checks</title>
<polygon fill="none" stroke="black" points="230,-1376 53,-1376 53,-1323 230,-1323 230,-1376"/>
<text text-anchor="middle" x="141.5" y="-1360.8" font-family="Arial" font-size="14.00">Initial checks:</text>
<text text-anchor="middle" x="141.5" y="-1345.8" font-family="Arial" font-size="14.00">&#45; dev.check(.ast_gen)</text>
<text text-anchor="middle" x="141.5" y="-1330.8" font-family="Arial" font-size="14.00">&#45; Assert non&#45;builtin module</text>
</g>
<!-- start&#45;&gt;initial_checks -->
<g id="edge1" class="edge">
<title>start&#45;&gt;initial_checks</title>
<path fill="none" stroke="black" d="M141.5,-1412.75C141.5,-1404.99 141.5,-1395.51 141.5,-1386.32"/>
<polygon fill="black" stroke="black" points="145,-1386.18 141.5,-1376.18 138,-1386.18 145,-1386.18"/>
</g>
<!-- open_file -->
<g id="node3" class="node">
<title>open_file</title>
<polygon fill="none" stroke="black" points="199.5,-1286 83.5,-1286 83.5,-1248 199.5,-1248 199.5,-1286"/>
<text text-anchor="middle" x="141.5" y="-1270.8" font-family="Arial" font-size="14.00">Open source file</text>
<text text-anchor="middle" x="141.5" y="-1255.8" font-family="Arial" font-size="14.00">Get file stat</text>
</g>
<!-- initial_checks&#45;&gt;open_file -->
<g id="edge2" class="edge">
<title>initial_checks&#45;&gt;open_file</title>
<path fill="none" stroke="black" d="M141.5,-1322.59C141.5,-1314.31 141.5,-1305.11 141.5,-1296.65"/>
<polygon fill="black" stroke="black" points="145,-1296.47 141.5,-1286.47 138,-1296.47 145,-1296.47"/>
</g>
<!-- decide_lock -->
<g id="node4" class="node">
<title>decide_lock</title>
<polygon fill="none" stroke="black" points="283,-1211 0,-1211 0,-1158 283,-1158 283,-1211"/>
<text text-anchor="middle" x="141.5" y="-1195.8" font-family="Arial" font-size="14.00">Check file.status:</text>
<text text-anchor="middle" x="141.5" y="-1180.8" font-family="Arial" font-size="14.00">&#45; never_loaded/retry_failure → Shared lock</text>
<text text-anchor="middle" x="141.5" y="-1165.8" font-family="Arial" font-size="14.00">&#45; astgen_failure/success → Check metadata</text>
</g>
<!-- open_file&#45;&gt;decide_lock -->
<g id="edge3" class="edge">
<title>open_file&#45;&gt;decide_lock</title>
<path fill="none" stroke="black" d="M141.5,-1247.73C141.5,-1239.85 141.5,-1230.34 141.5,-1221.15"/>
<polygon fill="black" stroke="black" points="145,-1221.02 141.5,-1211.02 138,-1221.02 145,-1221.02"/>
</g>
<!-- metadata_unchanged -->
<g id="node5" class="node">
<title>metadata_unchanged</title>
<polygon fill="none" stroke="black" points="141.5,-1121 1.58,-1103 141.5,-1085 281.42,-1103 141.5,-1121"/>
<text text-anchor="middle" x="141.5" y="-1099.3" font-family="Arial" font-size="14.00">Metadata unchanged?</text>
</g>
<!-- decide_lock&#45;&gt;metadata_unchanged -->
<g id="edge4" class="edge">
<title>decide_lock&#45;&gt;metadata_unchanged</title>
<path fill="none" stroke="black" d="M141.5,-1157.91C141.5,-1149.48 141.5,-1140.08 141.5,-1131.52"/>
<polygon fill="black" stroke="black" points="145,-1131.26 141.5,-1121.26 138,-1131.26 145,-1131.26"/>
</g>
<!-- return_early -->
<g id="node6" class="node">
<title>return_early</title>
<polygon fill="none" stroke="black" points="160.5,-978 70.5,-978 70.5,-942 160.5,-942 160.5,-978"/>
<text text-anchor="middle" x="115.5" y="-956.3" font-family="Arial" font-size="14.00">Return early</text>
</g>
<!-- metadata_unchanged&#45;&gt;return_early -->
<g id="edge5" class="edge">
<title>metadata_unchanged&#45;&gt;return_early</title>
<path fill="none" stroke="black" d="M138.42,-1085.27C134,-1061.34 125.84,-1017.05 120.54,-988.32"/>
<polygon fill="black" stroke="black" points="123.92,-987.35 118.66,-978.15 117.03,-988.62 123.92,-987.35"/>
<text text-anchor="middle" x="147" y="-1055.8" font-family="Arial" font-size="14.00">Yes</text>
</g>
<!-- clear_errors -->
<g id="node7" class="node">
<title>clear_errors</title>
<polygon fill="none" stroke="black" points="272.5,-1034 148.5,-1034 148.5,-996 272.5,-996 272.5,-1034"/>
<text text-anchor="middle" x="210.5" y="-1018.8" font-family="Arial" font-size="14.00">Lock and clear</text>
<text text-anchor="middle" x="210.5" y="-1003.8" font-family="Arial" font-size="14.00">file compile errors</text>
</g>
<!-- metadata_unchanged&#45;&gt;clear_errors -->
<g id="edge6" class="edge">
<title>metadata_unchanged&#45;&gt;clear_errors</title>
<path fill="none" stroke="black" d="M154.16,-1086.23C164.04,-1073.9 178,-1056.51 189.54,-1042.12"/>
<polygon fill="black" stroke="black" points="192.49,-1044.04 196.01,-1034.05 187.03,-1039.66 192.49,-1044.04"/>
<text text-anchor="middle" x="189.5" y="-1055.8" font-family="Arial" font-size="14.00">No</text>
</g>
<!-- end -->
<g id="node19" class="node">
<title>end</title>
<polygon fill="none" stroke="black" points="147.5,-36 93.5,-36 93.5,0 147.5,0 147.5,-36"/>
<text text-anchor="middle" x="120.5" y="-14.3" font-family="Arial" font-size="14.00">End</text>
</g>
<!-- return_early&#45;&gt;end -->
<g id="edge7" class="edge">
<title>return_early&#45;&gt;end</title>
<path fill="none" stroke="black" d="M113.4,-941.92C111.34,-923.66 108.5,-893.83 108.5,-868 108.5,-868 108.5,-868 108.5,-91 108.5,-76 111.07,-59.48 113.82,-46.05"/>
<polygon fill="black" stroke="black" points="117.3,-46.55 116.03,-36.03 110.46,-45.05 117.3,-46.55"/>
</g>
<!-- preserve_prev_zir -->
<g id="node8" class="node">
<title>preserve_prev_zir</title>
<polygon fill="none" stroke="black" points="299,-924 148,-924 148,-886 299,-886 299,-924"/>
<text text-anchor="middle" x="223.5" y="-908.8" font-family="Arial" font-size="14.00">Preserve previous ZIR</text>
<text text-anchor="middle" x="223.5" y="-893.8" font-family="Arial" font-size="14.00">if needed</text>
</g>
<!-- clear_errors&#45;&gt;preserve_prev_zir -->
<g id="edge8" class="edge">
<title>clear_errors&#45;&gt;preserve_prev_zir</title>
<path fill="none" stroke="black" d="M212.71,-995.68C214.73,-978.82 217.77,-953.57 220.11,-934.15"/>
<polygon fill="black" stroke="black" points="223.61,-934.4 221.33,-924.05 216.66,-933.56 223.61,-934.4"/>
</g>
<!-- unload_resources -->
<g id="node9" class="node">
<title>unload_resources</title>
<polygon fill="none" stroke="black" points="345.5,-849 149.5,-849 149.5,-813 345.5,-813 345.5,-849"/>
<text text-anchor="middle" x="247.5" y="-827.3" font-family="Arial" font-size="14.00">Unload source/AST/ZIR/ZOIR</text>
</g>
<!-- preserve_prev_zir&#45;&gt;unload_resources -->
<g id="edge9" class="edge">
<title>preserve_prev_zir&#45;&gt;unload_resources</title>
<path fill="none" stroke="black" d="M229.56,-885.83C232.26,-877.72 235.5,-867.99 238.48,-859.05"/>
<polygon fill="black" stroke="black" points="241.85,-860.01 241.69,-849.42 235.21,-857.8 241.85,-860.01"/>
</g>
<!-- create_cache_file -->
<g id="node10" class="node">
<title>create_cache_file</title>
<polygon fill="none" stroke="black" points="384.5,-776 136.5,-776 136.5,-738 384.5,-738 384.5,-776"/>
<text text-anchor="middle" x="260.5" y="-760.8" font-family="Arial" font-size="14.00">Create/open cache file</text>
<text text-anchor="middle" x="260.5" y="-745.8" font-family="Arial" font-size="14.00">Handle macOS ENOENT special case</text>
</g>
<!-- unload_resources&#45;&gt;create_cache_file -->
<g id="edge10" class="edge">
<title>unload_resources&#45;&gt;create_cache_file</title>
<path fill="none" stroke="black" d="M250.58,-812.94C252.02,-804.99 253.76,-795.31 255.39,-786.31"/>
<polygon fill="black" stroke="black" points="258.88,-786.66 257.21,-776.2 251.99,-785.42 258.88,-786.66"/>
</g>
<!-- load_cache -->
<g id="node11" class="node">
<title>load_cache</title>
<polygon fill="none" stroke="black" points="336,-672 187,-672 187,-634 336,-634 336,-672"/>
<text text-anchor="middle" x="261.5" y="-656.8" font-family="Arial" font-size="14.00">Load ZIR/ZOIR cache</text>
<text text-anchor="middle" x="261.5" y="-641.8" font-family="Arial" font-size="14.00">Check result</text>
</g>
<!-- create_cache_file&#45;&gt;load_cache -->
<g id="edge11" class="edge">
<title>create_cache_file&#45;&gt;load_cache</title>
<path fill="none" stroke="black" d="M258.68,-737.7C258.19,-732.04 257.74,-725.76 257.5,-720 256.95,-706.68 256.76,-703.31 257.5,-690 257.63,-687.56 257.82,-685.04 258.04,-682.51"/>
<polygon fill="black" stroke="black" points="261.55,-682.58 259.07,-672.28 254.58,-681.88 261.55,-682.58"/>
</g>
<!-- create_cache_file&#45;&gt;load_cache -->
<g id="edge23" class="edge">
<title>create_cache_file&#45;&gt;load_cache</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M260.68,-737.76C260.83,-722.32 261.05,-699.91 261.22,-682.16"/>
<polygon fill="black" stroke="black" points="264.72,-682.11 261.32,-672.08 257.72,-682.04 264.72,-682.11"/>
<text text-anchor="middle" x="315.5" y="-708.8" font-family="Arial" font-size="14.00">Retry on</text>
<text text-anchor="middle" x="315.5" y="-693.8" font-family="Arial" font-size="14.00">PathAlreadyExists</text>
</g>
<!-- load_cache&#45;&gt;load_cache -->
<g id="edge22" class="edge">
<title>load_cache&#45;&gt;load_cache</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M336.26,-659.06C346.88,-658.08 354,-656.06 354,-653 354,-651.04 351.08,-649.51 346.19,-648.4"/>
<polygon fill="black" stroke="black" points="346.67,-644.93 336.26,-646.94 345.65,-651.86 346.67,-644.93"/>
<text text-anchor="middle" x="408" y="-656.8" font-family="Arial" font-size="14.00">Retry if</text>
<text text-anchor="middle" x="408" y="-641.8" font-family="Arial" font-size="14.00">macOS ENOENT</text>
</g>
<!-- cache_valid -->
<g id="node12" class="node">
<title>cache_valid</title>
<polygon fill="none" stroke="black" points="261.5,-597 174.36,-579 261.5,-561 348.64,-579 261.5,-597"/>
<text text-anchor="middle" x="261.5" y="-575.3" font-family="Arial" font-size="14.00">Cache valid?</text>
</g>
<!-- load_cache&#45;&gt;cache_valid -->
<g id="edge12" class="edge">
<title>load_cache&#45;&gt;cache_valid</title>
<path fill="none" stroke="black" d="M261.5,-633.83C261.5,-625.89 261.5,-616.41 261.5,-607.63"/>
<polygon fill="black" stroke="black" points="265,-607.42 261.5,-597.42 258,-607.42 265,-607.42"/>
</g>
<!-- need_update -->
<g id="node13" class="node">
<title>need_update</title>
<polygon fill="none" stroke="black" points="231.5,-510 138.83,-492 231.5,-474 324.17,-492 231.5,-510"/>
<text text-anchor="middle" x="231.5" y="-488.3" font-family="Arial" font-size="14.00">Need update?</text>
</g>
<!-- cache_valid&#45;&gt;need_update -->
<g id="edge13" class="edge">
<title>cache_valid&#45;&gt;need_update</title>
<path fill="none" stroke="black" d="M255.86,-562.01C251.54,-549.78 245.5,-532.68 240.52,-518.56"/>
<polygon fill="black" stroke="black" points="243.75,-517.18 237.12,-508.92 237.15,-519.51 243.75,-517.18"/>
<text text-anchor="middle" x="284.5" y="-531.8" font-family="Arial" font-size="14.00">Invalid/Stale</text>
</g>
<!-- update_stats -->
<g id="node16" class="node">
<title>update_stats</title>
<polygon fill="none" stroke="black" points="349,-259 242,-259 242,-223 349,-223 349,-259"/>
<text text-anchor="middle" x="295.5" y="-237.3" font-family="Arial" font-size="14.00">Update file.stat</text>
</g>
<!-- cache_valid&#45;&gt;update_stats -->
<g id="edge14" class="edge">
<title>cache_valid&#45;&gt;update_stats</title>
<path fill="none" stroke="black" d="M289.97,-566.78C302,-561.01 315.5,-553.06 325.5,-543 343.31,-525.09 352.5,-518.26 352.5,-493 352.5,-493 352.5,-493 352.5,-314 352.5,-295.34 340.59,-278.7 327.65,-266.12"/>
<polygon fill="black" stroke="black" points="329.77,-263.31 320,-259.2 325.07,-268.51 329.77,-263.31"/>
<text text-anchor="middle" x="378.5" y="-400.3" font-family="Arial" font-size="14.00">Success</text>
</g>
<!-- read_source -->
<g id="node14" class="node">
<title>read_source</title>
<polygon fill="none" stroke="black" points="278,-423 137,-423 137,-385 278,-385 278,-423"/>
<text text-anchor="middle" x="207.5" y="-407.8" font-family="Arial" font-size="14.00">Read source content</text>
<text text-anchor="middle" x="207.5" y="-392.8" font-family="Arial" font-size="14.00">Parse AST</text>
</g>
<!-- need_update&#45;&gt;read_source -->
<g id="edge15" class="edge">
<title>need_update&#45;&gt;read_source</title>
<path fill="none" stroke="black" d="M226.99,-474.82C223.72,-463.11 219.22,-446.99 215.36,-433.18"/>
<polygon fill="black" stroke="black" points="218.63,-431.88 212.58,-423.19 211.89,-433.76 218.63,-431.88"/>
<text text-anchor="middle" x="233" y="-444.8" font-family="Arial" font-size="14.00">Yes</text>
</g>
<!-- need_update&#45;&gt;update_stats -->
<g id="edge16" class="edge">
<title>need_update&#45;&gt;update_stats</title>
<path fill="none" stroke="black" d="M247.86,-476.95C261.23,-464.34 279.22,-444.56 287.5,-423 307.22,-371.64 303.73,-305.97 299.54,-269.52"/>
<polygon fill="black" stroke="black" points="302.96,-268.68 298.24,-259.19 296.01,-269.55 302.96,-268.68"/>
<text text-anchor="middle" x="310.5" y="-355.8" font-family="Arial" font-size="14.00">No</text>
</g>
<!-- generate_zir_zoir -->
<g id="node15" class="node">
<title>generate_zir_zoir</title>
<polygon fill="none" stroke="black" points="277.5,-334 141.5,-334 141.5,-296 277.5,-296 277.5,-334"/>
<text text-anchor="middle" x="209.5" y="-318.8" font-family="Arial" font-size="14.00">Generate ZIR/ZOIR</text>
<text text-anchor="middle" x="209.5" y="-303.8" font-family="Arial" font-size="14.00">Save to cache</text>
</g>
<!-- read_source&#45;&gt;generate_zir_zoir -->
<g id="edge17" class="edge">
<title>read_source&#45;&gt;generate_zir_zoir</title>
<path fill="none" stroke="black" d="M207.91,-384.97C208.19,-373.19 208.54,-357.56 208.85,-344.16"/>
<polygon fill="black" stroke="black" points="212.36,-344.08 209.09,-334 205.36,-343.92 212.36,-344.08"/>
</g>
<!-- generate_zir_zoir&#45;&gt;update_stats -->
<g id="edge18" class="edge">
<title>generate_zir_zoir&#45;&gt;update_stats</title>
<path fill="none" stroke="black" d="M231.2,-295.83C242.12,-286.69 255.48,-275.5 267.2,-265.7"/>
<polygon fill="black" stroke="black" points="269.57,-268.27 274.99,-259.17 265.08,-262.91 269.57,-268.27"/>
</g>
<!-- check_errors -->
<g id="node17" class="node">
<title>check_errors</title>
<polygon fill="none" stroke="black" points="344.5,-186 180.5,-186 180.5,-148 344.5,-148 344.5,-186"/>
<text text-anchor="middle" x="262.5" y="-170.8" font-family="Arial" font-size="14.00">Check for compile errors</text>
<text text-anchor="middle" x="262.5" y="-155.8" font-family="Arial" font-size="14.00">Update file status</text>
</g>
<!-- update_stats&#45;&gt;check_errors -->
<g id="edge19" class="edge">
<title>update_stats&#45;&gt;check_errors</title>
<path fill="none" stroke="black" d="M287.68,-222.94C283.92,-214.73 279.31,-204.68 275.07,-195.43"/>
<polygon fill="black" stroke="black" points="278.19,-193.83 270.84,-186.2 271.83,-196.75 278.19,-193.83"/>
</g>
<!-- final_status -->
<g id="node18" class="node">
<title>final_status</title>
<polygon fill="none" stroke="black" points="286.5,-111 170.5,-111 170.5,-73 286.5,-73 286.5,-111"/>
<text text-anchor="middle" x="228.5" y="-95.8" font-family="Arial" font-size="14.00">Return based on</text>
<text text-anchor="middle" x="228.5" y="-80.8" font-family="Arial" font-size="14.00">final status</text>
</g>
<!-- check_errors&#45;&gt;final_status -->
<g id="edge20" class="edge">
<title>check_errors&#45;&gt;final_status</title>
<path fill="none" stroke="black" d="M254.1,-147.96C250.21,-139.62 245.52,-129.54 241.22,-120.3"/>
<polygon fill="black" stroke="black" points="244.32,-118.68 236.93,-111.09 237.98,-121.63 244.32,-118.68"/>
</g>
<!-- final_status&#45;&gt;end -->
<g id="edge21" class="edge">
<title>final_status&#45;&gt;end</title>
<path fill="none" stroke="black" d="M201.25,-72.83C187.14,-63.43 169.78,-51.86 154.78,-41.85"/>
<polygon fill="black" stroke="black" points="156.52,-38.81 146.26,-36.17 152.64,-44.63 156.52,-38.81"/>
</g>
</g>
</svg>
