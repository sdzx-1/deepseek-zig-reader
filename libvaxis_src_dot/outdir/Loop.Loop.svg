<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LoopFlow Pages: 1 -->
<svg width="957pt" height="820pt"
 viewBox="0.00 0.00 956.50 820.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 816)">
<title>LoopFlow</title>
<g id="clust1" class="cluster">
<title>cluster_Loop</title>
<polygon fill="transparent" stroke="black" points="8,-8 8,-804 308,-804 308,-8 8,-8"/>
<text text-anchor="middle" x="60.5" y="-788.8" font-family="Arial" font-size="14.00">Loop Structure</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_thread</title>
<polygon fill="transparent" stroke="black" points="16,-16 16,-560 239,-560 239,-16 16,-16"/>
<text text-anchor="middle" x="58" y="-544.8" font-family="Arial" font-size="14.00">ttyRun线程</text>
</g>
<!-- Init -->
<g id="node1" class="node">
<title>Init</title>
<polygon fill="#e8e8e8" stroke="black" points="282,-773 156,-773 156,-720 282,-720 282,-773"/>
<text text-anchor="middle" x="219" y="-757.8" font-family="Arial" font-size="14.00">init()</text>
<text text-anchor="middle" x="219" y="-742.8" font-family="Arial" font-size="14.00">&#45; 初始化信号处理</text>
<text text-anchor="middle" x="219" y="-727.8" font-family="Arial" font-size="14.00">&#45; 注册winsize回调</text>
</g>
<!-- Start -->
<g id="node2" class="node">
<title>Start</title>
<polygon fill="#e8e8e8" stroke="black" points="274,-654 164,-654 164,-616 274,-616 274,-654"/>
<text text-anchor="middle" x="219" y="-638.8" font-family="Arial" font-size="14.00">start()</text>
<text text-anchor="middle" x="219" y="-623.8" font-family="Arial" font-size="14.00">&#45; 创建输入线程</text>
</g>
<!-- Init&#45;&gt;Start -->
<g id="edge8" class="edge">
<title>Init&#45;&gt;Start</title>
<path fill="none" stroke="#2e3440" d="M219,-719.83C219,-703.18 219,-681.48 219,-664.33"/>
<polygon fill="#2e3440" stroke="#2e3440" points="222.5,-664.33 219,-654.33 215.5,-664.33 222.5,-664.33"/>
<text text-anchor="middle" x="248" y="-690.8" font-family="Arial" font-size="14.00">用户调用</text>
</g>
<!-- TtyRunStart -->
<g id="node9" class="node">
<title>TtyRunStart</title>
<polygon fill="#e8e8e8" stroke="black" points="204,-529 46,-529 46,-491 204,-491 204,-529"/>
<text text-anchor="middle" x="125" y="-513.8" font-family="Arial" font-size="14.00">ttyRun()</text>
<text text-anchor="middle" x="125" y="-498.8" font-family="Arial" font-size="14.00">&#45; 初始化grapheme缓存</text>
</g>
<!-- Start&#45;&gt;TtyRunStart -->
<g id="edge9" class="edge">
<title>Start&#45;&gt;TtyRunStart</title>
<path fill="none" stroke="#2e3440" d="M214.89,-615.97C211.08,-601.97 204.41,-582.55 194,-568 185.19,-555.7 173.11,-544.51 161.51,-535.36"/>
<polygon fill="#2e3440" stroke="#2e3440" points="163.29,-532.32 153.2,-529.08 159.06,-537.9 163.29,-532.32"/>
<text text-anchor="middle" x="232" y="-571.8" font-family="Arial" font-size="14.00">创建线程</text>
</g>
<!-- Stop -->
<g id="node3" class="node">
<title>Stop</title>
<polygon fill="#e8e8e8" stroke="black" points="143,-669 33,-669 33,-601 143,-601 143,-669"/>
<text text-anchor="middle" x="88" y="-653.8" font-family="Arial" font-size="14.00">stop()</text>
<text text-anchor="middle" x="88" y="-638.8" font-family="Arial" font-size="14.00">&#45; 设置退出标志</text>
<text text-anchor="middle" x="88" y="-623.8" font-family="Arial" font-size="14.00">&#45; 触发状态报告</text>
<text text-anchor="middle" x="88" y="-608.8" font-family="Arial" font-size="14.00">&#45; 等待线程结束</text>
</g>
<!-- Stop&#45;&gt;TtyRunStart -->
<g id="edge10" class="edge">
<title>Stop&#45;&gt;TtyRunStart</title>
<path fill="none" stroke="#2e3440" d="M85.27,-590.9C85.73,-583.16 86.84,-575.26 89,-568 93.21,-553.87 101.99,-539.84 109.83,-529.23"/>
<polygon fill="#2e3440" stroke="#2e3440" points="81.77,-590.81 85,-600.9 88.77,-591 81.77,-590.81"/>
<text text-anchor="middle" x="139.5" y="-571.8" font-family="Arial" font-size="14.00">should_quit=true</text>
</g>
<!-- NextEvent -->
<g id="node4" class="node">
<title>NextEvent</title>
<polygon fill="#e8e8e8" stroke="black" points="677,-62 567,-62 567,-24 677,-24 677,-62"/>
<text text-anchor="middle" x="622" y="-46.8" font-family="Arial" font-size="14.00">nextEvent()</text>
<text text-anchor="middle" x="622" y="-31.8" font-family="Arial" font-size="14.00">&#45; 阻塞获取事件</text>
</g>
<!-- PollEvent -->
<g id="node5" class="node">
<title>PollEvent</title>
<polygon fill="#e8e8e8" stroke="black" points="805,-62 695,-62 695,-24 805,-24 805,-62"/>
<text text-anchor="middle" x="750" y="-46.8" font-family="Arial" font-size="14.00">pollEvent()</text>
<text text-anchor="middle" x="750" y="-31.8" font-family="Arial" font-size="14.00">&#45; 阻塞等待事件</text>
</g>
<!-- TryEvent -->
<g id="node6" class="node">
<title>TryEvent</title>
<polygon fill="#e8e8e8" stroke="black" points="948.5,-62 823.5,-62 823.5,-24 948.5,-24 948.5,-62"/>
<text text-anchor="middle" x="886" y="-46.8" font-family="Arial" font-size="14.00">tryEvent()</text>
<text text-anchor="middle" x="886" y="-31.8" font-family="Arial" font-size="14.00">&#45; 非阻塞获取事件</text>
</g>
<!-- PostEvent -->
<g id="node7" class="node">
<title>PostEvent</title>
<polygon fill="#e8e8e8" stroke="black" points="684.5,-151 559.5,-151 559.5,-113 684.5,-113 684.5,-151"/>
<text text-anchor="middle" x="622" y="-135.8" font-family="Arial" font-size="14.00">postEvent()</text>
<text text-anchor="middle" x="622" y="-120.8" font-family="Arial" font-size="14.00">&#45; 推送事件到队列</text>
</g>
<!-- PostEvent&#45;&gt;NextEvent -->
<g id="edge11" class="edge">
<title>PostEvent&#45;&gt;NextEvent</title>
<path fill="none" stroke="#2e3440" stroke-dasharray="5,2" d="M622,-112.97C622,-101.19 622,-85.56 622,-72.16"/>
<polygon fill="#2e3440" stroke="#2e3440" points="625.5,-72 622,-62 618.5,-72 625.5,-72"/>
<text text-anchor="middle" x="651" y="-83.8" font-family="Arial" font-size="14.00">队列操作</text>
</g>
<!-- WinsizeCB -->
<g id="node8" class="node">
<title>WinsizeCB</title>
<polygon fill="#e8e8e8" stroke="black" points="455.5,-151 316.5,-151 316.5,-113 455.5,-113 455.5,-151"/>
<text text-anchor="middle" x="386" y="-135.8" font-family="Arial" font-size="14.00">winsizeCallback()</text>
<text text-anchor="middle" x="386" y="-120.8" font-family="Arial" font-size="14.00">&#45; 处理窗口尺寸变化</text>
</g>
<!-- WinsizeCB&#45;&gt;PostEvent -->
<g id="edge12" class="edge">
<title>WinsizeCB&#45;&gt;PostEvent</title>
<path fill="none" stroke="#2e3440" d="M455.53,-132C484.96,-132 519.27,-132 549.06,-132"/>
<polygon fill="#2e3440" stroke="#2e3440" points="549.4,-135.5 559.4,-132 549.4,-128.5 549.4,-135.5"/>
<text text-anchor="middle" x="507.5" y="-138.8" font-family="Arial" font-size="14.00">窗口变化事件</text>
</g>
<!-- OSDecision -->
<g id="node10" class="node">
<title>OSDecision</title>
<polygon fill="#e8e8e8" stroke="black" points="125,-454 23.79,-436 125,-418 226.21,-436 125,-454"/>
<text text-anchor="middle" x="125" y="-432.3" font-family="Arial" font-size="14.00">操作系统类型?</text>
</g>
<!-- TtyRunStart&#45;&gt;OSDecision -->
<g id="edge1" class="edge">
<title>TtyRunStart&#45;&gt;OSDecision</title>
<path fill="none" stroke="black" d="M125,-490.83C125,-482.89 125,-473.41 125,-464.63"/>
<polygon fill="black" stroke="black" points="128.5,-464.42 125,-454.42 121.5,-464.42 128.5,-464.42"/>
</g>
<!-- WindowsBranch -->
<g id="node11" class="node">
<title>WindowsBranch</title>
<polygon fill="#e8e8e8" stroke="black" points="179,-367 69,-367 69,-329 179,-329 179,-367"/>
<text text-anchor="middle" x="124" y="-351.8" font-family="Arial" font-size="14.00">Windows分支</text>
<text text-anchor="middle" x="124" y="-336.8" font-family="Arial" font-size="14.00">&#45; 持续解析事件</text>
</g>
<!-- OSDecision&#45;&gt;WindowsBranch -->
<g id="edge2" class="edge">
<title>OSDecision&#45;&gt;WindowsBranch</title>
<path fill="none" stroke="black" d="M123.83,-417.92C123.49,-412.22 123.17,-405.84 123,-400 122.79,-392.74 122.82,-384.91 122.95,-377.6"/>
<polygon fill="black" stroke="black" points="126.46,-377.5 123.21,-367.41 119.46,-377.32 126.46,-377.5"/>
<text text-anchor="middle" x="151" y="-388.8" font-family="Arial" font-size="14.00">Windows</text>
</g>
<!-- UnixBranch -->
<g id="node12" class="node">
<title>UnixBranch</title>
<polygon fill="#e8e8e8" stroke="black" points="150,-311 24,-311 24,-258 150,-258 150,-311"/>
<text text-anchor="middle" x="87" y="-295.8" font-family="Arial" font-size="14.00">Unix分支</text>
<text text-anchor="middle" x="87" y="-280.8" font-family="Arial" font-size="14.00">&#45; 获取初始winsize</text>
<text text-anchor="middle" x="87" y="-265.8" font-family="Arial" font-size="14.00">&#45; 进入读取循环</text>
</g>
<!-- OSDecision&#45;&gt;UnixBranch -->
<g id="edge3" class="edge">
<title>OSDecision&#45;&gt;UnixBranch</title>
<path fill="none" stroke="black" d="M90.38,-424.04C79.06,-418.65 67.69,-410.9 61,-400 58.94,-396.64 59.75,-329.87 60,-329 60.85,-326.02 61.97,-323.04 63.27,-320.13"/>
<polygon fill="black" stroke="black" points="66.46,-321.57 67.93,-311.07 60.24,-318.37 66.46,-321.57"/>
<text text-anchor="middle" x="90" y="-388.8" font-family="Arial" font-size="14.00">其他系统</text>
</g>
<!-- HandleEvent -->
<g id="node15" class="node">
<title>HandleEvent</title>
<polygon fill="#e8e8e8" stroke="black" points="231.5,-240 82.5,-240 82.5,-202 231.5,-202 231.5,-240"/>
<text text-anchor="middle" x="157" y="-224.8" font-family="Arial" font-size="14.00">handleEventGeneric()</text>
<text text-anchor="middle" x="157" y="-209.8" font-family="Arial" font-size="14.00">&#45; 事件处理逻辑</text>
</g>
<!-- WindowsBranch&#45;&gt;HandleEvent -->
<g id="edge15" class="edge">
<title>WindowsBranch&#45;&gt;HandleEvent</title>
<path fill="none" stroke="#2e3440" d="M140.81,-328.79C144.85,-323.43 148.66,-317.3 151,-311 158.22,-291.55 159.53,-268.09 159.13,-250.14"/>
<polygon fill="#2e3440" stroke="#2e3440" points="162.62,-249.86 158.72,-240.02 155.63,-250.15 162.62,-249.86"/>
<text text-anchor="middle" x="189" y="-280.8" font-family="Arial" font-size="14.00">持续处理</text>
</g>
<!-- ReadLoop -->
<g id="node13" class="node">
<title>ReadLoop</title>
<ellipse fill="#e8e8e8" stroke="black" cx="73" cy="-132" rx="48.19" ry="18"/>
<text text-anchor="middle" x="73" y="-128.3" font-family="Arial" font-size="14.00">读取循环</text>
</g>
<!-- UnixBranch&#45;&gt;ReadLoop -->
<g id="edge4" class="edge">
<title>UnixBranch&#45;&gt;ReadLoop</title>
<path fill="none" stroke="black" d="M77.21,-257.6C75.46,-251.88 73.91,-245.8 73,-240 68.79,-213.15 69.39,-182.05 70.68,-160.32"/>
<polygon fill="black" stroke="black" points="74.18,-160.39 71.37,-150.18 67.2,-159.91 74.18,-160.39"/>
</g>
<!-- ReadLoop&#45;&gt;Stop -->
<g id="edge14" class="edge">
<title>ReadLoop&#45;&gt;Stop</title>
<path fill="none" stroke="#2e3440" d="M110.69,-143.28C155.18,-156.27 225.05,-179.64 240,-202 328.71,-334.63 304.66,-429.39 213,-560 209.1,-565.55 204.88,-563.29 200,-568 194.23,-573.56 196.01,-577.7 190,-583 189.03,-583.85 171.99,-592.44 152.1,-602.34"/>
<polygon fill="#2e3440" stroke="#2e3440" points="150.53,-599.21 143.13,-606.8 153.64,-605.48 150.53,-599.21"/>
<text text-anchor="middle" x="343" y="-388.8" font-family="Arial" font-size="14.00">should_quit检查</text>
</g>
<!-- ParseBuffer -->
<g id="node14" class="node">
<title>ParseBuffer</title>
<polygon fill="#e8e8e8" stroke="black" points="173,-62 63,-62 63,-24 173,-24 173,-62"/>
<text text-anchor="middle" x="118" y="-46.8" font-family="Arial" font-size="14.00">解析缓冲区</text>
<text text-anchor="middle" x="118" y="-31.8" font-family="Arial" font-size="14.00">&#45; 处理转义序列</text>
</g>
<!-- ReadLoop&#45;&gt;ParseBuffer -->
<g id="edge5" class="edge">
<title>ReadLoop&#45;&gt;ParseBuffer</title>
<path fill="none" stroke="black" d="M79,-114.08C82.83,-103.97 88.15,-90.99 94,-80 95.64,-76.92 97.47,-73.78 99.37,-70.69"/>
<polygon fill="black" stroke="black" points="102.34,-72.55 104.82,-62.25 96.46,-68.76 102.34,-72.55"/>
<text text-anchor="middle" x="123" y="-83.8" font-family="Arial" font-size="14.00">读取输入</text>
</g>
<!-- ParseBuffer&#45;&gt;HandleEvent -->
<g id="edge6" class="edge">
<title>ParseBuffer&#45;&gt;HandleEvent</title>
<path fill="none" stroke="black" d="M140,-62.27C144.81,-67.47 149.28,-73.5 152,-80 167.22,-116.37 165.17,-162.81 161.62,-191.99"/>
<polygon fill="black" stroke="black" points="158.15,-191.52 160.27,-201.9 165.08,-192.47 158.15,-191.52"/>
<text text-anchor="middle" x="194" y="-128.3" font-family="Arial" font-size="14.00">有效事件</text>
</g>
<!-- HandleEvent&#45;&gt;PostEvent -->
<g id="edge13" class="edge">
<title>HandleEvent&#45;&gt;PostEvent</title>
<path fill="none" stroke="#2e3440" stroke-dasharray="5,2" d="M231.71,-206.02C319.13,-189.67 462.9,-162.77 549.4,-146.58"/>
<polygon fill="#2e3440" stroke="#2e3440" points="550.22,-149.99 559.4,-144.71 548.93,-143.11 550.22,-149.99"/>
<text text-anchor="middle" x="446" y="-172.8" font-family="Arial" font-size="14.00">生成事件</text>
</g>
<!-- HandleEvent&#45;&gt;ReadLoop -->
<g id="edge7" class="edge">
<title>HandleEvent&#45;&gt;ReadLoop</title>
<path fill="none" stroke="black" d="M116.08,-201.9C108.02,-196.96 100.15,-191 94,-184 87.91,-177.07 83.43,-168.14 80.21,-159.69"/>
<polygon fill="black" stroke="black" points="83.5,-158.5 76.99,-150.14 76.87,-160.74 83.5,-158.5"/>
<text text-anchor="middle" x="123" y="-172.8" font-family="Arial" font-size="14.00">继续循环</text>
</g>
</g>
</svg>
