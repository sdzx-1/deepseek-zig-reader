graph TD
    A[开始] --> B[确定返回类型]
    B --> C{返回类型有效?}
    C -->|否| D[生成无效返回类型错误]
    C -->|是| E{调用约定允许Zig类型?}
    E -->|否| F[验证外部类型]
    F --> G{验证通过?}
    G -->|否| H[生成调用约定类型错误]
    E -->|是| I{comptime返回类型需参数检查?}
    I -->|是| J[遍历参数检查comptime]
    J --> K{所有参数comptime?}
    K -->|否| L[生成参数需comptime错误]
    K -->|是| M[验证栈对齐]
    I -->|否| M
    M --> N{栈对齐是2的幂次?}
    N -->|否| O[生成栈对齐错误]
    N -->|是| P[检查特定调用约定返回类型]
    P --> Q{返回类型匹配约定?}
    Q -->|否| R[生成返回类型不匹配错误]
    Q -->|是| S[检查调用约定支持]
    S --> T{架构/后端支持?}
    T -->|否| U[生成不支持调用约定错误]
    T -->|是| V{需要错误追踪?}
    V -->|是| W[解析StackTrace类型]
    V -->|否| X[生成最终Air引用]
    W --> X
    D --> Y[结束]
    H --> Y
    L --> Y
    O --> Y
    R --> Y
    U --> Y
    X --> Y
