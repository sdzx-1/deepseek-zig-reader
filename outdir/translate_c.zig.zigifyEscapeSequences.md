graph TD
    A[开始] --> B[获取source并处理起始引号]
    B --> C{检查是否有转义字符或制表符}
    C -- 无 --> D[直接返回source]
    C -- 有 --> E[分配双倍内存]
    E --> F[初始化状态机为start]
    F --> G[遍历每个字符]
    G --> H{当前状态}
    H -- start --> I{字符是\\或\t?}
    I -- 是 --> J[处理转义或制表符]
    J --> K[设置状态为escape或写入转义]
    K --> G
    I -- 否 --> L[直接写入字符]
    L --> G
    H -- escape --> M{处理转义类型}
    M -- 普通转义(n,r,t等) --> N[写入对应字符]
    M -- 八进制 --> O[记录数值并转状态到octal]
    M -- 十六进制 --> P[设置状态到hex]
    M -- 特殊字符(a,b,f,v) --> Q[写入对应十六进制值]
    M -- 未知转义 --> R[报错]
    N --> S[状态转回start]
    S --> G
    O --> G
    P --> G
    Q --> G
    R --> Error[返回ParseError]
    H -- hex --> T{处理十六进制数字}
    T -- 有效数字 --> U[累加数值]
    U --> G
    T -- 非数字 --> V[写入当前数值并重置状态]
    V --> G
    H -- octal --> W{处理八进制数字}
    W -- 有效且未满3位 --> X[累加数值]
    X --> G
    W -- 无效或已满3位 --> Y[写入数值并重置状态]
    Y --> G
    G --> Z{是否遍历完所有字符?}
    Z -- 否 --> G
    Z -- 是 --> AA{是否残留未处理数值?}
    AA -- 是 --> AB[写入剩余数值]
    AB --> AC[返回处理后的字节数组]
    AA -- 否 --> AC
