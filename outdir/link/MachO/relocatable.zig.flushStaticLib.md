flowchart TD
    A[开始] --> B[初始化]
    B --> C[收集链接输入]
    C --> D[添加C对象文件]
    D --> E[添加模块对象文件]
    E --> F[添加编译器运行时]
    F --> G[添加UBSAN运行时]
    G --> H[分类输入文件]
    H --> I{是否有错误?}
    I -->|是| J[返回LinkFailure]
    I -->|否| K[解析AR输入文件]
    K --> L{是否有错误?}
    L -->|是| J
    L -->|否| M{存在Zig对象?}
    M -->|是| N[处理Zig对象]
    N --> O[解析符号]
    O --> P[标记导出]
    P --> Q[处理未解决的引用]
    Q --> R[排序段]
    R --> S[添加原子到段]
    S --> T[计算段大小]
    T --> U[创建段]
    U --> V[分配段]
    V --> W[写入段内容]
    W --> X[排序重定位]
    X --> Y[写入文件]
    Y --> Z[清理段名]
    Z --> AA[写入加载命令和头文件]
    M -->|否| AB[收集文件索引]
    AA --> AB
    AB --> AC[初始化ar_symtab]
    AC --> AD[更新符号表]
    AD --> AE[排序符号表]
    AE --> AF[更新文件大小]
    AF --> AG[计算总大小]
    AG --> AH[分配文件偏移]
    AH --> AI[写入归档魔数]
    AI --> AJ[写入符号表]
    AJ --> AK[写入对象文件]
    AK --> AL[对齐和填充]
    AL --> AM[写入文件内容]
    AM --> AN[验证缓冲区大小]
    AN --> AO[写入最终文件]
    AO --> AP{是否有错误?}
    AP -->|是| J
    AP -->|否| AQ[结束]
    J --> AQ
