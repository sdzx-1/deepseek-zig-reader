graph TD
    A[开始] --> B[初始化跟踪和上下文]
    B --> C[获取元素类型源位置]
    C --> D[解析元素类型]
    D --> E{元素类型是noreturn?}
    E -->|是| F[报错:指针不允许指向noreturn]
    E -->|否| G[处理哨兵值]
    G --> H{是否有哨兵标志?}
    H -->|是| I[解析并验证哨兵值]
    H -->|否| J[哨兵设为.none]
    I --> J
    J --> K[处理对齐]
    K --> L{是否有对齐标志?}
    L -->|是| M[解析对齐值并验证]
    L -->|否| N[对齐设为.none]
    M --> N
    N --> O[处理地址空间]
    O --> P{是否有地址空间标志?}
    P -->|是| Q[解析地址空间]
    P -->|否| R[根据架构设置默认地址空间]
    Q --> R
    R --> S[处理位偏移和主机大小]
    S --> T{是否有位范围标志?}
    T -->|是| U[解析位偏移和主机大小]
    T -->|否| V[设为默认值0]
    U --> V
    V --> W[验证位偏移有效性]
    W --> X{位偏移超出范围?}
    X -->|是| Y[报错:位偏移无效]
    X -->|否| Z[验证元素类型是否适合打包]
    Z --> AA{是否验证失败?}
    AA -->|是| AB[报错:类型不适合打包]
    AA -->|否| AC[特殊类型检查]
    AC --> AD{元素类型是函数指针?}
    AD -->|是| AE{指针大小是否为single?}
    AE -->|否| AF[报错:函数指针必须为single]
    AE -->|是| AG[继续]
    AD -->|否| AG
    AG --> AH{是C指针类型?}
    AH -->|是| AI[检查C ABI兼容性]
    AI --> AJ{是否兼容?}
    AJ -->|否| AK[生成详细错误信息]
    AJ -->|是| AL[继续]
    AH -->|否| AL
    AL --> AM[构造最终指针类型]
    AM --> AN[返回指针类型引用]
    F --> AO[结束]
    Y --> AO
    AB --> AO
    AF --> AO
    AK --> AO
    AN --> AO
