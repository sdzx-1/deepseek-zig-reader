graph TD
    Start[开始] --> A[初始化变量: pt, zcu, gpa, ip]
    A --> B[计算 bit_bags_count]
    B --> C[设置 tag_ty_src 位置]
    C --> D{是否有 tag_type_ref?}
    D --> |是| E[解析类型并验证为整数]
    D --> |否| F{字段数量>0?}
    F --> |是| G[根据字段数量计算位数并创建整数类型]
    F --> |否| H[创建 0 位无符号整数类型]
    E --> I[设置 wip_ty 的标签类型]
    G --> I
    H --> I
    I --> J[初始化循环变量]
    J --> K[遍历字段 0..fields_len]
    K --> L{当前位包处理完毕?}
    L --> |是| M[读取下一个位包]
    L --> |否| N[处理单个字段]
    M --> N
    N --> O{是否有显式标签值?}
    O --> |是| P[解析并验证标签值]
    O --> |否| Q{是否自动生成值?}
    Q --> |是| R[生成递增标签值]
    Q --> |否| S[使用字段索引作为值]
    P --> T[检查值唯一性]
    R --> T
    S --> T
    T --> U{发生冲突或溢出?}
    U --> |是| V[生成错误信息并终止]
    U --> |否| W[更新当前标签值]
    W --> X[继续下一个字段]
    X --> K
    K --> |循环结束| Y[检查非穷尽枚举约束]
    Y --> Z{是否违反约束?}
    Z --> |是| AA[生成错误信息]
    Z --> |否| AB[函数正常结束]
    V --> AB
    AA --> AB
