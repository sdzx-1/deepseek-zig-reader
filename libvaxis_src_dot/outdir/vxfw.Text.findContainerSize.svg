<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="1163pt" height="763pt"
 viewBox="0.00 0.00 1162.54 763.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 759)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-759 1158.54,-759 1158.54,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<ellipse fill="none" stroke="black" cx="624.54" cy="-737" rx="29.5" ry="18"/>
<text text-anchor="middle" x="624.54" y="-733.3" font-family="Helvetica,sans-Serif" font-size="14.00">开始</text>
</g>
<!-- init -->
<g id="node2" class="node">
<title>init</title>
<polygon fill="none" stroke="black" points="723.54,-682 525.54,-682 525.54,-644 723.54,-644 723.54,-682"/>
<text text-anchor="middle" x="624.54" y="-666.8" font-family="Helvetica,sans-Serif" font-size="14.00">初始化 row=0</text>
<text text-anchor="middle" x="624.54" y="-651.8" font-family="Helvetica,sans-Serif" font-size="14.00">max_width=ctx.min.width</text>
</g>
<!-- start&#45;&gt;init -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init</title>
<path fill="none" stroke="black" d="M624.54,-718.94C624.54,-710.99 624.54,-701.31 624.54,-692.31"/>
<polygon fill="black" stroke="black" points="628.04,-692.2 624.54,-682.2 621.04,-692.2 628.04,-692.2"/>
</g>
<!-- check_softwrap -->
<g id="node3" class="node">
<title>check_softwrap</title>
<polygon fill="none" stroke="black" points="624.54,-607 521.65,-589 624.54,-571 727.43,-589 624.54,-607"/>
<text text-anchor="middle" x="624.54" y="-585.3" font-family="Helvetica,sans-Serif" font-size="14.00">self.softwrap?</text>
</g>
<!-- init&#45;&gt;check_softwrap -->
<g id="edge2" class="edge">
<title>init&#45;&gt;check_softwrap</title>
<path fill="none" stroke="black" d="M624.54,-643.83C624.54,-635.89 624.54,-626.41 624.54,-617.63"/>
<polygon fill="black" stroke="black" points="628.04,-617.42 624.54,-607.42 621.04,-617.42 628.04,-617.42"/>
</g>
<!-- softwrap_true -->
<g id="node4" class="node">
<title>softwrap_true</title>
<polygon fill="none" stroke="black" points="604.54,-520 426.54,-520 426.54,-482 604.54,-482 604.54,-520"/>
<text text-anchor="middle" x="515.54" y="-504.8" font-family="Helvetica,sans-Serif" font-size="14.00">创建 SoftwrapIterator</text>
<text text-anchor="middle" x="515.54" y="-489.8" font-family="Helvetica,sans-Serif" font-size="14.00">iter = init(self.text, ctx)</text>
</g>
<!-- check_softwrap&#45;&gt;softwrap_true -->
<g id="edge3" class="edge">
<title>check_softwrap&#45;&gt;softwrap_true</title>
<path fill="none" stroke="black" d="M606.54,-573.8C590.24,-560.94 565.89,-541.73 546.48,-526.41"/>
<polygon fill="black" stroke="black" points="548.51,-523.56 538.5,-520.11 544.18,-529.06 548.51,-523.56"/>
<text text-anchor="middle" x="588.04" y="-541.8" font-family="Helvetica,sans-Serif" font-size="14.00">是</text>
</g>
<!-- softwrap_false -->
<g id="node9" class="node">
<title>softwrap_false</title>
<polygon fill="none" stroke="black" points="860.04,-520 637.04,-520 637.04,-482 860.04,-482 860.04,-520"/>
<text text-anchor="middle" x="748.54" y="-504.8" font-family="Helvetica,sans-Serif" font-size="14.00">创建 LineIterator</text>
<text text-anchor="middle" x="748.54" y="-489.8" font-family="Helvetica,sans-Serif" font-size="14.00">line_iter = { .buf = self.text }</text>
</g>
<!-- check_softwrap&#45;&gt;softwrap_false -->
<g id="edge4" class="edge">
<title>check_softwrap&#45;&gt;softwrap_false</title>
<path fill="none" stroke="black" d="M644.19,-574.37C662.96,-561.35 691.65,-541.45 714.2,-525.81"/>
<polygon fill="black" stroke="black" points="716.29,-528.63 722.51,-520.05 712.3,-522.87 716.29,-528.63"/>
<text text-anchor="middle" x="701.04" y="-541.8" font-family="Helvetica,sans-Serif" font-size="14.00">否</text>
</g>
<!-- softwrap_loop -->
<g id="node5" class="node">
<title>softwrap_loop</title>
<polygon fill="none" stroke="black" points="425.54,-445 318.79,-427 425.54,-409 532.28,-427 425.54,-445"/>
<text text-anchor="middle" x="425.54" y="-423.3" font-family="Helvetica,sans-Serif" font-size="14.00">循环处理每一行</text>
</g>
<!-- softwrap_true&#45;&gt;softwrap_loop -->
<g id="edge5" class="edge">
<title>softwrap_true&#45;&gt;softwrap_loop</title>
<path fill="none" stroke="black" d="M492.83,-481.83C480.18,-471.72 464.4,-459.09 451.29,-448.61"/>
<polygon fill="black" stroke="black" points="453.13,-445.59 443.13,-442.07 448.75,-451.05 453.13,-445.59"/>
</g>
<!-- check_max_height_soft -->
<g id="node6" class="node">
<title>check_max_height_soft</title>
<polygon fill="none" stroke="black" points="198.54,-358 -0.04,-340 198.54,-322 397.11,-340 198.54,-358"/>
<text text-anchor="middle" x="198.54" y="-336.3" font-family="Helvetica,sans-Serif" font-size="14.00">ctx.max.outsideHeight(row)?</text>
</g>
<!-- softwrap_loop&#45;&gt;check_max_height_soft -->
<g id="edge6" class="edge">
<title>softwrap_loop&#45;&gt;check_max_height_soft</title>
<path fill="none" stroke="black" d="M355.55,-420.76C305.39,-415.75 243.19,-406.6 222.54,-391 214.83,-385.18 209.48,-376.25 205.82,-367.54"/>
<polygon fill="black" stroke="black" points="209.06,-366.19 202.38,-357.97 202.48,-368.57 209.06,-366.19"/>
<text text-anchor="middle" x="258.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">有下一行？</text>
</g>
<!-- process_result -->
<g id="node16" class="node">
<title>process_result</title>
<polygon fill="none" stroke="black" points="647.54,-358 515.54,-358 515.54,-322 647.54,-322 647.54,-358"/>
<text text-anchor="middle" x="581.54" y="-336.3" font-family="Helvetica,sans-Serif" font-size="14.00">计算 result_width</text>
</g>
<!-- softwrap_loop&#45;&gt;process_result -->
<g id="edge19" class="edge">
<title>softwrap_loop&#45;&gt;process_result</title>
<path fill="none" stroke="black" d="M449.57,-412.91C473.94,-399.63 512.1,-378.84 541.13,-363.02"/>
<polygon fill="black" stroke="black" points="543.09,-365.93 550.2,-358.07 539.74,-359.79 543.09,-365.93"/>
<text text-anchor="middle" x="542.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">结束循环</text>
</g>
<!-- check_max_height_soft&#45;&gt;softwrap_loop -->
<g id="edge8" class="edge">
<title>check_max_height_soft&#45;&gt;softwrap_loop</title>
<path fill="none" stroke="black" d="M238.12,-354.42C255.58,-360.59 276.24,-368.26 294.54,-376 308.63,-381.96 311.4,-385.13 325.54,-391 343.29,-398.37 363.21,-405.56 380.57,-411.48"/>
<polygon fill="black" stroke="black" points="379.87,-414.94 390.46,-414.81 382.1,-408.3 379.87,-414.94"/>
<text text-anchor="middle" x="368.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">是，继续循环</text>
</g>
<!-- update_max_soft -->
<g id="node7" class="node">
<title>update_max_soft</title>
<polygon fill="none" stroke="black" points="323.04,-271 4.04,-271 4.04,-235 323.04,-235 323.04,-271"/>
<text text-anchor="middle" x="163.54" y="-249.3" font-family="Helvetica,sans-Serif" font-size="14.00">max_width = @max(max_width, line.width)</text>
</g>
<!-- check_max_height_soft&#45;&gt;update_max_soft -->
<g id="edge7" class="edge">
<title>check_max_height_soft&#45;&gt;update_max_soft</title>
<path fill="none" stroke="black" d="M191.79,-322.61C186.9,-310.73 180.18,-294.41 174.52,-280.67"/>
<polygon fill="black" stroke="black" points="177.67,-279.13 170.63,-271.21 171.2,-281.79 177.67,-279.13"/>
<text text-anchor="middle" x="191.04" y="-292.8" font-family="Helvetica,sans-Serif" font-size="14.00">否</text>
</g>
<!-- increment_row_soft -->
<g id="node8" class="node">
<title>increment_row_soft</title>
<polygon fill="none" stroke="black" points="206.04,-183 71.04,-183 71.04,-147 206.04,-147 206.04,-183"/>
<text text-anchor="middle" x="138.54" y="-161.3" font-family="Helvetica,sans-Serif" font-size="14.00">row += 1 (defer)</text>
</g>
<!-- update_max_soft&#45;&gt;increment_row_soft -->
<g id="edge9" class="edge">
<title>update_max_soft&#45;&gt;increment_row_soft</title>
<path fill="none" stroke="black" d="M158.48,-234.6C155,-222.63 150.31,-206.5 146.36,-192.89"/>
<polygon fill="black" stroke="black" points="149.66,-191.71 143.5,-183.08 142.93,-193.66 149.66,-191.71"/>
</g>
<!-- increment_row_soft&#45;&gt;softwrap_loop -->
<g id="edge10" class="edge">
<title>increment_row_soft&#45;&gt;softwrap_loop</title>
<path fill="none" stroke="black" d="M196.23,-183.04C244.54,-197.96 309.09,-219.6 331.54,-235 373.63,-263.88 384.51,-275.94 406.54,-322 418.19,-346.36 422.72,-377.08 424.47,-398.79"/>
<polygon fill="black" stroke="black" points="420.99,-399.21 425.14,-408.96 427.98,-398.75 420.99,-399.21"/>
<text text-anchor="middle" x="426.54" y="-292.8" font-family="Helvetica,sans-Serif" font-size="14.00">继续循环</text>
</g>
<!-- line_loop -->
<g id="node10" class="node">
<title>line_loop</title>
<polygon fill="none" stroke="black" points="772.54,-445 665.79,-427 772.54,-409 879.28,-427 772.54,-445"/>
<text text-anchor="middle" x="772.54" y="-423.3" font-family="Helvetica,sans-Serif" font-size="14.00">循环处理每一行</text>
</g>
<!-- softwrap_false&#45;&gt;line_loop -->
<g id="edge11" class="edge">
<title>softwrap_false&#45;&gt;line_loop</title>
<path fill="none" stroke="black" d="M754.59,-481.83C757.41,-473.39 760.81,-463.19 763.89,-453.96"/>
<polygon fill="black" stroke="black" points="767.22,-455.03 767.06,-444.44 760.58,-452.82 767.22,-455.03"/>
</g>
<!-- check_max_height_line -->
<g id="node11" class="node">
<title>check_max_height_line</title>
<polygon fill="none" stroke="black" points="867.54,-358 668.96,-340 867.54,-322 1066.11,-340 867.54,-358"/>
<text text-anchor="middle" x="867.54" y="-336.3" font-family="Helvetica,sans-Serif" font-size="14.00">ctx.max.outsideHeight(row)?</text>
</g>
<!-- line_loop&#45;&gt;check_max_height_line -->
<g id="edge12" class="edge">
<title>line_loop&#45;&gt;check_max_height_line</title>
<path fill="none" stroke="black" d="M768.42,-409.22C766.85,-398.74 766.8,-385.49 773.54,-376 779.36,-367.8 787.34,-361.52 796.2,-356.7"/>
<polygon fill="black" stroke="black" points="797.79,-359.82 805.32,-352.37 794.78,-353.5 797.79,-359.82"/>
<text text-anchor="middle" x="809.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">有下一行？</text>
</g>
<!-- line_loop&#45;&gt;process_result -->
<g id="edge20" class="edge">
<title>line_loop&#45;&gt;process_result</title>
<path fill="none" stroke="black" d="M744.76,-413.64C714.56,-400.2 665.74,-378.47 629.35,-362.28"/>
<polygon fill="black" stroke="black" points="630.47,-358.95 619.91,-358.08 627.62,-365.34 630.47,-358.95"/>
<text text-anchor="middle" x="716.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">结束循环</text>
</g>
<!-- check_max_height_line&#45;&gt;line_loop -->
<g id="edge14" class="edge">
<title>check_max_height_line&#45;&gt;line_loop</title>
<path fill="none" stroke="black" d="M863.33,-358.02C859.99,-368.6 854.38,-381.87 845.54,-391 837.68,-399.12 827.56,-405.59 817.37,-410.65"/>
<polygon fill="black" stroke="black" points="815.7,-407.56 808.06,-414.9 818.61,-413.93 815.7,-407.56"/>
<text text-anchor="middle" x="898.54" y="-379.8" font-family="Helvetica,sans-Serif" font-size="14.00">是，继续循环</text>
</g>
<!-- calc_line_width -->
<g id="node12" class="node">
<title>calc_line_width</title>
<polygon fill="none" stroke="black" points="1063.54,-271 731.54,-271 731.54,-235 1063.54,-235 1063.54,-271"/>
<text text-anchor="middle" x="897.54" y="-249.3" font-family="Helvetica,sans-Serif" font-size="14.00">line_width = @truncate(ctx.stringWidth(line))</text>
</g>
<!-- check_max_height_line&#45;&gt;calc_line_width -->
<g id="edge13" class="edge">
<title>check_max_height_line&#45;&gt;calc_line_width</title>
<path fill="none" stroke="black" d="M873.47,-322.21C877.63,-310.41 883.29,-294.38 888.07,-280.82"/>
<polygon fill="black" stroke="black" points="891.49,-281.64 891.52,-271.05 884.89,-279.31 891.49,-281.64"/>
<text text-anchor="middle" x="891.04" y="-292.8" font-family="Helvetica,sans-Serif" font-size="14.00">否</text>
</g>
<!-- resolve_width -->
<g id="node13" class="node">
<title>resolve_width</title>
<polygon fill="none" stroke="black" points="1064.54,-184 750.54,-184 750.54,-146 1064.54,-146 1064.54,-184"/>
<text text-anchor="middle" x="907.54" y="-168.8" font-family="Helvetica,sans-Serif" font-size="14.00">resolved_line_width = ctx.max.width存在？</text>
<text text-anchor="middle" x="907.54" y="-153.8" font-family="Helvetica,sans-Serif" font-size="14.00">@min(max, line_width) : line_width</text>
</g>
<!-- calc_line_width&#45;&gt;resolve_width -->
<g id="edge15" class="edge">
<title>calc_line_width&#45;&gt;resolve_width</title>
<path fill="none" stroke="black" d="M899.56,-234.6C900.9,-223.06 902.7,-207.65 904.24,-194.36"/>
<polygon fill="black" stroke="black" points="907.74,-194.61 905.41,-184.27 900.78,-193.8 907.74,-194.61"/>
</g>
<!-- update_max_line -->
<g id="node14" class="node">
<title>update_max_line</title>
<polygon fill="none" stroke="black" points="1068.54,-109 682.54,-109 682.54,-73 1068.54,-73 1068.54,-109"/>
<text text-anchor="middle" x="875.54" y="-87.3" font-family="Helvetica,sans-Serif" font-size="14.00">max_width = @max(max_width, resolved_line_width)</text>
</g>
<!-- resolve_width&#45;&gt;update_max_line -->
<g id="edge16" class="edge">
<title>resolve_width&#45;&gt;update_max_line</title>
<path fill="none" stroke="black" d="M899.46,-145.83C895.82,-137.63 891.44,-127.78 887.43,-118.76"/>
<polygon fill="black" stroke="black" points="890.54,-117.13 883.28,-109.42 884.14,-119.98 890.54,-117.13"/>
</g>
<!-- increment_row_line -->
<g id="node15" class="node">
<title>increment_row_line</title>
<polygon fill="none" stroke="black" points="1102.04,-36 967.04,-36 967.04,0 1102.04,0 1102.04,-36"/>
<text text-anchor="middle" x="1034.54" y="-14.3" font-family="Helvetica,sans-Serif" font-size="14.00">row += 1 (defer)</text>
</g>
<!-- update_max_line&#45;&gt;increment_row_line -->
<g id="edge17" class="edge">
<title>update_max_line&#45;&gt;increment_row_line</title>
<path fill="none" stroke="black" d="M913.62,-72.99C935.59,-63.19 963.4,-50.77 986.81,-40.31"/>
<polygon fill="black" stroke="black" points="988.51,-43.39 996.21,-36.11 985.66,-37 988.51,-43.39"/>
</g>
<!-- increment_row_line&#45;&gt;line_loop -->
<g id="edge18" class="edge">
<title>increment_row_line&#45;&gt;line_loop</title>
<path fill="none" stroke="black" d="M1062.27,-36.23C1078.78,-48.82 1096.54,-67.58 1096.54,-90 1096.54,-341 1096.54,-341 1096.54,-341 1096.54,-390.64 952.47,-411.87 856.47,-420.51"/>
<polygon fill="black" stroke="black" points="856.12,-417.03 846.46,-421.38 856.73,-424 856.12,-417.03"/>
<text text-anchor="middle" x="1125.54" y="-205.8" font-family="Helvetica,sans-Serif" font-size="14.00">继续循环</text>
</g>
<!-- check_width_basis -->
<g id="node17" class="node">
<title>check_width_basis</title>
<polygon fill="none" stroke="black" points="581.54,-271 459.04,-253 581.54,-235 704.03,-253 581.54,-271"/>
<text text-anchor="middle" x="581.54" y="-249.3" font-family="Helvetica,sans-Serif" font-size="14.00">self.width_basis?</text>
</g>
<!-- process_result&#45;&gt;check_width_basis -->
<g id="edge21" class="edge">
<title>process_result&#45;&gt;check_width_basis</title>
<path fill="none" stroke="black" d="M581.54,-321.8C581.54,-310.16 581.54,-294.55 581.54,-281.24"/>
<polygon fill="black" stroke="black" points="585.04,-281.18 581.54,-271.18 578.04,-281.18 585.04,-281.18"/>
</g>
<!-- longest_line -->
<g id="node18" class="node">
<title>longest_line</title>
<polygon fill="none" stroke="black" points="494.54,-184 224.54,-184 224.54,-146 494.54,-146 494.54,-184"/>
<text text-anchor="middle" x="359.54" y="-168.8" font-family="Helvetica,sans-Serif" font-size="14.00">result_width = ctx.max.width存在？</text>
<text text-anchor="middle" x="359.54" y="-153.8" font-family="Helvetica,sans-Serif" font-size="14.00">@min(max, max_width) : max_width</text>
</g>
<!-- check_width_basis&#45;&gt;longest_line -->
<g id="edge22" class="edge">
<title>check_width_basis&#45;&gt;longest_line</title>
<path fill="none" stroke="black" d="M549.26,-239.49C514.26,-225.94 457.76,-204.05 415.51,-187.68"/>
<polygon fill="black" stroke="black" points="416.77,-184.42 406.18,-184.07 414.24,-190.94 416.77,-184.42"/>
<text text-anchor="middle" x="534.54" y="-205.8" font-family="Helvetica,sans-Serif" font-size="14.00">.longest_line</text>
</g>
<!-- parent -->
<g id="node19" class="node">
<title>parent</title>
<polygon fill="none" stroke="black" points="732.54,-184 512.54,-184 512.54,-146 732.54,-146 732.54,-184"/>
<text text-anchor="middle" x="622.54" y="-168.8" font-family="Helvetica,sans-Serif" font-size="14.00">断言 ctx.max.width != null</text>
<text text-anchor="middle" x="622.54" y="-153.8" font-family="Helvetica,sans-Serif" font-size="14.00">result_width = ctx.max.width</text>
</g>
<!-- check_width_basis&#45;&gt;parent -->
<g id="edge23" class="edge">
<title>check_width_basis&#45;&gt;parent</title>
<path fill="none" stroke="black" d="M589.25,-235.82C594.94,-223.88 602.82,-207.35 609.49,-193.37"/>
<polygon fill="black" stroke="black" points="612.72,-194.72 613.87,-184.19 606.4,-191.71 612.72,-194.72"/>
<text text-anchor="middle" x="629.54" y="-205.8" font-family="Helvetica,sans-Serif" font-size="14.00">.parent</text>
</g>
<!-- calc_height -->
<g id="node20" class="node">
<title>calc_height</title>
<polygon fill="none" stroke="black" points="623.04,-109 352.04,-109 352.04,-73 623.04,-73 623.04,-109"/>
<text text-anchor="middle" x="487.54" y="-87.3" font-family="Helvetica,sans-Serif" font-size="14.00">height = @max(row, ctx.min.height)</text>
</g>
<!-- longest_line&#45;&gt;calc_height -->
<g id="edge24" class="edge">
<title>longest_line&#45;&gt;calc_height</title>
<path fill="none" stroke="black" d="M391.84,-145.83C408.87,-136.25 429.9,-124.42 447.91,-114.29"/>
<polygon fill="black" stroke="black" points="450.01,-117.12 457.01,-109.17 446.58,-111.02 450.01,-117.12"/>
</g>
<!-- parent&#45;&gt;calc_height -->
<g id="edge25" class="edge">
<title>parent&#45;&gt;calc_height</title>
<path fill="none" stroke="black" d="M588.47,-145.83C570.35,-136.17 547.92,-124.2 528.81,-114.01"/>
<polygon fill="black" stroke="black" points="530.21,-110.79 519.73,-109.17 526.91,-116.97 530.21,-110.79"/>
</g>
<!-- return -->
<g id="node21" class="node">
<title>return</title>
<ellipse fill="none" stroke="black" cx="487.54" cy="-18" rx="207.96" ry="18"/>
<text text-anchor="middle" x="487.54" y="-14.3" font-family="Helvetica,sans-Serif" font-size="14.00">返回 { width=result_width, height=height }</text>
</g>
<!-- calc_height&#45;&gt;return -->
<g id="edge26" class="edge">
<title>calc_height&#45;&gt;return</title>
<path fill="none" stroke="black" d="M487.54,-72.81C487.54,-64.79 487.54,-55.05 487.54,-46.07"/>
<polygon fill="black" stroke="black" points="491.04,-46.03 487.54,-36.03 484.04,-46.03 491.04,-46.03"/>
</g>
</g>
</svg>
