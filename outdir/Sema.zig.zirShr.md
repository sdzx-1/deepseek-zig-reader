graph TD
    A[开始] --> B[解析lhs和rhs]
    B --> C[获取lhs_ty和rhs_ty]
    C --> D[检查向量化操作数]
    D --> E{rhs是常量?}
    E --> |是| F[处理rhs为undef/0的边界情况]
    F --> F1{rhs是0?}
    F1 --> |是| G[直接返回lhs]
    F1 --> |否| H[检查位移量是否超过类型位数]
    H --> H1{是否超过?}
    H1 --> |是| I[抛出shift amount too large错误]
    H1 --> |否| J[检查位移量是否为负数]
    J --> J1{是否负数?}
    J1 --> |是| K[抛出shift by negative错误]
    J1 --> |否| L{lhs是常量?}
    L --> |是| M[处理精确右移的溢出检查]
    M --> M1{是否溢出?}
    M1 --> |是| N[抛出exact shift溢出错误]
    M1 --> |否| O[计算shr结果并返回]
    E --> |否| P[检查是否缺少运行时信息]
    P --> P1{comptime_int类型?}
    P1 --> |是| Q[抛出需要固定宽度的错误]
    P1 --> |否| R[生成运行时指令]
    R --> S[添加二元操作]
    S --> T{需要安全检查?}
    T --> |是| U[添加位移量过大检查]
    U --> V[添加精确右移的溢出检查]
    V --> W[返回结果]
    T --> |否| W
    I --> W
    K --> W
    N --> W
    Q --> W
