graph TD
    A[开始] --> B[记录日志和追踪]
    B --> C[获取gpa和文件句柄]
    C --> D[读取Mach-O头]
    D --> E{验证CPU架构}
    E -->|匹配失败| F[报错并返回]
    E -->|匹配成功| G[处理加载命令]
    G --> H[遍历加载命令]
    H --> I{当前命令类型}
    I -->|SEGMENT_64| J[处理段和节]
    I -->|SYMTAB| K[处理符号表]
    I -->|DATA_IN_CODE| L[处理数据编码]
    I -->|BUILD_VERSION等| M[设置平台信息]
    I -->|其他命令| N[忽略]
    J --> H
    K --> H
    L --> H
    M --> H
    N --> H
    H -->|所有命令处理完毕| O[符号排序和初始化]
    O --> P{是否有子段}
    P -->|是| Q[初始化子段]
    P -->|否| R[初始化普通段]
    Q --> S[初始化字面量/链接符号]
    R --> S
    S --> T[处理异常框架和紧凑展开]
    T --> U{存在eh_frame?}
    U -->|是| V[解析eh_frame记录]
    U -->|否| W
    W --> X{存在compact_unwind?}
    X -->|是| Y[解析unwind记录]
    X -->|否| Z
    Z --> AA[平台兼容性检查]
    AA --> AB{平台有效?}
    AB -->|无效| AC[报错并返回]
    AB -->|有效| AD[解析调试信息]
    AD --> AE[设置原子存活状态]
    AE --> AF{是否强制加载ObjC?}
    AF -->|是| AG[标记对象存活]
    AF -->|否| AH[结束]
    AG --> AH
