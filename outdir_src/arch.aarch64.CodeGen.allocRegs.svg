<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: allocRegs_flowchart Pages: 1 -->
<svg width="1140pt" height="1131pt"
 viewBox="0.00 0.00 1140.00 1131.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1127)">
<title>allocRegs_flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1127 1136,-1127 1136,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_main</title>
<polygon fill="none" stroke="black" points="8,-8 8,-1115 526,-1115 526,-8 8,-8"/>
<text text-anchor="middle" x="267" y="-1099.8" font-family="Times,serif" font-size="14.00">Main Logic</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_lock_read_regs</title>
<polygon fill="none" stroke="black" points="534,-435 534,-510 708,-510 708,-435 534,-435"/>
<text text-anchor="middle" x="621" y="-494.8" font-family="Times,serif" font-size="14.00">Lock Read Args</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_handle_reuse</title>
<polygon fill="none" stroke="black" points="778,-8 778,-187 1124,-187 1124,-8 778,-8"/>
<text text-anchor="middle" x="951" y="-171.8" font-family="Times,serif" font-size="14.00">Reuse Logic</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_move_non_reg</title>
<polygon fill="none" stroke="black" points="534,-8 534,-83 770,-83 770,-8 534,-8"/>
<text text-anchor="middle" x="652" y="-67.8" font-family="Times,serif" font-size="14.00">Move Non&#45;Register Args</text>
</g>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<ellipse fill="none" stroke="black" cx="281" cy="-1066" rx="88.79" ry="18"/>
<text text-anchor="middle" x="281" y="-1062.9" font-family="Courier,monospace" font-size="12.00">Start allocRegs()</text>
</g>
<!-- assert1 -->
<g id="node2" class="node">
<title>assert1</title>
<polygon fill="none" stroke="black" points="454.5,-1011 107.5,-1011 107.5,-975 454.5,-975 454.5,-1011"/>
<text text-anchor="middle" x="281" y="-989.9" font-family="Courier,monospace" font-size="12.00">Assert: reuse_metadata ⇒ write_args.len == 1</text>
</g>
<!-- start&#45;&gt;assert1 -->
<g id="edge1" class="edge">
<title>start&#45;&gt;assert1</title>
<path fill="none" stroke="black" d="M281,-1047.81C281,-1039.79 281,-1030.05 281,-1021.07"/>
<polygon fill="black" stroke="black" points="284.5,-1021.03 281,-1011.03 277.5,-1021.03 284.5,-1021.03"/>
</g>
<!-- assert2 -->
<g id="node3" class="node">
<title>assert2</title>
<polygon fill="none" stroke="black" points="518,-938 44,-938 44,-902 518,-902 518,-938"/>
<text text-anchor="middle" x="281" y="-916.9" font-family="Courier,monospace" font-size="12.00">Assert: reuse_metadata ⇒ operand_mapping.len == read_args.len</text>
</g>
<!-- assert1&#45;&gt;assert2 -->
<g id="edge2" class="edge">
<title>assert1&#45;&gt;assert2</title>
<path fill="none" stroke="black" d="M281,-974.81C281,-966.79 281,-957.05 281,-948.07"/>
<polygon fill="black" stroke="black" points="284.5,-948.03 281,-938.03 277.5,-948.03 284.5,-948.03"/>
</g>
<!-- alloc_locks -->
<g id="node4" class="node">
<title>alloc_locks</title>
<polygon fill="none" stroke="black" points="464,-865 162,-865 162,-829 464,-829 464,-865"/>
<text text-anchor="middle" x="313" y="-843.9" font-family="Courier,monospace" font-size="12.00">Allocate locks[read_args + write_args]</text>
</g>
<!-- assert2&#45;&gt;alloc_locks -->
<g id="edge3" class="edge">
<title>assert2&#45;&gt;alloc_locks</title>
<path fill="none" stroke="black" d="M288.75,-901.81C292.48,-893.53 297.04,-883.41 301.19,-874.19"/>
<polygon fill="black" stroke="black" points="304.41,-875.58 305.33,-865.03 298.03,-872.71 304.41,-875.58"/>
</g>
<!-- memset -->
<g id="node5" class="node">
<title>memset</title>
<polygon fill="none" stroke="black" points="468.5,-792 189.5,-792 189.5,-756 468.5,-756 468.5,-792"/>
<text text-anchor="middle" x="329" y="-770.9" font-family="Courier,monospace" font-size="12.00">Initialize locks with @memset(null)</text>
</g>
<!-- alloc_locks&#45;&gt;memset -->
<g id="edge4" class="edge">
<title>alloc_locks&#45;&gt;memset</title>
<path fill="none" stroke="black" d="M316.87,-828.81C318.68,-820.79 320.88,-811.05 322.9,-802.07"/>
<polygon fill="black" stroke="black" points="326.38,-802.55 325.16,-792.03 319.55,-801.01 326.38,-802.55"/>
</g>
<!-- defer_unlock -->
<g id="node6" class="node">
<title>defer_unlock</title>
<polygon fill="none" stroke="black" points="480.5,-719 193.5,-719 193.5,-683 480.5,-683 480.5,-719"/>
<text text-anchor="middle" x="337" y="-697.9" font-family="Courier,monospace" font-size="12.00">Defer: Unlock all registers in locks</text>
</g>
<!-- memset&#45;&gt;defer_unlock -->
<g id="edge5" class="edge">
<title>memset&#45;&gt;defer_unlock</title>
<path fill="none" stroke="black" d="M330.94,-755.81C331.84,-747.79 332.94,-738.05 333.95,-729.07"/>
<polygon fill="black" stroke="black" points="337.44,-729.36 335.08,-719.03 330.48,-728.57 337.44,-729.36"/>
</g>
<!-- reused_read_arg_init -->
<g id="node7" class="node">
<title>reused_read_arg_init</title>
<polygon fill="none" stroke="black" points="432,-646 250,-646 250,-610 432,-610 432,-646"/>
<text text-anchor="middle" x="341" y="-624.9" font-family="Courier,monospace" font-size="12.00">reused_read_arg = null</text>
</g>
<!-- defer_unlock&#45;&gt;reused_read_arg_init -->
<g id="edge6" class="edge">
<title>defer_unlock&#45;&gt;reused_read_arg_init</title>
<path fill="none" stroke="black" d="M337.97,-682.81C338.42,-674.79 338.97,-665.05 339.47,-656.07"/>
<polygon fill="black" stroke="black" points="342.97,-656.21 340.04,-646.03 335.98,-655.82 342.97,-656.21"/>
</g>
<!-- lock_read_regs -->
<g id="node8" class="node">
<title>lock_read_regs</title>
<polygon fill="none" stroke="black" points="442.5,-573 245.5,-573 245.5,-537 442.5,-537 442.5,-573"/>
<text text-anchor="middle" x="344" y="-551.9" font-family="Courier,monospace" font-size="12.00">Lock read_args registers</text>
</g>
<!-- reused_read_arg_init&#45;&gt;lock_read_regs -->
<g id="edge7" class="edge">
<title>reused_read_arg_init&#45;&gt;lock_read_regs</title>
<path fill="none" stroke="black" d="M341.73,-609.81C342.07,-601.79 342.48,-592.05 342.86,-583.07"/>
<polygon fill="black" stroke="black" points="346.36,-583.17 343.28,-573.03 339.36,-582.87 346.36,-583.17"/>
</g>
<!-- lock_write_regs -->
<g id="node9" class="node">
<title>lock_write_regs</title>
<polygon fill="none" stroke="black" points="446,-479 242,-479 242,-443 446,-443 446,-479"/>
<text text-anchor="middle" x="344" y="-457.9" font-family="Courier,monospace" font-size="12.00">Lock write_args registers</text>
</g>
<!-- lock_read_regs&#45;&gt;lock_write_regs -->
<g id="edge8" class="edge">
<title>lock_read_regs&#45;&gt;lock_write_regs</title>
<path fill="none" stroke="black" d="M344,-536.7C344,-523.46 344,-504.95 344,-489.66"/>
<polygon fill="black" stroke="black" points="347.5,-489.23 344,-479.23 340.5,-489.23 347.5,-489.23"/>
</g>
<!-- lock_read_regs_loop -->
<g id="node16" class="node">
<title>lock_read_regs_loop</title>
<polygon fill="none" stroke="black" points="700.5,-479 541.5,-479 541.5,-443 700.5,-443 700.5,-479"/>
<text text-anchor="middle" x="621" y="-464.4" font-family="Courier,monospace" font-size="12.00">For each read_arg:</text>
<text text-anchor="middle" x="621" y="-451.4" font-family="Courier,monospace" font-size="12.00">Lock if in register</text>
</g>
<!-- lock_read_regs&#45;&gt;lock_read_regs_loop -->
<!-- alloc_read_regs -->
<g id="node10" class="node">
<title>alloc_read_regs</title>
<polygon fill="none" stroke="black" points="517.5,-406 170.5,-406 170.5,-370 517.5,-370 517.5,-406"/>
<text text-anchor="middle" x="344" y="-384.9" font-family="Courier,monospace" font-size="12.00">Allocate registers for unallocated read_args</text>
</g>
<!-- lock_write_regs&#45;&gt;alloc_read_regs -->
<g id="edge9" class="edge">
<title>lock_write_regs&#45;&gt;alloc_read_regs</title>
<path fill="none" stroke="black" d="M344,-442.81C344,-434.79 344,-425.05 344,-416.07"/>
<polygon fill="black" stroke="black" points="347.5,-416.03 344,-406.03 340.5,-416.03 347.5,-416.03"/>
</g>
<!-- check_reuse -->
<g id="node11" class="node">
<title>check_reuse</title>
<polygon fill="none" stroke="black" points="344,-333 179.42,-315 344,-297 508.58,-315 344,-333"/>
<text text-anchor="middle" x="344" y="-311.9" font-family="Courier,monospace" font-size="12.00">reuse_metadata != null?</text>
</g>
<!-- alloc_read_regs&#45;&gt;check_reuse -->
<g id="edge10" class="edge">
<title>alloc_read_regs&#45;&gt;check_reuse</title>
<path fill="none" stroke="black" d="M344,-369.81C344,-361.79 344,-352.05 344,-343.07"/>
<polygon fill="black" stroke="black" points="347.5,-343.03 344,-333.03 340.5,-343.03 347.5,-343.03"/>
</g>
<!-- handle_reuse -->
<g id="node12" class="node">
<title>handle_reuse</title>
<polygon fill="none" stroke="black" points="517.5,-250 298.5,-250 298.5,-214 517.5,-214 517.5,-250"/>
<text text-anchor="middle" x="408" y="-228.9" font-family="Courier,monospace" font-size="12.00">Handle register reuse logic</text>
</g>
<!-- check_reuse&#45;&gt;handle_reuse -->
<g id="edge11" class="edge">
<title>check_reuse&#45;&gt;handle_reuse</title>
<path fill="none" stroke="black" d="M356.64,-298C365.61,-286.65 377.82,-271.2 388.09,-258.2"/>
<polygon fill="black" stroke="black" points="391.04,-260.1 394.5,-250.09 385.55,-255.76 391.04,-260.1"/>
<text text-anchor="middle" x="388.5" y="-271" font-family="Courier,monospace" font-size="10.00">Yes</text>
</g>
<!-- handle_no_reuse -->
<g id="node13" class="node">
<title>handle_no_reuse</title>
<polygon fill="none" stroke="black" points="280,-250 16,-250 16,-214 280,-214 280,-250"/>
<text text-anchor="middle" x="148" y="-228.9" font-family="Courier,monospace" font-size="12.00">Allocate registers for write_args</text>
</g>
<!-- check_reuse&#45;&gt;handle_no_reuse -->
<g id="edge12" class="edge">
<title>check_reuse&#45;&gt;handle_no_reuse</title>
<path fill="none" stroke="black" d="M311.19,-300.44C280.61,-287.8 234.53,-268.76 199.13,-254.13"/>
<polygon fill="black" stroke="black" points="200.02,-250.71 189.45,-250.13 197.35,-257.18 200.02,-250.71"/>
<text text-anchor="middle" x="263.5" y="-271" font-family="Courier,monospace" font-size="10.00">No</text>
</g>
<!-- move_non_reg_reads -->
<g id="node14" class="node">
<title>move_non_reg_reads</title>
<polygon fill="none" stroke="black" points="517.5,-156 200.5,-156 200.5,-120 517.5,-120 517.5,-156"/>
<text text-anchor="middle" x="359" y="-134.9" font-family="Courier,monospace" font-size="12.00">Move non&#45;register read_args to registers</text>
</g>
<!-- handle_reuse&#45;&gt;move_non_reg_reads -->
<g id="edge13" class="edge">
<title>handle_reuse&#45;&gt;move_non_reg_reads</title>
<path fill="none" stroke="black" d="M398.78,-213.7C391.53,-200.07 381.3,-180.86 373.03,-165.34"/>
<polygon fill="black" stroke="black" points="375.97,-163.41 368.18,-156.23 369.79,-166.7 375.97,-163.41"/>
</g>
<!-- reuse_loop -->
<g id="node17" class="node">
<title>reuse_loop</title>
<polygon fill="none" stroke="black" points="944.5,-156 785.5,-156 785.5,-120 944.5,-120 944.5,-156"/>
<text text-anchor="middle" x="865" y="-141.4" font-family="Courier,monospace" font-size="12.00">Check each read_arg</text>
<text text-anchor="middle" x="865" y="-128.4" font-family="Courier,monospace" font-size="12.00">for reuse potential</text>
</g>
<!-- handle_reuse&#45;&gt;reuse_loop -->
<g id="edge17" class="edge">
<title>handle_reuse&#45;&gt;reuse_loop</title>
<path fill="none" stroke="black" d="M492.62,-213.96C572.99,-197.78 693.41,-173.54 775.39,-157.04"/>
<polygon fill="black" stroke="black" points="776.33,-160.42 785.44,-155.02 774.95,-153.56 776.33,-160.42"/>
</g>
<!-- handle_no_reuse&#45;&gt;move_non_reg_reads -->
<g id="edge14" class="edge">
<title>handle_no_reuse&#45;&gt;move_non_reg_reads</title>
<path fill="none" stroke="black" d="M187.19,-213.91C222.02,-198.73 273.06,-176.47 310.46,-160.16"/>
<polygon fill="black" stroke="black" points="311.89,-163.36 319.66,-156.15 309.09,-156.94 311.89,-163.36"/>
</g>
<!-- end -->
<g id="node15" class="node">
<title>end</title>
<ellipse fill="none" stroke="black" cx="359" cy="-34" rx="102.61" ry="18"/>
<text text-anchor="middle" x="359" y="-30.9" font-family="Courier,monospace" font-size="12.00">End (Defer executes)</text>
</g>
<!-- move_non_reg_reads&#45;&gt;end -->
<g id="edge15" class="edge">
<title>move_non_reg_reads&#45;&gt;end</title>
<path fill="none" stroke="black" d="M359,-119.7C359,-103.92 359,-80.36 359,-62.09"/>
<polygon fill="black" stroke="black" points="362.5,-62.05 359,-52.05 355.5,-62.05 362.5,-62.05"/>
</g>
<!-- move_loop -->
<g id="node20" class="node">
<title>move_loop</title>
<polygon fill="none" stroke="black" points="761.5,-52 542.5,-52 542.5,-16 761.5,-16 761.5,-52"/>
<text text-anchor="middle" x="652" y="-37.4" font-family="Courier,monospace" font-size="12.00">For each read_arg:</text>
<text text-anchor="middle" x="652" y="-24.4" font-family="Courier,monospace" font-size="12.00">Skip reused, move if needed</text>
</g>
<!-- move_non_reg_reads&#45;&gt;move_loop -->
<!-- reuse_success -->
<g id="node18" class="node">
<title>reuse_success</title>
<polygon fill="none" stroke="black" points="923.5,-52 786.5,-52 786.5,-16 923.5,-16 923.5,-52"/>
<text text-anchor="middle" x="855" y="-37.4" font-family="Courier,monospace" font-size="12.00">Reuse found</text>
<text text-anchor="middle" x="855" y="-24.4" font-family="Courier,monospace" font-size="12.00">Update write_reg</text>
</g>
<!-- reuse_loop&#45;&gt;reuse_success -->
<g id="edge18" class="edge">
<title>reuse_loop&#45;&gt;reuse_success</title>
<path fill="none" stroke="black" d="M863.3,-119.7C861.76,-103.92 859.45,-80.36 857.66,-62.09"/>
<polygon fill="black" stroke="black" points="861.13,-61.66 856.67,-52.05 854.16,-62.34 861.13,-61.66"/>
<text text-anchor="middle" x="876.5" y="-94" font-family="Courier,monospace" font-size="10.00">Found</text>
</g>
<!-- reuse_fail -->
<g id="node19" class="node">
<title>reuse_fail</title>
<polygon fill="none" stroke="black" points="1116,-52 942,-52 942,-16 1116,-16 1116,-52"/>
<text text-anchor="middle" x="1029" y="-30.9" font-family="Courier,monospace" font-size="12.00">Allocate new register</text>
</g>
<!-- reuse_loop&#45;&gt;reuse_fail -->
<g id="edge19" class="edge">
<title>reuse_loop&#45;&gt;reuse_fail</title>
<path fill="none" stroke="black" d="M892.45,-119.93C920,-102.79 962.6,-76.3 992.88,-57.47"/>
<polygon fill="black" stroke="black" points="994.82,-60.38 1001.46,-52.13 991.12,-54.44 994.82,-60.38"/>
<text text-anchor="middle" x="964.5" y="-94" font-family="Courier,monospace" font-size="10.00">Not found</text>
</g>
</g>
</svg>
