<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="875pt" height="1292pt"
 viewBox="0.00 0.00 874.50 1292.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1288)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1288 870.5,-1288 870.5,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="826,-1284 719,-1284 719,-1248 826,-1248 826,-1284"/>
<text text-anchor="middle" x="772.5" y="-1263.5" font-family="Courier,monospace" font-size="10.00">开始 createEmpty</text>
</g>
<!-- validate_target -->
<g id="node2" class="node">
<title>validate_target</title>
<polygon fill="none" stroke="black" points="853,-1211 692,-1211 692,-1175 853,-1175 853,-1211"/>
<text text-anchor="middle" x="772.5" y="-1196" font-family="Courier,monospace" font-size="10.00">验证 target.ofmt == .coff</text>
<text text-anchor="middle" x="772.5" y="-1185" font-family="Courier,monospace" font-size="10.00">(断言)</text>
</g>
<!-- start&#45;&gt;validate_target -->
<g id="edge1" class="edge">
<title>start&#45;&gt;validate_target</title>
<path fill="none" stroke="black" d="M772.5,-1247.81C772.5,-1239.79 772.5,-1230.05 772.5,-1221.07"/>
<polygon fill="black" stroke="black" points="776,-1221.03 772.5,-1211.03 769,-1221.03 776,-1221.03"/>
</g>
<!-- set_ptr_width -->
<g id="node3" class="node">
<title>set_ptr_width</title>
<polygon fill="none" stroke="black" points="716,-1138 555,-1138 555,-1102 716,-1102 716,-1138"/>
<text text-anchor="middle" x="635.5" y="-1123" font-family="Courier,monospace" font-size="10.00">根据 target.ptrBitWidth()</text>
<text text-anchor="middle" x="635.5" y="-1112" font-family="Courier,monospace" font-size="10.00">设置 ptr_width</text>
</g>
<!-- validate_target&#45;&gt;set_ptr_width -->
<g id="edge2" class="edge">
<title>validate_target&#45;&gt;set_ptr_width</title>
<path fill="none" stroke="black" d="M739.69,-1174.99C721.01,-1165.32 697.43,-1153.1 677.43,-1142.73"/>
<polygon fill="black" stroke="black" points="679.01,-1139.61 668.52,-1138.11 675.79,-1145.82 679.01,-1139.61"/>
</g>
<!-- error_exit -->
<g id="node18" class="node">
<title>error_exit</title>
<polygon fill="none" stroke="black" points="449.5,-36 393.5,-36 393.5,0 449.5,0 449.5,-36"/>
<text text-anchor="middle" x="421.5" y="-15.5" font-family="Courier,monospace" font-size="10.00">错误处理</text>
</g>
<!-- validate_target&#45;&gt;error_exit -->
<g id="edge18" class="edge">
<title>validate_target&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M795.71,-1174.83C810.35,-1161.88 826.5,-1142.68 826.5,-1121 826.5,-1121 826.5,-1121 826.5,-100 826.5,-25.64 560.65,-18.6 459.73,-18.61"/>
<polygon fill="black" stroke="black" points="459.65,-15.11 449.66,-18.63 459.67,-22.11 459.65,-15.11"/>
<text text-anchor="middle" x="846.5" y="-628" font-family="Courier,monospace" font-size="10.00">断言失败</text>
</g>
<!-- set_page_size -->
<g id="node4" class="node">
<title>set_page_size</title>
<polygon fill="none" stroke="black" points="601,-1065 470,-1065 470,-1029 601,-1029 601,-1065"/>
<text text-anchor="middle" x="535.5" y="-1050" font-family="Courier,monospace" font-size="10.00">根据 target.cpu.arch</text>
<text text-anchor="middle" x="535.5" y="-1039" font-family="Courier,monospace" font-size="10.00">设置 page_size</text>
</g>
<!-- set_ptr_width&#45;&gt;set_page_size -->
<g id="edge3" class="edge">
<title>set_ptr_width&#45;&gt;set_page_size</title>
<path fill="none" stroke="black" d="M611.55,-1101.99C598.53,-1092.75 582.25,-1081.19 568.09,-1071.14"/>
<polygon fill="black" stroke="black" points="569.78,-1068.05 559.6,-1065.11 565.73,-1073.76 569.78,-1068.05"/>
</g>
<!-- set_ptr_width&#45;&gt;error_exit -->
<g id="edge19" class="edge">
<title>set_ptr_width&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M635.5,-1101.78C635.5,-1087.41 635.5,-1066.37 635.5,-1048 635.5,-1048 635.5,-1048 635.5,-100 635.5,-62.92 521.68,-36.84 460.06,-25.44"/>
<polygon fill="black" stroke="black" points="460.38,-21.94 449.92,-23.61 459.14,-28.83 460.38,-21.94"/>
<text text-anchor="middle" x="717" y="-586.5" font-family="Courier,monospace" font-size="10.00">UnsupportedCOFFArchitecture</text>
</g>
<!-- handle_lld_llvm -->
<g id="node5" class="node">
<title>handle_lld_llvm</title>
<polygon fill="none" stroke="black" points="536,-992 381,-992 381,-956 536,-956 536,-992"/>
<text text-anchor="middle" x="458.5" y="-977" font-family="Courier,monospace" font-size="10.00">生成 zcu_object_sub_path</text>
<text text-anchor="middle" x="458.5" y="-966" font-family="Courier,monospace" font-size="10.00">(根据 use_lld/use_llvm)</text>
</g>
<!-- set_page_size&#45;&gt;handle_lld_llvm -->
<g id="edge4" class="edge">
<title>set_page_size&#45;&gt;handle_lld_llvm</title>
<path fill="none" stroke="black" d="M516.86,-1028.81C507.12,-1019.83 495.04,-1008.69 484.4,-998.89"/>
<polygon fill="black" stroke="black" points="486.69,-996.23 476.97,-992.03 481.95,-1001.38 486.69,-996.23"/>
</g>
<!-- init_coff -->
<g id="node6" class="node">
<title>init_coff</title>
<polygon fill="none" stroke="black" points="551,-919 366,-919 366,-883 551,-883 551,-919"/>
<text text-anchor="middle" x="458.5" y="-904" font-family="Courier,monospace" font-size="10.00">初始化 Coff 结构体</text>
<text text-anchor="middle" x="458.5" y="-893" font-family="Courier,monospace" font-size="10.00">填充 base/ptr_width/page_size</text>
</g>
<!-- handle_lld_llvm&#45;&gt;init_coff -->
<g id="edge5" class="edge">
<title>handle_lld_llvm&#45;&gt;init_coff</title>
<path fill="none" stroke="black" d="M458.5,-955.81C458.5,-947.79 458.5,-938.05 458.5,-929.07"/>
<polygon fill="black" stroke="black" points="462,-929.03 458.5,-919.03 455,-929.03 462,-929.03"/>
</g>
<!-- handle_lld_llvm&#45;&gt;error_exit -->
<g id="edge20" class="edge">
<title>handle_lld_llvm&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M380.88,-968.64C251.43,-960.31 5.5,-939.54 5.5,-902 5.5,-902 5.5,-902 5.5,-220 5.5,-128.18 41.53,-83.46 128.5,-54 216.2,-24.29 326.12,-19.08 383.17,-18.59"/>
<polygon fill="black" stroke="black" points="383.2,-22.09 393.19,-18.55 383.17,-15.09 383.2,-22.09"/>
<text text-anchor="middle" x="48.5" y="-503.5" font-family="Courier,monospace" font-size="10.00">allocPrint 失败</text>
</g>
<!-- image_base_logic -->
<g id="node7" class="node">
<title>image_base_logic</title>
<polygon fill="none" stroke="black" points="477.5,-846 325.5,-846 325.5,-810 477.5,-810 477.5,-846"/>
<text text-anchor="middle" x="401.5" y="-831" font-family="Courier,monospace" font-size="10.00">设置 image_base</text>
<text text-anchor="middle" x="401.5" y="-820" font-family="Courier,monospace" font-size="10.00">根据 output_mode 和 arch</text>
</g>
<!-- init_coff&#45;&gt;image_base_logic -->
<g id="edge6" class="edge">
<title>init_coff&#45;&gt;image_base_logic</title>
<path fill="none" stroke="black" d="M444.7,-882.81C437.77,-874.18 429.24,-863.56 421.6,-854.03"/>
<polygon fill="black" stroke="black" points="424.16,-851.64 415.17,-846.03 418.7,-856.02 424.16,-851.64"/>
</g>
<!-- init_coff&#45;&gt;error_exit -->
<g id="edge21" class="edge">
<title>init_coff&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M487.13,-882.98C504.17,-870.47 522.5,-851.74 522.5,-829 522.5,-829 522.5,-829 522.5,-505 522.5,-432.09 526.5,-413.91 526.5,-341 526.5,-341 526.5,-341 526.5,-100 526.5,-64.89 489.24,-42.87 459.11,-30.8"/>
<polygon fill="black" stroke="black" points="460.23,-27.48 449.64,-27.23 457.76,-34.03 460.23,-27.48"/>
<text text-anchor="middle" x="571.5" y="-462" font-family="Courier,monospace" font-size="10.00">arena.create 失败</text>
</g>
<!-- llvm_object_init -->
<g id="node8" class="node">
<title>llvm_object_init</title>
<polygon fill="none" stroke="black" points="457,-763 310,-763 310,-727 457,-727 457,-763"/>
<text text-anchor="middle" x="383.5" y="-748" font-family="Courier,monospace" font-size="10.00">use_llvm &amp;&amp; have_zcu?</text>
<text text-anchor="middle" x="383.5" y="-737" font-family="Courier,monospace" font-size="10.00">初始化 coff.llvm_object</text>
</g>
<!-- image_base_logic&#45;&gt;llvm_object_init -->
<g id="edge7" class="edge">
<title>image_base_logic&#45;&gt;llvm_object_init</title>
<path fill="none" stroke="black" d="M393.49,-809.88C391.19,-804.29 388.92,-797.98 387.5,-792 386.07,-786 385.14,-779.46 384.54,-773.24"/>
<polygon fill="black" stroke="black" points="388.03,-772.95 383.8,-763.23 381.05,-773.46 388.03,-772.95"/>
<text text-anchor="middle" x="448" y="-784" font-family="Courier,monospace" font-size="10.00">use_llvm &amp;&amp; have_zcu</text>
</g>
<!-- errdefer -->
<g id="node9" class="node">
<title>errdefer</title>
<polygon fill="none" stroke="black" points="349,-690 164,-690 164,-654 349,-654 349,-690"/>
<text text-anchor="middle" x="256.5" y="-669.5" font-family="Courier,monospace" font-size="10.00">errdefer coff.base.destroy()</text>
</g>
<!-- llvm_object_init&#45;&gt;errdefer -->
<g id="edge8" class="edge">
<title>llvm_object_init&#45;&gt;errdefer</title>
<path fill="none" stroke="black" d="M353.08,-726.99C335.93,-717.4 314.31,-705.32 295.87,-695.01"/>
<polygon fill="black" stroke="black" points="297.55,-691.94 287.11,-690.11 294.13,-698.05 297.55,-691.94"/>
</g>
<!-- llvm_object_init&#45;&gt;error_exit -->
<g id="edge22" class="edge">
<title>llvm_object_init&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M383.5,-726.78C383.5,-712.41 383.5,-691.37 383.5,-673 383.5,-673 383.5,-673 383.5,-422 383.5,-401.55 378.8,-395.64 384.5,-376 405.84,-302.5 459.5,-297.53 459.5,-221 459.5,-221 459.5,-221 459.5,-100 459.5,-80.13 450.02,-59.9 440.52,-44.62"/>
<polygon fill="black" stroke="black" points="443.43,-42.67 435,-36.24 437.58,-46.52 443.43,-42.67"/>
<text text-anchor="middle" x="448.5" y="-379" font-family="Courier,monospace" font-size="10.00">LlvmObject.create 失败</text>
</g>
<!-- check_lld_llvm -->
<g id="node10" class="node">
<title>check_lld_llvm</title>
<polygon fill="none" stroke="black" points="350,-607 123,-607 123,-571 350,-571 350,-607"/>
<text text-anchor="middle" x="236.5" y="-592" font-family="Courier,monospace" font-size="10.00">use_lld &amp;&amp; (use_llvm || !have_zcu)?</text>
<text text-anchor="middle" x="236.5" y="-581" font-family="Courier,monospace" font-size="10.00">返回 coff</text>
</g>
<!-- errdefer&#45;&gt;check_lld_llvm -->
<g id="edge9" class="edge">
<title>errdefer&#45;&gt;check_lld_llvm</title>
<path fill="none" stroke="black" d="M252.26,-653.82C249.63,-643.19 246.21,-629.31 243.22,-617.2"/>
<polygon fill="black" stroke="black" points="246.53,-616.02 240.74,-607.15 239.73,-617.7 246.53,-616.02"/>
</g>
<!-- create_file -->
<g id="node11" class="node">
<title>create_file</title>
<polygon fill="none" stroke="black" points="299,-524 174,-524 174,-488 299,-488 299,-524"/>
<text text-anchor="middle" x="236.5" y="-509" font-family="Courier,monospace" font-size="10.00">创建输出文件</text>
<text text-anchor="middle" x="236.5" y="-498" font-family="Courier,monospace" font-size="10.00">设置 coff.base.file</text>
</g>
<!-- check_lld_llvm&#45;&gt;create_file -->
<g id="edge11" class="edge">
<title>check_lld_llvm&#45;&gt;create_file</title>
<path fill="none" stroke="black" d="M236.5,-570.82C236.5,-560.19 236.5,-546.31 236.5,-534.2"/>
<polygon fill="black" stroke="black" points="240,-534.15 236.5,-524.15 233,-534.15 240,-534.15"/>
<text text-anchor="middle" x="261" y="-545" font-family="Courier,monospace" font-size="10.00">条件不成立</text>
</g>
<!-- return_coff -->
<g id="node17" class="node">
<title>return_coff</title>
<polygon fill="none" stroke="black" points="71,-36 0,-36 0,0 71,0 71,-36"/>
<text text-anchor="middle" x="35.5" y="-15.5" font-family="Courier,monospace" font-size="10.00">返回 coff*</text>
</g>
<!-- check_lld_llvm&#45;&gt;return_coff -->
<g id="edge10" class="edge">
<title>check_lld_llvm&#45;&gt;return_coff</title>
<path fill="none" stroke="black" d="M213.68,-570.88C198.58,-558.84 178.98,-541.75 164.5,-524 110.63,-457.96 94.55,-439.15 68.5,-358 32.75,-246.66 32.54,-105.05 34.3,-46.37"/>
<polygon fill="black" stroke="black" points="37.8,-46.2 34.65,-36.09 30.81,-45.96 37.8,-46.2"/>
<text text-anchor="middle" x="74.5" y="-296" font-family="Courier,monospace" font-size="10.00">条件成立</text>
</g>
<!-- init_strtab -->
<g id="node12" class="node">
<title>init_strtab</title>
<polygon fill="none" stroke="black" points="246,-441 161,-441 161,-405 246,-405 246,-441"/>
<text text-anchor="middle" x="203.5" y="-426" font-family="Courier,monospace" font-size="10.00">初始化字符串表</text>
<text text-anchor="middle" x="203.5" y="-415" font-family="Courier,monospace" font-size="10.00">添加空符号</text>
</g>
<!-- create_file&#45;&gt;init_strtab -->
<g id="edge12" class="edge">
<title>create_file&#45;&gt;init_strtab</title>
<path fill="none" stroke="black" d="M229.5,-487.82C225.08,-476.98 219.28,-462.74 214.29,-450.47"/>
<polygon fill="black" stroke="black" points="217.5,-449.09 210.49,-441.15 211.02,-451.73 217.5,-449.09"/>
</g>
<!-- create_file&#45;&gt;error_exit -->
<g id="edge23" class="edge">
<title>create_file&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M289.4,-487.87C317.18,-475.22 345.5,-454.77 345.5,-424 345.5,-424 345.5,-424 345.5,-297.5 345.5,-270.77 344.97,-261.44 359.5,-239 374.14,-216.39 394.7,-225.7 407.5,-202 434.31,-152.37 430.73,-83.87 425.98,-46.33"/>
<polygon fill="black" stroke="black" points="429.41,-45.59 424.56,-36.17 422.48,-46.56 429.41,-45.59"/>
<text text-anchor="middle" x="402.5" y="-254.5" font-family="Courier,monospace" font-size="10.00">createFile 失败</text>
</g>
<!-- allocate_sections -->
<g id="node13" class="node">
<title>allocate_sections</title>
<polygon fill="none" stroke="black" points="317,-358 78,-358 78,-322 317,-322 317,-358"/>
<text text-anchor="middle" x="197.5" y="-343" font-family="Courier,monospace" font-size="10.00">分配各段:</text>
<text text-anchor="middle" x="197.5" y="-332" font-family="Courier,monospace" font-size="10.00">.text/.got/.rdata/.data/.idata/.reloc</text>
</g>
<!-- init_strtab&#45;&gt;allocate_sections -->
<g id="edge13" class="edge">
<title>init_strtab&#45;&gt;allocate_sections</title>
<path fill="none" stroke="black" d="M202.23,-404.82C201.44,-394.19 200.41,-380.31 199.52,-368.2"/>
<polygon fill="black" stroke="black" points="203,-367.87 198.77,-358.15 196.02,-368.38 203,-367.87"/>
</g>
<!-- handle_strtab_offset -->
<g id="node14" class="node">
<title>handle_strtab_offset</title>
<polygon fill="none" stroke="black" points="249,-275 130,-275 130,-239 249,-239 249,-275"/>
<text text-anchor="middle" x="189.5" y="-260" font-family="Courier,monospace" font-size="10.00">计算 strtab_offset</text>
<text text-anchor="middle" x="189.5" y="-249" font-family="Courier,monospace" font-size="10.00">找到空闲空间</text>
</g>
<!-- allocate_sections&#45;&gt;handle_strtab_offset -->
<g id="edge14" class="edge">
<title>allocate_sections&#45;&gt;handle_strtab_offset</title>
<path fill="none" stroke="black" d="M195.8,-321.82C194.75,-311.19 193.38,-297.31 192.19,-285.2"/>
<polygon fill="black" stroke="black" points="195.66,-284.76 191.19,-275.15 188.69,-285.45 195.66,-284.76"/>
</g>
<!-- allocate_sections&#45;&gt;error_exit -->
<g id="edge24" class="edge">
<title>allocate_sections&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M218.22,-321.88C231.43,-309.97 247.99,-293.04 258.5,-275 283.99,-231.27 257.29,-203.31 291.5,-166 306.06,-150.12 319.81,-161.62 336.5,-148 370.89,-119.94 396.34,-74.25 410.03,-45.45"/>
<polygon fill="black" stroke="black" points="413.37,-46.57 414.38,-36.03 407.02,-43.64 413.37,-46.57"/>
<text text-anchor="middle" x="349.5" y="-181.5" font-family="Courier,monospace" font-size="10.00">allocateSection 失败</text>
</g>
<!-- calc_max_offset -->
<g id="node15" class="node">
<title>calc_max_offset</title>
<polygon fill="none" stroke="black" points="203,-202 72,-202 72,-166 203,-166 203,-202"/>
<text text-anchor="middle" x="137.5" y="-187" font-family="Courier,monospace" font-size="10.00">遍历 sections</text>
<text text-anchor="middle" x="137.5" y="-176" font-family="Courier,monospace" font-size="10.00">计算 max_file_offset</text>
</g>
<!-- handle_strtab_offset&#45;&gt;calc_max_offset -->
<g id="edge15" class="edge">
<title>handle_strtab_offset&#45;&gt;calc_max_offset</title>
<path fill="none" stroke="black" d="M176.91,-238.81C170.65,-230.27 162.96,-219.77 156.05,-210.32"/>
<polygon fill="black" stroke="black" points="158.7,-208.03 149.97,-202.03 153.06,-212.16 158.7,-208.03"/>
</g>
<!-- handle_strtab_offset&#45;&gt;error_exit -->
<g id="edge25" class="edge">
<title>handle_strtab_offset&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M196.97,-238.62C201.39,-228.1 206.99,-214.36 211.5,-202 221.9,-173.48 215.24,-161.97 232.5,-137 269.72,-83.16 340.3,-48.94 383.89,-31.93"/>
<polygon fill="black" stroke="black" points="385.18,-35.18 393.29,-28.36 382.7,-28.64 385.18,-35.18"/>
<text text-anchor="middle" x="284.5" y="-140" font-family="Courier,monospace" font-size="10.00">findFreeSpace 失败</text>
</g>
<!-- pwrite_zero -->
<g id="node16" class="node">
<title>pwrite_zero</title>
<polygon fill="none" stroke="black" points="186,-119 89,-119 89,-83 186,-83 186,-119"/>
<text text-anchor="middle" x="137.5" y="-104" font-family="Courier,monospace" font-size="10.00">在文件末尾填充 0</text>
<text text-anchor="middle" x="137.5" y="-93" font-family="Courier,monospace" font-size="10.00">确保文件大小正确</text>
</g>
<!-- calc_max_offset&#45;&gt;pwrite_zero -->
<g id="edge16" class="edge">
<title>calc_max_offset&#45;&gt;pwrite_zero</title>
<path fill="none" stroke="black" d="M137.5,-165.82C137.5,-155.19 137.5,-141.31 137.5,-129.2"/>
<polygon fill="black" stroke="black" points="141,-129.15 137.5,-119.15 134,-129.15 141,-129.15"/>
</g>
<!-- pwrite_zero&#45;&gt;return_coff -->
<g id="edge17" class="edge">
<title>pwrite_zero&#45;&gt;return_coff</title>
<path fill="none" stroke="black" d="M115.87,-82.82C101.13,-71.12 81.42,-55.47 65.21,-42.6"/>
<polygon fill="black" stroke="black" points="67.11,-39.63 57.1,-36.15 62.75,-45.11 67.11,-39.63"/>
</g>
<!-- pwrite_zero&#45;&gt;error_exit -->
<g id="edge26" class="edge">
<title>pwrite_zero&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M132.42,-82.74C130.73,-73.16 130.73,-61.66 137.5,-54 153.5,-35.91 309.03,-25.11 382.9,-20.96"/>
<polygon fill="black" stroke="black" points="383.39,-24.44 393.18,-20.4 383.01,-17.45 383.39,-24.44"/>
<text text-anchor="middle" x="177.5" y="-57" font-family="Courier,monospace" font-size="10.00">pwriteAll 失败</text>
</g>
</g>
</svg>
