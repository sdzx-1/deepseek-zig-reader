flowchart TD
    A[开始] --> B[调用dev.check]
    B --> C[初始化arena_allocator和gpa]
    C --> D[查找def文件]
    D -->|找到| E[获取目标target]
    D -->|FileNotFound| F[记录日志并返回]
    E --> G[初始化缓存cache]
    G --> H[添加前缀到cache]
    H --> I[计算缓存哈希]
    I --> J[获取缓存manifest]
    J --> K[添加def文件到manifest]
    K --> L[生成final_lib_basename]
    L --> M{缓存命中?}
    M -->|是| N[生成digest和sub_path]
    N --> O[加锁]
    O --> P[添加crt_files]
    P --> Q[解锁并返回]
    M -->|否| R[生成digest和o_sub_path]
    R --> S[创建o_dir]
    S --> T[生成target_defines]
    T --> U[初始化aro预处理器]
    U --> V[添加包含目录和宏]
    V --> W[预处理def文件]
    W --> X{存在错误?}
    X -->|是| Y[渲染错误并返回]
    X -->|否| Z[写入预处理后的def文件]
    Z --> AA[调用LLVM生成lib]
    AA --> AB{生成成功?}
    AB -->|否| AC[记录错误并返回]
    AB -->|是| AD[写入缓存manifest]
    AD --> AE[加锁]
    AE --> AF[添加crt_files]
    AF --> AG[解锁并返回]
    F --> AH[结束]
    Q --> AH
    AC --> AH
    Y --> AH
    AG --> AH
