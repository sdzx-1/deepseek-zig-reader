graph TD
    A[开始] --> B[解析ZIR指令并验证操作码]
    B --> C[提取small结构中的各种长度信息]
    C --> D[跳过captures和decls]
    D --> E[处理body部分]
    E --> F[创建block_scope]
    F --> G{body是否非空?}
    G -- 是 --> H[分析内联body]
    G -- 否 --> I[处理tag类型]
    H --> I
    I --> J{存在tag_type_ref?}
    J -- 是 --> K[解析提供的标签类型]
    J -- 否 --> L[生成自动枚举标签类型]
    K --> M{是auto_enum_tag?}
    M -- 是 --> N[验证整数类型并生成枚举]
    M -- 否 --> O[加载显式枚举并验证字段]
    N --> P[初始化字段值跟踪]
    O --> Q[初始化显式标签检查数组]
    L --> P
    Q --> R[遍历所有字段]
    R --> S[解析字段名/类型/对齐/标签]
    S --> T{存在显式标签?}
    T -- 是 --> U[检查标签唯一性并记录]
    T -- 否 --> V[生成自动递增值]
    U --> W[验证字段类型合法性]
    V --> W
    W --> X{布局检查?}
    X -- extern --> Y[验证extern类型]
    X -- packed --> Z[验证packed类型]
    X -- 其他 --> AA[收集字段类型和对齐]
    Y --> AA
    Z --> AA
    AA --> AB[添加到字段列表]
    AB --> AC{还有更多字段?}
    AC -- 是 --> R
    AC -- 否 --> AD[设置联合类型字段信息]
    AD --> AE{显式标签存在缺失?}
    AE -- 是 --> AF[生成缺失字段错误]
    AE -- 否 --> AG[生成最终枚举标签类型]
    AG --> AH[导出处理]
    AH --> AI[结束]
    AF --> AI
