<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="649pt" height="1204pt"
 viewBox="0.00 0.00 649.16 1204.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1200)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1200 645.16,-1200 645.16,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="406,-1196 305,-1196 305,-1160 406,-1160 406,-1196"/>
<text text-anchor="middle" x="355.5" y="-1174.9" font-family="Courier,monospace" font-size="12.00">spawn() 入口</text>
</g>
<!-- init_arena -->
<g id="node2" class="node">
<title>init_arena</title>
<polygon fill="none" stroke="black" points="441,-1123 270,-1123 270,-1087 441,-1087 441,-1123"/>
<text text-anchor="middle" x="355.5" y="-1108.4" font-family="Courier,monospace" font-size="12.00">初始化 arena_allocator</text>
<text text-anchor="middle" x="355.5" y="-1095.4" font-family="Courier,monospace" font-size="12.00">(带 defer 释放)</text>
</g>
<!-- start&#45;&gt;init_arena -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init_arena</title>
<path fill="none" stroke="black" d="M355.5,-1159.81C355.5,-1151.79 355.5,-1142.05 355.5,-1133.07"/>
<polygon fill="black" stroke="black" points="359,-1133.03 355.5,-1123.03 352,-1133.03 359,-1133.03"/>
</g>
<!-- alloc_argv_buf -->
<g id="node3" class="node">
<title>alloc_argv_buf</title>
<polygon fill="none" stroke="black" points="454,-1050 257,-1050 257,-1014 454,-1014 454,-1050"/>
<text text-anchor="middle" x="355.5" y="-1035.4" font-family="Courier,monospace" font-size="12.00">分配 argv_buf</text>
<text text-anchor="middle" x="355.5" y="-1022.4" font-family="Courier,monospace" font-size="12.00">arena.allocSentinel(...)</text>
</g>
<!-- init_arena&#45;&gt;alloc_argv_buf -->
<g id="edge2" class="edge">
<title>init_arena&#45;&gt;alloc_argv_buf</title>
<path fill="none" stroke="black" d="M355.5,-1086.81C355.5,-1078.79 355.5,-1069.05 355.5,-1060.07"/>
<polygon fill="black" stroke="black" points="359,-1060.03 355.5,-1050.03 352,-1060.03 359,-1060.03"/>
</g>
<!-- fill_argv -->
<g id="node4" class="node">
<title>fill_argv</title>
<polygon fill="none" stroke="black" points="421,-977 290,-977 290,-941 421,-941 421,-977"/>
<text text-anchor="middle" x="355.5" y="-962.4" font-family="Courier,monospace" font-size="12.00">循环填充 argv_buf</text>
<text text-anchor="middle" x="355.5" y="-949.4" font-family="Courier,monospace" font-size="12.00">(处理每个参数)</text>
</g>
<!-- alloc_argv_buf&#45;&gt;fill_argv -->
<g id="edge3" class="edge">
<title>alloc_argv_buf&#45;&gt;fill_argv</title>
<path fill="none" stroke="black" d="M355.5,-1013.81C355.5,-1005.79 355.5,-996.05 355.5,-987.07"/>
<polygon fill="black" stroke="black" points="359,-987.03 355.5,-977.03 352,-987.03 359,-987.03"/>
</g>
<!-- create_envp -->
<g id="node5" class="node">
<title>create_envp</title>
<polygon fill="none" stroke="black" points="446.5,-904 264.5,-904 264.5,-868 446.5,-868 446.5,-904"/>
<text text-anchor="middle" x="355.5" y="-889.4" font-family="Courier,monospace" font-size="12.00">创建环境变量 envp</text>
<text text-anchor="middle" x="355.5" y="-876.4" font-family="Courier,monospace" font-size="12.00">createEnvironFromMap()</text>
</g>
<!-- fill_argv&#45;&gt;create_envp -->
<g id="edge4" class="edge">
<title>fill_argv&#45;&gt;create_envp</title>
<path fill="none" stroke="black" d="M355.5,-940.81C355.5,-932.79 355.5,-923.05 355.5,-914.07"/>
<polygon fill="black" stroke="black" points="359,-914.03 355.5,-904.03 352,-914.03 359,-914.03"/>
</g>
<!-- fork -->
<g id="node6" class="node">
<title>fork</title>
<polygon fill="none" stroke="black" points="424,-831 287,-831 287,-795 424,-795 424,-831"/>
<text text-anchor="middle" x="355.5" y="-809.9" font-family="Courier,monospace" font-size="12.00">调用 posix.fork()</text>
</g>
<!-- create_envp&#45;&gt;fork -->
<g id="edge5" class="edge">
<title>create_envp&#45;&gt;fork</title>
<path fill="none" stroke="black" d="M355.5,-867.81C355.5,-859.79 355.5,-850.05 355.5,-841.07"/>
<polygon fill="black" stroke="black" points="359,-841.03 355.5,-831.03 352,-841.03 359,-841.03"/>
</g>
<!-- check_pid -->
<g id="node7" class="node">
<title>check_pid</title>
<polygon fill="none" stroke="black" points="355.5,-758 282.24,-740 355.5,-722 428.76,-740 355.5,-758"/>
<text text-anchor="middle" x="355.5" y="-736.9" font-family="Courier,monospace" font-size="12.00">pid == 0?</text>
</g>
<!-- fork&#45;&gt;check_pid -->
<g id="edge6" class="edge">
<title>fork&#45;&gt;check_pid</title>
<path fill="none" stroke="black" d="M355.5,-794.81C355.5,-786.79 355.5,-777.05 355.5,-768.07"/>
<polygon fill="black" stroke="black" points="359,-768.03 355.5,-758.03 352,-768.03 359,-768.03"/>
</g>
<!-- child_start -->
<g id="node8" class="node">
<title>child_start</title>
<polygon fill="none" stroke="black" points="347,-675 270,-675 270,-639 347,-639 347,-675"/>
<text text-anchor="middle" x="308.5" y="-653.9" font-family="Courier,monospace" font-size="12.00">子进程开始</text>
</g>
<!-- check_pid&#45;&gt;child_start -->
<g id="edge7" class="edge">
<title>check_pid&#45;&gt;child_start</title>
<path fill="none" stroke="black" d="M346.66,-723.76C340.13,-712.52 331.1,-696.95 323.46,-683.78"/>
<polygon fill="black" stroke="black" points="326.49,-682.02 318.44,-675.13 320.43,-685.54 326.49,-682.02"/>
<text text-anchor="middle" x="340.5" y="-696" font-family="Courier,monospace" font-size="10.00">是</text>
</g>
<!-- parent_start -->
<g id="node16" class="node">
<title>parent_start</title>
<polygon fill="none" stroke="black" points="447,-675 370,-675 370,-639 447,-639 447,-675"/>
<text text-anchor="middle" x="408.5" y="-653.9" font-family="Courier,monospace" font-size="12.00">父进程开始</text>
</g>
<!-- check_pid&#45;&gt;parent_start -->
<g id="edge17" class="edge">
<title>check_pid&#45;&gt;parent_start</title>
<path fill="none" stroke="black" d="M365.22,-724.14C372.6,-712.86 382.93,-697.07 391.65,-683.75"/>
<polygon fill="black" stroke="black" points="394.83,-685.29 397.37,-675 388.97,-681.46 394.83,-685.29"/>
<text text-anchor="middle" x="390.5" y="-696" font-family="Courier,monospace" font-size="10.00">否</text>
</g>
<!-- setsid -->
<g id="node9" class="node">
<title>setsid</title>
<polygon fill="none" stroke="black" points="334,-602 227,-602 227,-566 334,-566 334,-602"/>
<text text-anchor="middle" x="280.5" y="-580.9" font-family="Courier,monospace" font-size="12.00">调用 setsid()</text>
</g>
<!-- child_start&#45;&gt;setsid -->
<g id="edge8" class="edge">
<title>child_start&#45;&gt;setsid</title>
<path fill="none" stroke="black" d="M301.72,-638.81C298.49,-630.62 294.55,-620.62 290.94,-611.48"/>
<polygon fill="black" stroke="black" points="294.14,-610.05 287.22,-602.03 287.63,-612.62 294.14,-610.05"/>
</g>
<!-- ioctl_terminal -->
<g id="node10" class="node">
<title>ioctl_terminal</title>
<polygon fill="none" stroke="black" points="241.5,-529 97.5,-529 97.5,-493 241.5,-493 241.5,-529"/>
<text text-anchor="middle" x="169.5" y="-514.4" font-family="Courier,monospace" font-size="12.00">设置控制终端</text>
<text text-anchor="middle" x="169.5" y="-501.4" font-family="Courier,monospace" font-size="12.00">ioctl(T.IOCSCTTY)</text>
</g>
<!-- setsid&#45;&gt;ioctl_terminal -->
<g id="edge9" class="edge">
<title>setsid&#45;&gt;ioctl_terminal</title>
<path fill="none" stroke="black" d="M253.91,-565.99C239.19,-556.58 220.71,-544.76 204.79,-534.57"/>
<polygon fill="black" stroke="black" points="206.57,-531.55 196.26,-529.11 202.79,-537.45 206.57,-531.55"/>
</g>
<!-- dup2_io -->
<g id="node11" class="node">
<title>dup2_io</title>
<polygon fill="none" stroke="black" points="215,-446 14,-446 14,-410 215,-410 215,-446"/>
<text text-anchor="middle" x="114.5" y="-431.4" font-family="Courier,monospace" font-size="12.00">重定向 stdin/stdout/stderr</text>
<text text-anchor="middle" x="114.5" y="-418.4" font-family="Courier,monospace" font-size="12.00">三次 dup2 调用</text>
</g>
<!-- ioctl_terminal&#45;&gt;dup2_io -->
<g id="edge11" class="edge">
<title>ioctl_terminal&#45;&gt;dup2_io</title>
<path fill="none" stroke="black" d="M157.84,-492.82C150.33,-481.76 140.42,-467.18 131.98,-454.75"/>
<polygon fill="black" stroke="black" points="134.66,-452.46 126.15,-446.15 128.87,-456.39 134.66,-452.46"/>
<text text-anchor="middle" x="155.5" y="-467" font-family="Courier,monospace" font-size="10.00">成功</text>
</g>
<!-- error_ioctl -->
<g id="node21" class="node">
<title>error_ioctl</title>
<ellipse fill="none" stroke="black" cx="248.5" cy="-374" rx="102.61" ry="18"/>
<text text-anchor="middle" x="248.5" y="-370.9" font-family="Courier,monospace" font-size="12.00">返回 error.IoctlError</text>
</g>
<!-- ioctl_terminal&#45;&gt;error_ioctl -->
<g id="edge10" class="edge">
<title>ioctl_terminal&#45;&gt;error_ioctl</title>
<path fill="none" stroke="black" d="M186.99,-492.84C198.62,-480.65 213.54,-463.41 223.5,-446 231.36,-432.26 237.38,-415.63 241.54,-401.92"/>
<polygon fill="black" stroke="black" points="244.96,-402.67 244.36,-392.1 238.24,-400.74 244.96,-402.67"/>
<text text-anchor="middle" x="221.5" y="-467" font-family="Courier,monospace" font-size="10.00">失败</text>
</g>
<!-- close_fds -->
<g id="node12" class="node">
<title>close_fds</title>
<polygon fill="none" stroke="black" points="202,-338 25,-338 25,-302 202,-302 202,-338"/>
<text text-anchor="middle" x="113.5" y="-316.9" font-family="Courier,monospace" font-size="12.00">关闭 pty.tty 和 pty.pty</text>
</g>
<!-- dup2_io&#45;&gt;close_fds -->
<g id="edge12" class="edge">
<title>dup2_io&#45;&gt;close_fds</title>
<path fill="none" stroke="black" d="M114.34,-409.97C114.18,-393.38 113.94,-367.88 113.76,-348.43"/>
<polygon fill="black" stroke="black" points="117.26,-348.31 113.66,-338.34 110.26,-348.37 117.26,-348.31"/>
</g>
<!-- chdir -->
<g id="node13" class="node">
<title>chdir</title>
<polygon fill="none" stroke="black" points="221,-265 0,-265 0,-229 221,-229 221,-265"/>
<text text-anchor="middle" x="110.5" y="-250.4" font-family="Courier,monospace" font-size="12.00">切换工作目录</text>
<text text-anchor="middle" x="110.5" y="-237.4" font-family="Courier,monospace" font-size="12.00">(如果 working_directory 存在)</text>
</g>
<!-- close_fds&#45;&gt;chdir -->
<g id="edge13" class="edge">
<title>close_fds&#45;&gt;chdir</title>
<path fill="none" stroke="black" d="M112.77,-301.81C112.43,-293.79 112.02,-284.05 111.64,-275.07"/>
<polygon fill="black" stroke="black" points="115.14,-274.87 111.22,-265.03 108.14,-275.17 115.14,-274.87"/>
</g>
<!-- exec -->
<g id="node14" class="node">
<title>exec</title>
<polygon fill="none" stroke="black" points="171.5,-192 49.5,-192 49.5,-156 171.5,-156 171.5,-192"/>
<text text-anchor="middle" x="110.5" y="-170.9" font-family="Courier,monospace" font-size="12.00">执行 execvpeZ()</text>
</g>
<!-- chdir&#45;&gt;exec -->
<g id="edge14" class="edge">
<title>chdir&#45;&gt;exec</title>
<path fill="none" stroke="black" d="M110.5,-228.81C110.5,-220.79 110.5,-211.05 110.5,-202.07"/>
<polygon fill="black" stroke="black" points="114,-202.03 110.5,-192.03 107,-202.03 114,-202.03"/>
</g>
<!-- child_end -->
<g id="node15" class="node">
<title>child_end</title>
<polygon fill="none" stroke="black" points="171,-36 94,-36 94,0 171,0 171,-36"/>
<text text-anchor="middle" x="132.5" y="-14.9" font-family="Courier,monospace" font-size="12.00">子进程结束</text>
</g>
<!-- exec&#45;&gt;child_end -->
<g id="edge16" class="edge">
<title>exec&#45;&gt;child_end</title>
<path fill="none" stroke="black" d="M67.61,-155.95C47.64,-145.58 25.84,-130.19 14.5,-109 6.95,-94.89 5.85,-86.46 14.5,-73 29.87,-49.07 58.77,-35.61 84.13,-28.11"/>
<polygon fill="black" stroke="black" points="85.27,-31.43 94,-25.43 83.43,-24.67 85.27,-31.43"/>
<text text-anchor="middle" x="24.5" y="-88.5" font-family="Courier,monospace" font-size="10.00">成功</text>
</g>
<!-- error_exec -->
<g id="node22" class="node">
<title>error_exec</title>
<ellipse fill="none" stroke="black" cx="132.5" cy="-91" rx="88.79" ry="18"/>
<text text-anchor="middle" x="132.5" y="-87.9" font-family="Courier,monospace" font-size="12.00">execvpeZ 错误时终止</text>
</g>
<!-- exec&#45;&gt;error_exec -->
<g id="edge15" class="edge">
<title>exec&#45;&gt;error_exec</title>
<path fill="none" stroke="black" d="M115.17,-155.82C118.08,-145.08 121.9,-131.03 125.21,-118.84"/>
<polygon fill="black" stroke="black" points="128.6,-119.72 127.84,-109.15 121.84,-117.89 128.6,-119.72"/>
<text text-anchor="middle" x="133.5" y="-130" font-family="Courier,monospace" font-size="10.00">失败</text>
</g>
<!-- save_pid -->
<g id="node17" class="node">
<title>save_pid</title>
<polygon fill="none" stroke="black" points="492.5,-602 370.5,-602 370.5,-566 492.5,-566 492.5,-602"/>
<text text-anchor="middle" x="431.5" y="-587.4" font-family="Courier,monospace" font-size="12.00">保存 pid</text>
<text text-anchor="middle" x="431.5" y="-574.4" font-family="Courier,monospace" font-size="12.00">self.pid = pid</text>
</g>
<!-- parent_start&#45;&gt;save_pid -->
<g id="edge18" class="edge">
<title>parent_start&#45;&gt;save_pid</title>
<path fill="none" stroke="black" d="M414.07,-638.81C416.7,-630.7 419.89,-620.84 422.83,-611.78"/>
<polygon fill="black" stroke="black" points="426.23,-612.62 425.98,-602.03 419.57,-610.46 426.23,-612.62"/>
</g>
<!-- check_sigchild -->
<g id="node18" class="node">
<title>check_sigchild</title>
<polygon fill="none" stroke="black" points="450.5,-529 259.69,-511 450.5,-493 641.31,-511 450.5,-529"/>
<text text-anchor="middle" x="450.5" y="-507.9" font-family="Courier,monospace" font-size="12.00">!global_sigchild_installed?</text>
</g>
<!-- save_pid&#45;&gt;check_sigchild -->
<g id="edge19" class="edge">
<title>save_pid&#45;&gt;check_sigchild</title>
<path fill="none" stroke="black" d="M436.1,-565.81C438.27,-557.7 440.91,-547.84 443.33,-538.78"/>
<polygon fill="black" stroke="black" points="446.74,-539.59 445.94,-529.03 439.98,-537.78 446.74,-539.59"/>
</g>
<!-- install_sigaction -->
<g id="node19" class="node">
<title>install_sigaction</title>
<polygon fill="none" stroke="black" points="435,-446 280,-446 280,-410 435,-410 435,-446"/>
<text text-anchor="middle" x="357.5" y="-431.4" font-family="Courier,monospace" font-size="12.00">安装 SIGCHLD 处理函数</text>
<text text-anchor="middle" x="357.5" y="-418.4" font-family="Courier,monospace" font-size="12.00">sigaction()</text>
</g>
<!-- check_sigchild&#45;&gt;install_sigaction -->
<g id="edge20" class="edge">
<title>check_sigchild&#45;&gt;install_sigaction</title>
<path fill="none" stroke="black" d="M432.57,-494.38C419.08,-482.64 400.37,-466.34 385,-452.95"/>
<polygon fill="black" stroke="black" points="387.15,-450.18 377.31,-446.25 382.55,-455.46 387.15,-450.18"/>
<text text-anchor="middle" x="415.5" y="-467" font-family="Courier,monospace" font-size="10.00">是</text>
</g>
<!-- return -->
<g id="node20" class="node">
<title>return</title>
<polygon fill="none" stroke="black" points="465.5,-338 411.5,-338 411.5,-302 465.5,-302 465.5,-338"/>
<text text-anchor="middle" x="438.5" y="-316.9" font-family="Courier,monospace" font-size="12.00">返回</text>
</g>
<!-- check_sigchild&#45;&gt;return -->
<g id="edge21" class="edge">
<title>check_sigchild&#45;&gt;return</title>
<path fill="none" stroke="black" d="M449.41,-492.89C447.33,-460.02 442.74,-387.76 440.23,-348.2"/>
<polygon fill="black" stroke="black" points="443.72,-347.96 439.59,-338.2 436.73,-348.41 443.72,-347.96"/>
<text text-anchor="middle" x="451.5" y="-425.5" font-family="Courier,monospace" font-size="10.00">否</text>
</g>
<!-- install_sigaction&#45;&gt;return -->
<g id="edge22" class="edge">
<title>install_sigaction&#45;&gt;return</title>
<path fill="none" stroke="black" d="M370.51,-409.97C383.66,-392.76 404.13,-365.98 419.17,-346.29"/>
<polygon fill="black" stroke="black" points="421.96,-348.41 425.25,-338.34 416.4,-344.16 421.96,-348.41"/>
</g>
<!-- error_ioctl&#45;&gt;child_end -->
<!-- error_exec&#45;&gt;child_end -->
</g>
</svg>
