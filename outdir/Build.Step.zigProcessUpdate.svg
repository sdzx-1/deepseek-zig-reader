<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: zigProcessUpdate Pages: 1 -->
<svg width="775pt" height="1147pt"
 viewBox="0.00 0.00 775.00 1147.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1143)">
<title>zigProcessUpdate</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1143 771,-1143 771,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<ellipse fill="none" stroke="black" cx="612" cy="-1121" rx="27" ry="18"/>
<text text-anchor="middle" x="612" y="-1118.5" font-family="Courier,monospace" font-size="10.00">开始</text>
</g>
<!-- init_vars -->
<g id="node2" class="node">
<title>init_vars</title>
<polygon fill="none" stroke="black" points="677.5,-1066 546.5,-1066 546.5,-1014 677.5,-1014 677.5,-1066"/>
<text text-anchor="middle" x="612" y="-1054" font-family="Courier,monospace" font-size="10.00">初始化变量</text>
<text text-anchor="middle" x="612" y="-1043" font-family="Courier,monospace" font-size="10.00">b = s.owner</text>
<text text-anchor="middle" x="612" y="-1032" font-family="Courier,monospace" font-size="10.00">arena = b.allocator</text>
<text text-anchor="middle" x="612" y="-1021" font-family="Courier,monospace" font-size="10.00">timer启动</text>
</g>
<!-- start&#45;&gt;init_vars -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init_vars</title>
<path fill="none" stroke="black" d="M612,-1102.86C612,-1095.08 612,-1085.57 612,-1076.37"/>
<polygon fill="black" stroke="black" points="615.5,-1076.21 612,-1066.21 608.5,-1076.21 615.5,-1076.21"/>
</g>
<!-- send_messages -->
<g id="node3" class="node">
<title>send_messages</title>
<polygon fill="none" stroke="black" points="679.5,-977 544.5,-977 544.5,-936 679.5,-936 679.5,-977"/>
<text text-anchor="middle" x="612" y="-965" font-family="Courier,monospace" font-size="10.00">发送消息到子进程stdin</text>
<text text-anchor="middle" x="612" y="-954" font-family="Courier,monospace" font-size="10.00">发送.update消息</text>
<text text-anchor="middle" x="612" y="-943" font-family="Courier,monospace" font-size="10.00">若非watch模式发送.exit</text>
</g>
<!-- init_vars&#45;&gt;send_messages -->
<g id="edge2" class="edge">
<title>init_vars&#45;&gt;send_messages</title>
<path fill="none" stroke="black" d="M612,-1013.66C612,-1005.29 612,-995.9 612,-987.23"/>
<polygon fill="black" stroke="black" points="615.5,-987.13 612,-977.13 608.5,-987.13 615.5,-987.13"/>
</g>
<!-- poll_loop -->
<g id="node4" class="node">
<title>poll_loop</title>
<polygon fill="none" stroke="black" points="612,-899 545.3,-881 612,-863 678.7,-881 612,-899"/>
<text text-anchor="middle" x="612" y="-878.5" font-family="Courier,monospace" font-size="10.00">进入poll循环</text>
</g>
<!-- send_messages&#45;&gt;poll_loop -->
<g id="edge3" class="edge">
<title>send_messages&#45;&gt;poll_loop</title>
<path fill="none" stroke="black" d="M612,-935.8C612,-927.7 612,-918.18 612,-909.41"/>
<polygon fill="black" stroke="black" points="615.5,-909.25 612,-899.25 608.5,-909.25 615.5,-909.25"/>
</g>
<!-- check_header -->
<g id="node5" class="node">
<title>check_header</title>
<polygon fill="none" stroke="black" points="651.5,-816 540.5,-816 540.5,-780 651.5,-780 651.5,-816"/>
<text text-anchor="middle" x="596" y="-801" font-family="Courier,monospace" font-size="10.00">检查stdout可读长度</text>
<text text-anchor="middle" x="596" y="-790" font-family="Courier,monospace" font-size="10.00">是否足够读取Header</text>
</g>
<!-- poll_loop&#45;&gt;check_header -->
<g id="edge4" class="edge">
<title>poll_loop&#45;&gt;check_header</title>
<path fill="none" stroke="black" d="M631.33,-868.13C643.12,-859.29 654.72,-846.62 648,-834 645.81,-829.89 642.9,-826.18 639.58,-822.84"/>
<polygon fill="black" stroke="black" points="641.61,-819.98 631.74,-816.14 637.06,-825.3 641.61,-819.98"/>
<text text-anchor="middle" x="669" y="-837" font-family="Courier,monospace" font-size="10.00">进入循环</text>
</g>
<!-- check_header&#45;&gt;poll_loop -->
<g id="edge5" class="edge">
<title>check_header&#45;&gt;poll_loop</title>
<path fill="none" stroke="black" d="M563.35,-816.01C552.56,-824.01 544.73,-834.17 551,-845 556.23,-854.03 564.77,-860.94 573.83,-866.13"/>
<polygon fill="black" stroke="black" points="572.45,-869.35 582.95,-870.76 575.62,-863.11 572.45,-869.35"/>
<text text-anchor="middle" x="597.5" y="-837" font-family="Courier,monospace" font-size="10.00">长度不足且poll失败</text>
</g>
<!-- read_header -->
<g id="node6" class="node">
<title>read_header</title>
<polygon fill="none" stroke="black" points="621,-733 529,-733 529,-697 621,-697 621,-733"/>
<text text-anchor="middle" x="575" y="-712.5" font-family="Courier,monospace" font-size="10.00">读取Header结构</text>
</g>
<!-- check_header&#45;&gt;read_header -->
<g id="edge6" class="edge">
<title>check_header&#45;&gt;read_header</title>
<path fill="none" stroke="black" d="M591.55,-779.82C588.76,-769.08 585.12,-755.03 581.96,-742.84"/>
<polygon fill="black" stroke="black" points="585.34,-741.95 579.45,-733.15 578.57,-743.71 585.34,-741.95"/>
<text text-anchor="middle" x="606" y="-754" font-family="Courier,monospace" font-size="10.00">长度足够</text>
</g>
<!-- check_body -->
<g id="node7" class="node">
<title>check_body</title>
<polygon fill="none" stroke="black" points="535.5,-660 424.5,-660 424.5,-624 535.5,-624 535.5,-660"/>
<text text-anchor="middle" x="480" y="-645" font-family="Courier,monospace" font-size="10.00">检查stdout可读长度</text>
<text text-anchor="middle" x="480" y="-634" font-family="Courier,monospace" font-size="10.00">是否足够读取body</text>
</g>
<!-- read_header&#45;&gt;check_body -->
<g id="edge7" class="edge">
<title>read_header&#45;&gt;check_body</title>
<path fill="none" stroke="black" d="M552,-696.81C539.63,-687.57 524.21,-676.04 510.82,-666.03"/>
<polygon fill="black" stroke="black" points="512.89,-663.21 502.79,-660.03 508.7,-668.82 512.89,-663.21"/>
</g>
<!-- check_body&#45;&gt;poll_loop -->
<g id="edge8" class="edge">
<title>check_body&#45;&gt;poll_loop</title>
<path fill="none" stroke="black" d="M478.19,-660.1C476.32,-683.73 475.12,-727.35 487,-762 501.51,-804.33 510.42,-815.42 544,-845 553.5,-853.37 565.35,-860.35 576.48,-865.83"/>
<polygon fill="black" stroke="black" points="575.06,-869.03 585.6,-870.07 578.01,-862.68 575.06,-869.03"/>
<text text-anchor="middle" x="533.5" y="-754" font-family="Courier,monospace" font-size="10.00">长度不足且poll失败</text>
</g>
<!-- read_body -->
<g id="node8" class="node">
<title>read_body</title>
<polygon fill="none" stroke="black" points="464,-577 384,-577 384,-541 464,-541 464,-577"/>
<text text-anchor="middle" x="424" y="-556.5" font-family="Courier,monospace" font-size="10.00">读取body数据</text>
</g>
<!-- check_body&#45;&gt;read_body -->
<g id="edge9" class="edge">
<title>check_body&#45;&gt;read_body</title>
<path fill="none" stroke="black" d="M468.12,-623.82C460.4,-612.65 450.2,-597.9 441.55,-585.38"/>
<polygon fill="black" stroke="black" points="444.42,-583.39 435.86,-577.15 438.67,-587.37 444.42,-583.39"/>
<text text-anchor="middle" x="476" y="-598" font-family="Courier,monospace" font-size="10.00">长度足够</text>
</g>
<!-- process_message -->
<g id="node9" class="node">
<title>process_message</title>
<polygon fill="none" stroke="black" points="410,-504 347.63,-486 410,-468 472.37,-486 410,-504"/>
<text text-anchor="middle" x="410" y="-483.5" font-family="Courier,monospace" font-size="10.00">处理消息类型</text>
</g>
<!-- read_body&#45;&gt;process_message -->
<g id="edge10" class="edge">
<title>read_body&#45;&gt;process_message</title>
<path fill="none" stroke="black" d="M420.61,-540.81C418.99,-532.58 417.01,-522.54 415.2,-513.38"/>
<polygon fill="black" stroke="black" points="418.63,-512.67 413.26,-503.54 411.76,-514.03 418.63,-512.67"/>
</g>
<!-- zig_version -->
<g id="node10" class="node">
<title>zig_version</title>
<polygon fill="none" stroke="black" points="341.5,-421 190.5,-421 190.5,-385 341.5,-385 341.5,-421"/>
<text text-anchor="middle" x="266" y="-406" font-family="Courier,monospace" font-size="10.00">版本检查</text>
<text text-anchor="middle" x="266" y="-395" font-family="Courier,monospace" font-size="10.00">比较builtin版本与body内容</text>
</g>
<!-- process_message&#45;&gt;zig_version -->
<g id="edge11" class="edge">
<title>process_message&#45;&gt;zig_version</title>
<path fill="none" stroke="black" d="M384.83,-475.11C369.25,-468.66 349.05,-459.65 332,-450 320.01,-443.21 307.47,-434.83 296.57,-427.08"/>
<polygon fill="black" stroke="black" points="298.38,-424.07 288.23,-421.05 294.28,-429.75 298.38,-424.07"/>
<text text-anchor="middle" x="368.5" y="-442" font-family="Courier,monospace" font-size="10.00">.zig_version</text>
</g>
<!-- error_bundle -->
<g id="node11" class="node">
<title>error_bundle</title>
<polygon fill="none" stroke="black" points="172,-421 0,-421 0,-385 172,-385 172,-421"/>
<text text-anchor="middle" x="86" y="-406" font-family="Courier,monospace" font-size="10.00">处理错误包</text>
<text text-anchor="middle" x="86" y="-395" font-family="Courier,monospace" font-size="10.00">记录到s.result_error_bundle</text>
</g>
<!-- process_message&#45;&gt;error_bundle -->
<g id="edge12" class="edge">
<title>process_message&#45;&gt;error_bundle</title>
<path fill="none" stroke="black" d="M372.44,-478.79C336.43,-472.55 280.66,-462.13 233,-450 203.92,-442.6 172.09,-432.85 145.5,-424.23"/>
<polygon fill="black" stroke="black" points="146.55,-420.89 135.96,-421.11 144.38,-427.54 146.55,-420.89"/>
<text text-anchor="middle" x="272.5" y="-442" font-family="Courier,monospace" font-size="10.00">.error_bundle</text>
</g>
<!-- emit_digest -->
<g id="node12" class="node">
<title>emit_digest</title>
<polygon fill="none" stroke="black" points="565,-421 473,-421 473,-385 565,-385 565,-421"/>
<text text-anchor="middle" x="519" y="-406" font-family="Courier,monospace" font-size="10.00">生成emit摘要</text>
<text text-anchor="middle" x="519" y="-395" font-family="Courier,monospace" font-size="10.00">设置result路径</text>
</g>
<!-- process_message&#45;&gt;emit_digest -->
<g id="edge13" class="edge">
<title>process_message&#45;&gt;emit_digest</title>
<path fill="none" stroke="black" d="M426.55,-472.7C442.71,-460.69 467.69,-442.13 487.62,-427.32"/>
<polygon fill="black" stroke="black" points="489.87,-430.01 495.81,-421.24 485.69,-424.39 489.87,-430.01"/>
<text text-anchor="middle" x="508.5" y="-442" font-family="Courier,monospace" font-size="10.00">.emit_digest</text>
</g>
<!-- file_system_inputs -->
<g id="node13" class="node">
<title>file_system_inputs</title>
<polygon fill="none" stroke="black" points="698.5,-421 583.5,-421 583.5,-385 698.5,-385 698.5,-421"/>
<text text-anchor="middle" x="641" y="-406" font-family="Courier,monospace" font-size="10.00">处理文件系统输入</text>
<text text-anchor="middle" x="641" y="-395" font-family="Courier,monospace" font-size="10.00">清理并添加watch输入</text>
</g>
<!-- process_message&#45;&gt;file_system_inputs -->
<g id="edge14" class="edge">
<title>process_message&#45;&gt;file_system_inputs</title>
<path fill="none" stroke="black" d="M445.78,-478.23C474.24,-472.31 514.82,-462.68 549,-450 566.92,-443.36 585.93,-434.23 601.99,-425.86"/>
<polygon fill="black" stroke="black" points="603.88,-428.82 611.07,-421.04 600.6,-422.63 603.88,-428.82"/>
<text text-anchor="middle" x="632.5" y="-442" font-family="Courier,monospace" font-size="10.00">.file_system_inputs</text>
</g>
<!-- other_message -->
<g id="node14" class="node">
<title>other_message</title>
<polygon fill="none" stroke="black" points="454.5,-421 359.5,-421 359.5,-385 454.5,-385 454.5,-421"/>
<text text-anchor="middle" x="407" y="-400.5" font-family="Courier,monospace" font-size="10.00">忽略其他消息类型</text>
</g>
<!-- process_message&#45;&gt;other_message -->
<g id="edge15" class="edge">
<title>process_message&#45;&gt;other_message</title>
<path fill="none" stroke="black" d="M409.36,-467.82C408.97,-457.19 408.46,-443.31 408.01,-431.2"/>
<polygon fill="black" stroke="black" points="411.5,-431.02 407.64,-421.15 404.51,-431.28 411.5,-431.02"/>
<text text-anchor="middle" x="429" y="-442" font-family="Courier,monospace" font-size="10.00">其他类型</text>
</g>
<!-- discard_body -->
<g id="node15" class="node">
<title>discard_body</title>
<polygon fill="none" stroke="black" points="517.5,-338 398.5,-338 398.5,-302 517.5,-302 517.5,-338"/>
<text text-anchor="middle" x="458" y="-317.5" font-family="Courier,monospace" font-size="10.00">丢弃已处理的body数据</text>
</g>
<!-- zig_version&#45;&gt;discard_body -->
<g id="edge17" class="edge">
<title>zig_version&#45;&gt;discard_body</title>
<path fill="none" stroke="black" d="M306.72,-384.82C336.35,-372.32 376.63,-355.33 408.18,-342.02"/>
<polygon fill="black" stroke="black" points="409.82,-345.13 417.67,-338.01 407.1,-338.68 409.82,-345.13"/>
<text text-anchor="middle" x="394" y="-359" font-family="Courier,monospace" font-size="10.00">版本匹配</text>
</g>
<!-- error_exit -->
<g id="node20" class="node">
<title>error_exit</title>
<ellipse fill="none" stroke="black" cx="160" cy="-320" rx="32.93" ry="18"/>
<text text-anchor="middle" x="160" y="-317.5" font-family="Courier,monospace" font-size="10.00">返回错误</text>
</g>
<!-- zig_version&#45;&gt;error_exit -->
<g id="edge16" class="edge">
<title>zig_version&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M243.52,-384.82C226.91,-372.13 204.24,-354.81 186.71,-341.41"/>
<polygon fill="black" stroke="black" points="188.63,-338.48 178.56,-335.18 184.38,-344.04 188.63,-338.48"/>
<text text-anchor="middle" x="244.5" y="-359" font-family="Courier,monospace" font-size="10.00">版本不匹配</text>
</g>
<!-- error_bundle&#45;&gt;discard_body -->
<g id="edge18" class="edge">
<title>error_bundle&#45;&gt;discard_body</title>
<path fill="none" stroke="black" d="M172.08,-386.41C216.19,-378.32 262.78,-369.6 273,-367 288.39,-363.09 291.69,-360.24 307,-356 333.33,-348.7 362.52,-341.69 388.17,-335.88"/>
<polygon fill="black" stroke="black" points="389.19,-339.24 398.18,-333.64 387.66,-332.41 389.19,-339.24"/>
<text text-anchor="middle" x="327" y="-359" font-family="Courier,monospace" font-size="10.00">处理完成</text>
</g>
<!-- error_bundle&#45;&gt;error_exit -->
<g id="edge19" class="edge">
<title>error_bundle&#45;&gt;error_exit</title>
<path fill="none" stroke="black" d="M101.69,-384.82C112.51,-372.98 127.02,-357.09 138.86,-344.14"/>
<polygon fill="black" stroke="black" points="141.67,-346.25 145.83,-336.51 136.5,-341.53 141.67,-346.25"/>
<text text-anchor="middle" x="157.5" y="-359" font-family="Courier,monospace" font-size="10.00">错误处理失败</text>
</g>
<!-- emit_digest&#45;&gt;discard_body -->
<g id="edge20" class="edge">
<title>emit_digest&#45;&gt;discard_body</title>
<path fill="none" stroke="black" d="M506.06,-384.82C497.65,-373.65 486.54,-358.9 477.12,-346.38"/>
<polygon fill="black" stroke="black" points="479.73,-344.04 470.92,-338.15 474.14,-348.25 479.73,-344.04"/>
</g>
<!-- file_system_inputs&#45;&gt;discard_body -->
<g id="edge21" class="edge">
<title>file_system_inputs&#45;&gt;discard_body</title>
<path fill="none" stroke="black" d="M602.19,-384.82C574.07,-372.38 535.89,-355.47 505.87,-342.19"/>
<polygon fill="black" stroke="black" points="507,-338.86 496.44,-338.01 504.17,-345.26 507,-338.86"/>
</g>
<!-- other_message&#45;&gt;discard_body -->
<g id="edge22" class="edge">
<title>other_message&#45;&gt;discard_body</title>
<path fill="none" stroke="black" d="M417.82,-384.82C424.78,-373.76 433.96,-359.18 441.79,-346.75"/>
<polygon fill="black" stroke="black" points="444.83,-348.48 447.2,-338.15 438.91,-344.75 444.83,-348.48"/>
</g>
<!-- poll_continue -->
<g id="node16" class="node">
<title>poll_continue</title>
<polygon fill="none" stroke="black" points="567,-265 500.3,-247 567,-229 633.7,-247 567,-265"/>
<text text-anchor="middle" x="567" y="-244.5" font-family="Courier,monospace" font-size="10.00">继续poll循环</text>
</g>
<!-- discard_body&#45;&gt;poll_continue -->
<g id="edge23" class="edge">
<title>discard_body&#45;&gt;poll_continue</title>
<path fill="none" stroke="black" d="M484.11,-301.99C500.95,-291.02 522.81,-276.79 539.85,-265.68"/>
<polygon fill="black" stroke="black" points="541.8,-268.59 548.27,-260.2 537.98,-262.72 541.8,-268.59"/>
</g>
<!-- poll_continue&#45;&gt;poll_loop -->
<g id="edge24" class="edge">
<title>poll_continue&#45;&gt;poll_loop</title>
<path fill="none" stroke="black" d="M621.62,-250.39C667.97,-255.7 727,-271.74 727,-319 727,-799 727,-799 727,-799 727,-835.52 687.76,-857.01 655.13,-868.57"/>
<polygon fill="black" stroke="black" points="653.65,-865.37 645.26,-871.85 655.86,-872.02 653.65,-865.37"/>
<text text-anchor="middle" x="747" y="-556.5" font-family="Courier,monospace" font-size="10.00">继续循环</text>
</g>
<!-- end_loop -->
<g id="node17" class="node">
<title>end_loop</title>
<polygon fill="none" stroke="black" points="607,-182 527,-182 527,-146 607,-146 607,-182"/>
<text text-anchor="middle" x="567" y="-161.5" font-family="Courier,monospace" font-size="10.00">退出poll循环</text>
</g>
<!-- poll_continue&#45;&gt;end_loop -->
<g id="edge25" class="edge">
<title>poll_continue&#45;&gt;end_loop</title>
<path fill="none" stroke="black" d="M567,-228.82C567,-218.19 567,-204.31 567,-192.2"/>
<polygon fill="black" stroke="black" points="570.5,-192.15 567,-182.15 563.5,-192.15 570.5,-192.15"/>
<text text-anchor="middle" x="587" y="-203" font-family="Courier,monospace" font-size="10.00">退出循环</text>
</g>
<!-- handle_stderr -->
<g id="node18" class="node">
<title>handle_stderr</title>
<polygon fill="none" stroke="black" points="613,-109 521,-109 521,-73 613,-73 613,-109"/>
<text text-anchor="middle" x="567" y="-94" font-family="Courier,monospace" font-size="10.00">处理stderr内容</text>
<text text-anchor="middle" x="567" y="-83" font-family="Courier,monospace" font-size="10.00">追加到错误消息</text>
</g>
<!-- end_loop&#45;&gt;handle_stderr -->
<g id="edge26" class="edge">
<title>end_loop&#45;&gt;handle_stderr</title>
<path fill="none" stroke="black" d="M567,-145.81C567,-137.79 567,-128.05 567,-119.07"/>
<polygon fill="black" stroke="black" points="570.5,-119.03 567,-109.03 563.5,-119.03 570.5,-119.03"/>
</g>
<!-- return_result -->
<g id="node19" class="node">
<title>return_result</title>
<ellipse fill="none" stroke="black" cx="567" cy="-18" rx="54.31" ry="18"/>
<text text-anchor="middle" x="567" y="-15.5" font-family="Courier,monospace" font-size="10.00">返回result路径</text>
</g>
<!-- handle_stderr&#45;&gt;return_result -->
<g id="edge27" class="edge">
<title>handle_stderr&#45;&gt;return_result</title>
<path fill="none" stroke="black" d="M567,-72.81C567,-64.79 567,-55.05 567,-46.07"/>
<polygon fill="black" stroke="black" points="570.5,-46.03 567,-36.03 563.5,-46.03 570.5,-46.03"/>
</g>
</g>
</svg>
