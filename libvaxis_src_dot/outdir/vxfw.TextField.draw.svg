<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: draw_flowchart Pages: 1 -->
<svg width="643pt" height="2058pt"
 viewBox="0.00 0.00 642.66 2058.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2054)">
<title>draw_flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-2054 638.66,-2054 638.66,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<path fill="none" stroke="black" d="M251.5,-2050C251.5,-2050 122.5,-2050 122.5,-2050 116.5,-2050 110.5,-2044 110.5,-2038 110.5,-2038 110.5,-2026 110.5,-2026 110.5,-2020 116.5,-2014 122.5,-2014 122.5,-2014 251.5,-2014 251.5,-2014 257.5,-2014 263.5,-2020 263.5,-2026 263.5,-2026 263.5,-2038 263.5,-2038 263.5,-2044 257.5,-2050 251.5,-2050"/>
<text text-anchor="middle" x="187" y="-2028.3" font-family="Times,serif" font-size="14.00">开始 (draw函数入口)</text>
</g>
<!-- check_max_width -->
<g id="node2" class="node">
<title>check_max_width</title>
<path fill="none" stroke="black" d="M276,-1977C276,-1977 98,-1977 98,-1977 92,-1977 86,-1971 86,-1965 86,-1965 86,-1953 86,-1953 86,-1947 92,-1941 98,-1941 98,-1941 276,-1941 276,-1941 282,-1941 288,-1947 288,-1953 288,-1953 288,-1965 288,-1965 288,-1971 282,-1977 276,-1977"/>
<text text-anchor="middle" x="187" y="-1955.3" font-family="Times,serif" font-size="14.00">检查ctx.max.width不为null</text>
</g>
<!-- start&#45;&gt;check_max_width -->
<g id="edge1" class="edge">
<title>start&#45;&gt;check_max_width</title>
<path fill="none" stroke="black" d="M187,-2013.81C187,-2005.79 187,-1996.05 187,-1987.07"/>
<polygon fill="black" stroke="black" points="190.5,-1987.03 187,-1977.03 183.5,-1987.03 190.5,-1987.03"/>
</g>
<!-- init_vars -->
<g id="node3" class="node">
<title>init_vars</title>
<path fill="none" stroke="black" d="M350.5,-1904C350.5,-1904 23.5,-1904 23.5,-1904 17.5,-1904 11.5,-1898 11.5,-1892 11.5,-1892 11.5,-1880 11.5,-1880 11.5,-1874 17.5,-1868 23.5,-1868 23.5,-1868 350.5,-1868 350.5,-1868 356.5,-1868 362.5,-1874 362.5,-1880 362.5,-1880 362.5,-1892 362.5,-1892 362.5,-1898 356.5,-1904 350.5,-1904"/>
<text text-anchor="middle" x="187" y="-1882.3" font-family="Times,serif" font-size="14.00">初始化prev_width, draw_offset, prev_cursor_col</text>
</g>
<!-- check_max_width&#45;&gt;init_vars -->
<g id="edge2" class="edge">
<title>check_max_width&#45;&gt;init_vars</title>
<path fill="none" stroke="black" d="M187,-1940.81C187,-1932.79 187,-1923.05 187,-1914.07"/>
<polygon fill="black" stroke="black" points="190.5,-1914.03 187,-1904.03 183.5,-1914.03 190.5,-1914.03"/>
</g>
<!-- create_surface -->
<g id="node4" class="node">
<title>create_surface</title>
<path fill="none" stroke="black" d="M362,-1831C362,-1831 12,-1831 12,-1831 6,-1831 0,-1825 0,-1819 0,-1819 0,-1805 0,-1805 0,-1799 6,-1793 12,-1793 12,-1793 362,-1793 362,-1793 368,-1793 374,-1799 374,-1805 374,-1805 374,-1819 374,-1819 374,-1825 368,-1831 362,-1831"/>
<text text-anchor="middle" x="187" y="-1815.8" font-family="Times,serif" font-size="14.00">创建Surface对象</text>
<text text-anchor="middle" x="187" y="-1800.8" font-family="Times,serif" font-size="14.00">设置宽度=max_width, 高度=max(1, ctx.min.height)</text>
</g>
<!-- init_vars&#45;&gt;create_surface -->
<g id="edge3" class="edge">
<title>init_vars&#45;&gt;create_surface</title>
<path fill="none" stroke="black" d="M187,-1867.94C187,-1859.99 187,-1850.31 187,-1841.31"/>
<polygon fill="black" stroke="black" points="190.5,-1841.2 187,-1831.2 183.5,-1841.2 190.5,-1841.2"/>
</g>
<!-- init_buffer -->
<g id="node5" class="node">
<title>init_buffer</title>
<path fill="none" stroke="black" d="M292.5,-1756C292.5,-1756 81.5,-1756 81.5,-1756 75.5,-1756 69.5,-1750 69.5,-1744 69.5,-1744 69.5,-1732 69.5,-1732 69.5,-1726 75.5,-1720 81.5,-1720 81.5,-1720 292.5,-1720 292.5,-1720 298.5,-1720 304.5,-1726 304.5,-1732 304.5,-1732 304.5,-1744 304.5,-1744 304.5,-1750 298.5,-1756 292.5,-1756"/>
<text text-anchor="middle" x="187" y="-1734.3" font-family="Times,serif" font-size="14.00">用base样式初始化surface.buffer</text>
</g>
<!-- create_surface&#45;&gt;init_buffer -->
<g id="edge4" class="edge">
<title>create_surface&#45;&gt;init_buffer</title>
<path fill="none" stroke="black" d="M187,-1792.83C187,-1784.89 187,-1775.41 187,-1766.63"/>
<polygon fill="black" stroke="black" points="190.5,-1766.42 187,-1756.42 183.5,-1766.42 190.5,-1766.42"/>
</g>
<!-- handle_cursor_idx -->
<g id="node6" class="node">
<title>handle_cursor_idx</title>
<path fill="none" stroke="black" d="M338,-1683C338,-1683 36,-1683 36,-1683 30,-1683 24,-1677 24,-1671 24,-1671 24,-1659 24,-1659 24,-1653 30,-1647 36,-1647 36,-1647 338,-1647 338,-1647 344,-1647 350,-1653 350,-1659 350,-1659 350,-1671 350,-1671 350,-1677 344,-1683 338,-1683"/>
<text text-anchor="middle" x="187" y="-1661.3" font-family="Times,serif" font-size="14.00">计算cursor_idx = graphemesBeforeCursor()</text>
</g>
<!-- init_buffer&#45;&gt;handle_cursor_idx -->
<g id="edge5" class="edge">
<title>init_buffer&#45;&gt;handle_cursor_idx</title>
<path fill="none" stroke="black" d="M187,-1719.81C187,-1711.79 187,-1702.05 187,-1693.07"/>
<polygon fill="black" stroke="black" points="190.5,-1693.03 187,-1683.03 183.5,-1693.03 190.5,-1693.03"/>
</g>
<!-- adjust_draw_offset -->
<g id="node7" class="node">
<title>adjust_draw_offset</title>
<path fill="none" stroke="black" d="M286.5,-1610C286.5,-1610 87.5,-1610 87.5,-1610 81.5,-1610 75.5,-1604 75.5,-1598 75.5,-1598 75.5,-1584 75.5,-1584 75.5,-1578 81.5,-1572 87.5,-1572 87.5,-1572 286.5,-1572 286.5,-1572 292.5,-1572 298.5,-1578 298.5,-1584 298.5,-1584 298.5,-1598 298.5,-1598 298.5,-1604 292.5,-1610 286.5,-1610"/>
<text text-anchor="middle" x="187" y="-1594.8" font-family="Times,serif" font-size="14.00">如果cursor_idx &lt; draw_offset</text>
<text text-anchor="middle" x="187" y="-1579.8" font-family="Times,serif" font-size="14.00">调整draw_offset = cursor_idx</text>
</g>
<!-- handle_cursor_idx&#45;&gt;adjust_draw_offset -->
<g id="edge6" class="edge">
<title>handle_cursor_idx&#45;&gt;adjust_draw_offset</title>
<path fill="none" stroke="black" d="M187,-1646.94C187,-1638.99 187,-1629.31 187,-1620.31"/>
<polygon fill="black" stroke="black" points="190.5,-1620.2 187,-1610.2 183.5,-1620.2 190.5,-1620.2"/>
</g>
<!-- check_max_width_zero -->
<g id="node8" class="node">
<title>check_max_width_zero</title>
<path fill="none" stroke="black" d="M175.08,-1533.64C175.08,-1533.64 40.73,-1518.36 40.73,-1518.36 34.77,-1517.68 34.77,-1516.32 40.73,-1515.64 40.73,-1515.64 175.08,-1500.36 175.08,-1500.36 181.04,-1499.68 192.96,-1499.68 198.92,-1500.36 198.92,-1500.36 333.27,-1515.64 333.27,-1515.64 339.23,-1516.32 339.23,-1517.68 333.27,-1518.36 333.27,-1518.36 198.92,-1533.64 198.92,-1533.64 192.96,-1534.32 181.04,-1534.32 175.08,-1533.64"/>
<text text-anchor="middle" x="187" y="-1513.3" font-family="Times,serif" font-size="14.00">检查max_width == 0?</text>
</g>
<!-- adjust_draw_offset&#45;&gt;check_max_width_zero -->
<g id="edge7" class="edge">
<title>adjust_draw_offset&#45;&gt;check_max_width_zero</title>
<path fill="none" stroke="black" d="M187,-1571.83C187,-1563.89 187,-1554.41 187,-1545.63"/>
<polygon fill="black" stroke="black" points="190.5,-1545.42 187,-1535.42 183.5,-1545.42 190.5,-1545.42"/>
</g>
<!-- return_early -->
<g id="node9" class="node">
<title>return_early</title>
<path fill="none" stroke="black" d="M185,-1394C185,-1394 83,-1394 83,-1394 77,-1394 71,-1388 71,-1382 71,-1382 71,-1370 71,-1370 71,-1364 77,-1358 83,-1358 83,-1358 185,-1358 185,-1358 191,-1358 197,-1364 197,-1370 197,-1370 197,-1382 197,-1382 197,-1388 191,-1394 185,-1394"/>
<text text-anchor="middle" x="134" y="-1372.3" font-family="Times,serif" font-size="14.00">直接返回surface</text>
</g>
<!-- check_max_width_zero&#45;&gt;return_early -->
<g id="edge8" class="edge">
<title>check_max_width_zero&#45;&gt;return_early</title>
<path fill="none" stroke="black" d="M180.71,-1499.51C171.73,-1475.94 155.1,-1432.34 144.3,-1404.02"/>
<polygon fill="black" stroke="black" points="147.45,-1402.44 140.61,-1394.34 140.9,-1404.93 147.45,-1402.44"/>
<text text-anchor="middle" x="181.5" y="-1469.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- enter_loop -->
<g id="node10" class="node">
<title>enter_loop</title>
<path fill="none" stroke="black" d="M332.5,-1448C332.5,-1448 225.5,-1448 225.5,-1448 219.5,-1448 213.5,-1442 213.5,-1436 213.5,-1436 213.5,-1424 213.5,-1424 213.5,-1418 219.5,-1412 225.5,-1412 225.5,-1412 332.5,-1412 332.5,-1412 338.5,-1412 344.5,-1418 344.5,-1424 344.5,-1424 344.5,-1436 344.5,-1436 344.5,-1442 338.5,-1448 332.5,-1448"/>
<text text-anchor="middle" x="279" y="-1426.3" font-family="Times,serif" font-size="14.00">进入宽度调整循环</text>
</g>
<!-- check_max_width_zero&#45;&gt;enter_loop -->
<g id="edge9" class="edge">
<title>check_max_width_zero&#45;&gt;enter_loop</title>
<path fill="none" stroke="black" d="M203.45,-1500.8C217.22,-1488.08 237.11,-1469.7 253.03,-1454.99"/>
<polygon fill="black" stroke="black" points="255.51,-1457.47 260.48,-1448.11 250.76,-1452.33 255.51,-1457.47"/>
<text text-anchor="middle" x="246.5" y="-1469.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- return_surface -->
<g id="node18" class="node">
<title>return_surface</title>
<path fill="none" stroke="black" d="M115,-36C115,-36 41,-36 41,-36 35,-36 29,-30 29,-24 29,-24 29,-12 29,-12 29,-6 35,0 41,0 41,0 115,0 115,0 121,0 127,-6 127,-12 127,-12 127,-24 127,-24 127,-30 121,-36 115,-36"/>
<text text-anchor="middle" x="78" y="-14.3" font-family="Times,serif" font-size="14.00">返回surface</text>
</g>
<!-- return_early&#45;&gt;return_surface -->
<g id="edge40" class="edge">
<title>return_early&#45;&gt;return_surface</title>
<path fill="none" stroke="black" d="M118.91,-1357.98C98.88,-1333.56 66,-1286.35 66,-1239.5 66,-1239.5 66,-1239.5 66,-90 66,-75.3 68.53,-59.13 71.27,-45.94"/>
<polygon fill="black" stroke="black" points="74.71,-46.6 73.46,-36.08 67.87,-45.08 74.71,-46.6"/>
</g>
<!-- check_width -->
<g id="node11" class="node">
<title>check_width</title>
<path fill="none" stroke="black" d="M341.2,-1337.79C341.2,-1337.79 161.8,-1304.21 161.8,-1304.21 155.9,-1303.1 155.9,-1300.9 161.8,-1299.79 161.8,-1299.79 341.2,-1266.21 341.2,-1266.21 347.1,-1265.1 358.9,-1265.1 364.8,-1266.21 364.8,-1266.21 544.2,-1299.79 544.2,-1299.79 550.1,-1300.9 550.1,-1303.1 544.2,-1304.21 544.2,-1304.21 364.8,-1337.79 364.8,-1337.79 358.9,-1338.9 347.1,-1338.9 341.2,-1337.79"/>
<text text-anchor="middle" x="353" y="-1305.8" font-family="Times,serif" font-size="14.00">计算widthToCursor(ctx)</text>
<text text-anchor="middle" x="353" y="-1290.8" font-family="Times,serif" font-size="14.00">检查width &gt;= max_width?</text>
</g>
<!-- enter_loop&#45;&gt;check_width -->
<g id="edge10" class="edge">
<title>enter_loop&#45;&gt;check_width</title>
<path fill="none" stroke="black" d="M289.13,-1411.74C299.16,-1394.67 314.91,-1367.86 328.25,-1345.14"/>
<polygon fill="black" stroke="black" points="331.37,-1346.73 333.42,-1336.34 325.34,-1343.19 331.37,-1346.73"/>
</g>
<!-- increase_offset -->
<g id="node12" class="node">
<title>increase_offset</title>
<path fill="none" stroke="black" d="M579.5,-1213C579.5,-1213 310.5,-1213 310.5,-1213 304.5,-1213 298.5,-1207 298.5,-1201 298.5,-1201 298.5,-1189 298.5,-1189 298.5,-1183 304.5,-1177 310.5,-1177 310.5,-1177 579.5,-1177 579.5,-1177 585.5,-1177 591.5,-1183 591.5,-1189 591.5,-1189 591.5,-1201 591.5,-1201 591.5,-1207 585.5,-1213 579.5,-1213"/>
<text text-anchor="middle" x="445" y="-1191.3" font-family="Times,serif" font-size="14.00">draw_offset += width &#45; max_width + 1</text>
</g>
<!-- check_width&#45;&gt;increase_offset -->
<g id="edge11" class="edge">
<title>check_width&#45;&gt;increase_offset</title>
<path fill="none" stroke="black" d="M380.85,-1269.21C394.51,-1253.63 410.7,-1235.14 423.4,-1220.65"/>
<polygon fill="black" stroke="black" points="426.11,-1222.88 430.06,-1213.05 420.84,-1218.26 426.11,-1222.88"/>
<text text-anchor="middle" x="419.5" y="-1234.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- process_first_half -->
<g id="node13" class="node">
<title>process_first_half</title>
<path fill="none" stroke="black" d="M268.5,-1213C268.5,-1213 107.5,-1213 107.5,-1213 101.5,-1213 95.5,-1207 95.5,-1201 95.5,-1201 95.5,-1189 95.5,-1189 95.5,-1183 101.5,-1177 107.5,-1177 107.5,-1177 268.5,-1177 268.5,-1177 274.5,-1177 280.5,-1183 280.5,-1189 280.5,-1189 280.5,-1201 280.5,-1201 280.5,-1207 274.5,-1213 268.5,-1213"/>
<text text-anchor="middle" x="188" y="-1191.3" font-family="Times,serif" font-size="14.00">处理buf.firstHalf()的文本</text>
</g>
<!-- check_width&#45;&gt;process_first_half -->
<g id="edge13" class="edge">
<title>check_width&#45;&gt;process_first_half</title>
<path fill="none" stroke="black" d="M307.91,-1272.31C281.4,-1255.44 248.34,-1234.4 223.66,-1218.69"/>
<polygon fill="black" stroke="black" points="225.29,-1215.58 214.97,-1213.16 221.53,-1221.48 225.29,-1215.58"/>
<text text-anchor="middle" x="273.5" y="-1234.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- increase_offset&#45;&gt;check_width -->
<g id="edge12" class="edge">
<title>increase_offset&#45;&gt;check_width</title>
<path fill="none" stroke="black" d="M417.87,-1213.04C410.63,-1218.3 403.12,-1224.44 397,-1231 389.35,-1239.19 382.27,-1248.9 376.13,-1258.44"/>
<polygon fill="black" stroke="black" points="373.06,-1256.76 370.77,-1267.1 379.01,-1260.45 373.06,-1256.76"/>
</g>
<!-- first_half_loop -->
<g id="node19" class="node">
<title>first_half_loop</title>
<path fill="none" stroke="black" d="M276,-1140C276,-1140 106,-1140 106,-1140 100,-1140 94,-1134 94,-1128 94,-1128 94,-1116 94,-1116 94,-1110 100,-1104 106,-1104 106,-1104 276,-1104 276,-1104 282,-1104 288,-1110 288,-1116 288,-1116 288,-1128 288,-1128 288,-1134 282,-1140 276,-1140"/>
<text text-anchor="middle" x="191" y="-1118.3" font-family="Times,serif" font-size="14.00">遍历first_half的grapheme</text>
</g>
<!-- process_first_half&#45;&gt;first_half_loop -->
<g id="edge14" class="edge">
<title>process_first_half&#45;&gt;first_half_loop</title>
<path fill="none" stroke="black" d="M188.73,-1176.81C189.07,-1168.79 189.48,-1159.05 189.86,-1150.07"/>
<polygon fill="black" stroke="black" points="193.36,-1150.17 190.28,-1140.03 186.36,-1149.87 193.36,-1150.17"/>
</g>
<!-- process_second_half -->
<g id="node14" class="node">
<title>process_second_half</title>
<path fill="none" stroke="black" d="M504.5,-742C504.5,-742 323.5,-742 323.5,-742 317.5,-742 311.5,-736 311.5,-730 311.5,-730 311.5,-718 311.5,-718 311.5,-712 317.5,-706 323.5,-706 323.5,-706 504.5,-706 504.5,-706 510.5,-706 516.5,-712 516.5,-718 516.5,-718 516.5,-730 516.5,-730 516.5,-736 510.5,-742 504.5,-742"/>
<text text-anchor="middle" x="414" y="-720.3" font-family="Times,serif" font-size="14.00">处理buf.secondHalf()的文本</text>
</g>
<!-- second_half_loop -->
<g id="node27" class="node">
<title>second_half_loop</title>
<path fill="none" stroke="black" d="M454.5,-668C454.5,-668 263.5,-668 263.5,-668 257.5,-668 251.5,-662 251.5,-656 251.5,-656 251.5,-644 251.5,-644 251.5,-638 257.5,-632 263.5,-632 263.5,-632 454.5,-632 454.5,-632 460.5,-632 466.5,-638 466.5,-644 466.5,-644 466.5,-656 466.5,-656 466.5,-662 460.5,-668 454.5,-668"/>
<text text-anchor="middle" x="359" y="-646.3" font-family="Times,serif" font-size="14.00">遍历second_half的grapheme</text>
</g>
<!-- process_second_half&#45;&gt;second_half_loop -->
<g id="edge25" class="edge">
<title>process_second_half&#45;&gt;second_half_loop</title>
<path fill="none" stroke="black" d="M400.97,-705.94C394.28,-697.19 386.01,-686.35 378.58,-676.63"/>
<polygon fill="black" stroke="black" points="381.17,-674.26 372.32,-668.44 375.61,-678.51 381.17,-674.26"/>
</g>
<!-- check_leading_ellipsis -->
<g id="node15" class="node">
<title>check_leading_ellipsis</title>
<path fill="none" stroke="black" d="M471.08,-268.59C471.08,-268.59 343.09,-253.41 343.09,-253.41 337.14,-252.71 337.14,-251.29 343.09,-250.59 343.09,-250.59 471.08,-235.41 471.08,-235.41 477.04,-234.71 488.96,-234.71 494.92,-235.41 494.92,-235.41 622.91,-250.59 622.91,-250.59 628.86,-251.29 628.86,-252.71 622.91,-253.41 622.91,-253.41 494.92,-268.59 494.92,-268.59 488.96,-269.29 477.04,-269.29 471.08,-268.59"/>
<text text-anchor="middle" x="483" y="-248.3" font-family="Times,serif" font-size="14.00">检查draw_offset &gt; 0?</text>
</g>
<!-- add_leading_ellipsis -->
<g id="node16" class="node">
<title>add_leading_ellipsis</title>
<path fill="none" stroke="black" d="M541,-182C541,-182 425,-182 425,-182 419,-182 413,-176 413,-170 413,-170 413,-158 413,-158 413,-152 419,-146 425,-146 425,-146 541,-146 541,-146 547,-146 553,-152 553,-158 553,-158 553,-170 553,-170 553,-176 547,-182 541,-182"/>
<text text-anchor="middle" x="483" y="-160.3" font-family="Times,serif" font-size="14.00">在位置0显示省略号</text>
</g>
<!-- check_leading_ellipsis&#45;&gt;add_leading_ellipsis -->
<g id="edge36" class="edge">
<title>check_leading_ellipsis&#45;&gt;add_leading_ellipsis</title>
<path fill="none" stroke="black" d="M483,-233.6C483,-221.75 483,-205.82 483,-192.29"/>
<polygon fill="black" stroke="black" points="486.5,-192.08 483,-182.08 479.5,-192.08 486.5,-192.08"/>
<text text-anchor="middle" x="490.5" y="-203.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- set_cursor_position -->
<g id="node17" class="node">
<title>set_cursor_position</title>
<path fill="none" stroke="black" d="M470.5,-109C470.5,-109 289.5,-109 289.5,-109 283.5,-109 277.5,-103 277.5,-97 277.5,-97 277.5,-85 277.5,-85 277.5,-79 283.5,-73 289.5,-73 289.5,-73 470.5,-73 470.5,-73 476.5,-73 482.5,-79 482.5,-85 482.5,-85 482.5,-97 482.5,-97 482.5,-103 476.5,-109 470.5,-109"/>
<text text-anchor="middle" x="380" y="-87.3" font-family="Times,serif" font-size="14.00">设置surface.cursor的列和行</text>
</g>
<!-- check_leading_ellipsis&#45;&gt;set_cursor_position -->
<g id="edge37" class="edge">
<title>check_leading_ellipsis&#45;&gt;set_cursor_position</title>
<path fill="none" stroke="black" d="M453.06,-237.47C431.39,-225.99 403.45,-207.32 389,-182 378.15,-162.99 376.45,-137.99 377.15,-119.17"/>
<polygon fill="black" stroke="black" points="380.64,-119.35 377.76,-109.16 373.66,-118.92 380.64,-119.35"/>
<text text-anchor="middle" x="396.5" y="-160.3" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- add_leading_ellipsis&#45;&gt;set_cursor_position -->
<g id="edge38" class="edge">
<title>add_leading_ellipsis&#45;&gt;set_cursor_position</title>
<path fill="none" stroke="black" d="M458.33,-145.99C444.8,-136.67 427.84,-124.97 413.16,-114.86"/>
<polygon fill="black" stroke="black" points="415.05,-111.91 404.83,-109.11 411.07,-117.67 415.05,-111.91"/>
</g>
<!-- set_cursor_position&#45;&gt;return_surface -->
<g id="edge39" class="edge">
<title>set_cursor_position&#45;&gt;return_surface</title>
<path fill="none" stroke="black" d="M307.66,-72.99C255.42,-60.71 185.75,-44.33 136.9,-32.85"/>
<polygon fill="black" stroke="black" points="137.65,-29.43 127.11,-30.55 136.04,-36.24 137.65,-29.43"/>
</g>
<!-- check_i_offset -->
<g id="node20" class="node">
<title>check_i_offset</title>
<path fill="none" stroke="black" d="M327.13,-1065.24C327.13,-1065.24 229.71,-1050.76 229.71,-1050.76 223.78,-1049.88 223.78,-1048.12 229.71,-1047.24 229.71,-1047.24 327.13,-1032.76 327.13,-1032.76 333.07,-1031.88 344.93,-1031.88 350.87,-1032.76 350.87,-1032.76 448.29,-1047.24 448.29,-1047.24 454.22,-1048.12 454.22,-1049.88 448.29,-1050.76 448.29,-1050.76 350.87,-1065.24 350.87,-1065.24 344.93,-1066.12 333.07,-1066.12 327.13,-1065.24"/>
<text text-anchor="middle" x="339" y="-1045.3" font-family="Times,serif" font-size="14.00">i &lt; draw_offset?</text>
</g>
<!-- first_half_loop&#45;&gt;check_i_offset -->
<g id="edge15" class="edge">
<title>first_half_loop&#45;&gt;check_i_offset</title>
<path fill="none" stroke="black" d="M226.45,-1103.99C249.45,-1092.96 279.34,-1078.62 302.54,-1067.49"/>
<polygon fill="black" stroke="black" points="304.21,-1070.57 311.71,-1063.09 301.18,-1064.26 304.21,-1070.57"/>
</g>
<!-- skip_grapheme -->
<g id="node21" class="node">
<title>skip_grapheme</title>
<path fill="none" stroke="black" d="M251,-980C251,-980 173,-980 173,-980 167,-980 161,-974 161,-968 161,-968 161,-954 161,-954 161,-948 167,-942 173,-942 173,-942 251,-942 251,-942 257,-942 263,-948 263,-954 263,-954 263,-968 263,-968 263,-974 257,-980 251,-980"/>
<text text-anchor="middle" x="212" y="-964.8" font-family="Times,serif" font-size="14.00">i += 1</text>
<text text-anchor="middle" x="212" y="-949.8" font-family="Times,serif" font-size="14.00">跳过当前字形</text>
</g>
<!-- check_i_offset&#45;&gt;skip_grapheme -->
<g id="edge16" class="edge">
<title>check_i_offset&#45;&gt;skip_grapheme</title>
<path fill="none" stroke="black" d="M318.31,-1033.99C299.12,-1020.99 270.15,-1001.38 247.3,-985.9"/>
<polygon fill="black" stroke="black" points="249.12,-982.91 238.87,-980.2 245.19,-988.7 249.12,-982.91"/>
<text text-anchor="middle" x="293.5" y="-1001.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- calculate_width -->
<g id="node22" class="node">
<title>calculate_width</title>
<path fill="none" stroke="black" d="M384,-979C384,-979 294,-979 294,-979 288,-979 282,-973 282,-967 282,-967 282,-955 282,-955 282,-949 288,-943 294,-943 294,-943 384,-943 384,-943 390,-943 396,-949 396,-955 396,-955 396,-967 396,-967 396,-973 390,-979 384,-979"/>
<text text-anchor="middle" x="339" y="-957.3" font-family="Times,serif" font-size="14.00">计算字形宽度w</text>
</g>
<!-- check_i_offset&#45;&gt;calculate_width -->
<g id="edge18" class="edge">
<title>check_i_offset&#45;&gt;calculate_width</title>
<path fill="none" stroke="black" d="M339,-1030.6C339,-1018.75 339,-1002.82 339,-989.29"/>
<polygon fill="black" stroke="black" points="342.5,-989.08 339,-979.08 335.5,-989.08 342.5,-989.08"/>
<text text-anchor="middle" x="346.5" y="-1001.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- skip_grapheme&#45;&gt;first_half_loop -->
<g id="edge17" class="edge">
<title>skip_grapheme&#45;&gt;first_half_loop</title>
<path fill="none" stroke="black" d="M209.58,-980.36C205.89,-1008.25 198.86,-1061.5 194.58,-1093.87"/>
<polygon fill="black" stroke="black" points="191.09,-1093.61 193.25,-1103.98 198.03,-1094.53 191.09,-1093.61"/>
</g>
<!-- check_col_overflow -->
<g id="node23" class="node">
<title>check_col_overflow</title>
<path fill="none" stroke="black" d="M327.06,-903.76C327.06,-903.76 178.33,-888.24 178.33,-888.24 172.36,-887.62 172.36,-886.38 178.33,-885.76 178.33,-885.76 327.06,-870.24 327.06,-870.24 333.03,-869.62 344.97,-869.62 350.94,-870.24 350.94,-870.24 499.67,-885.76 499.67,-885.76 505.64,-886.38 505.64,-887.62 499.67,-888.24 499.67,-888.24 350.94,-903.76 350.94,-903.76 344.97,-904.38 333.03,-904.38 327.06,-903.76"/>
<text text-anchor="middle" x="339" y="-883.3" font-family="Times,serif" font-size="14.00">col + w &gt;= max_width?</text>
</g>
<!-- calculate_width&#45;&gt;check_col_overflow -->
<g id="edge19" class="edge">
<title>calculate_width&#45;&gt;check_col_overflow</title>
<path fill="none" stroke="black" d="M339,-942.94C339,-934.81 339,-924.88 339,-915.7"/>
<polygon fill="black" stroke="black" points="342.5,-915.44 339,-905.44 335.5,-915.44 342.5,-915.44"/>
</g>
<!-- write_ellipsis -->
<g id="node24" class="node">
<title>write_ellipsis</title>
<path fill="none" stroke="black" d="M509.5,-817C509.5,-817 326.5,-817 326.5,-817 320.5,-817 314.5,-811 314.5,-805 314.5,-805 314.5,-793 314.5,-793 314.5,-787 320.5,-781 326.5,-781 326.5,-781 509.5,-781 509.5,-781 515.5,-781 521.5,-787 521.5,-793 521.5,-793 521.5,-805 521.5,-805 521.5,-811 515.5,-817 509.5,-817"/>
<text text-anchor="middle" x="418" y="-795.3" font-family="Times,serif" font-size="14.00">在max_width&#45;1位置写省略号</text>
</g>
<!-- check_col_overflow&#45;&gt;write_ellipsis -->
<g id="edge20" class="edge">
<title>check_col_overflow&#45;&gt;write_ellipsis</title>
<path fill="none" stroke="black" d="M353.49,-870.23C365.14,-857.54 381.72,-839.49 395.16,-824.87"/>
<polygon fill="black" stroke="black" points="398.06,-826.88 402.25,-817.15 392.9,-822.15 398.06,-826.88"/>
<text text-anchor="middle" x="390.5" y="-839.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- write_grapheme -->
<g id="node25" class="node">
<title>write_grapheme</title>
<path fill="none" stroke="black" d="M284.5,-818C284.5,-818 171.5,-818 171.5,-818 165.5,-818 159.5,-812 159.5,-806 159.5,-806 159.5,-792 159.5,-792 159.5,-786 165.5,-780 171.5,-780 171.5,-780 284.5,-780 284.5,-780 290.5,-780 296.5,-786 296.5,-792 296.5,-792 296.5,-806 296.5,-806 296.5,-812 290.5,-818 284.5,-818"/>
<text text-anchor="middle" x="228" y="-802.8" font-family="Times,serif" font-size="14.00">在col位置写入字形</text>
<text text-anchor="middle" x="228" y="-787.8" font-family="Times,serif" font-size="14.00">col += w, i += 1</text>
</g>
<!-- check_col_overflow&#45;&gt;write_grapheme -->
<g id="edge22" class="edge">
<title>check_col_overflow&#45;&gt;write_grapheme</title>
<path fill="none" stroke="black" d="M319.41,-870.82C302.75,-857.91 278.51,-839.14 259.18,-824.16"/>
<polygon fill="black" stroke="black" points="261.29,-821.36 251.24,-818 257,-826.89 261.29,-821.36"/>
<text text-anchor="middle" x="300.5" y="-839.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- write_ellipsis&#45;&gt;process_second_half -->
<g id="edge21" class="edge">
<title>write_ellipsis&#45;&gt;process_second_half</title>
<path fill="none" stroke="black" d="M417.05,-780.7C416.59,-772.25 416.02,-761.87 415.5,-752.37"/>
<polygon fill="black" stroke="black" points="418.98,-751.97 414.94,-742.18 411.99,-752.35 418.98,-751.97"/>
</g>
<!-- update_cursor_col -->
<g id="node26" class="node">
<title>update_cursor_col</title>
<path fill="none" stroke="black" d="M281,-743C281,-743 107,-743 107,-743 101,-743 95,-737 95,-731 95,-731 95,-717 95,-717 95,-711 101,-705 107,-705 107,-705 281,-705 281,-705 287,-705 293,-711 293,-717 293,-717 293,-731 293,-731 293,-737 287,-743 281,-743"/>
<text text-anchor="middle" x="194" y="-727.8" font-family="Times,serif" font-size="14.00">如果i == cursor_idx</text>
<text text-anchor="middle" x="194" y="-712.8" font-family="Times,serif" font-size="14.00">更新prev_cursor_col = col</text>
</g>
<!-- write_grapheme&#45;&gt;update_cursor_col -->
<g id="edge23" class="edge">
<title>write_grapheme&#45;&gt;update_cursor_col</title>
<path fill="none" stroke="black" d="M219.6,-779.96C215.71,-771.62 211.02,-761.54 206.72,-752.3"/>
<polygon fill="black" stroke="black" points="209.82,-750.68 202.43,-743.09 203.48,-753.63 209.82,-750.68"/>
</g>
<!-- update_cursor_col&#45;&gt;first_half_loop -->
<g id="edge24" class="edge">
<title>update_cursor_col&#45;&gt;first_half_loop</title>
<path fill="none" stroke="black" d="M165.45,-743.07C148.78,-756.05 131,-775.23 131,-798 131,-1050 131,-1050 131,-1050 131,-1068.62 143.18,-1084.87 156.57,-1097.12"/>
<polygon fill="black" stroke="black" points="154.62,-1100.05 164.51,-1103.85 159.15,-1094.71 154.62,-1100.05"/>
</g>
<!-- check_i_offset2 -->
<g id="node28" class="node">
<title>check_i_offset2</title>
<path fill="none" stroke="black" d="M452.13,-593.24C452.13,-593.24 354.71,-578.76 354.71,-578.76 348.78,-577.88 348.78,-576.12 354.71,-575.24 354.71,-575.24 452.13,-560.76 452.13,-560.76 458.07,-559.88 469.93,-559.88 475.87,-560.76 475.87,-560.76 573.29,-575.24 573.29,-575.24 579.22,-576.12 579.22,-577.88 573.29,-578.76 573.29,-578.76 475.87,-593.24 475.87,-593.24 469.93,-594.12 458.07,-594.12 452.13,-593.24"/>
<text text-anchor="middle" x="464" y="-573.3" font-family="Times,serif" font-size="14.00">i &lt; draw_offset?</text>
</g>
<!-- second_half_loop&#45;&gt;check_i_offset2 -->
<g id="edge26" class="edge">
<title>second_half_loop&#45;&gt;check_i_offset2</title>
<path fill="none" stroke="black" d="M384.15,-631.99C399.4,-621.68 418.93,-608.47 434.86,-597.7"/>
<polygon fill="black" stroke="black" points="436.96,-600.51 443.29,-592.01 433.04,-594.71 436.96,-600.51"/>
</g>
<!-- skip_grapheme2 -->
<g id="node29" class="node">
<title>skip_grapheme2</title>
<path fill="none" stroke="black" d="M366,-508C366,-508 288,-508 288,-508 282,-508 276,-502 276,-496 276,-496 276,-482 276,-482 276,-476 282,-470 288,-470 288,-470 366,-470 366,-470 372,-470 378,-476 378,-482 378,-482 378,-496 378,-496 378,-502 372,-508 366,-508"/>
<text text-anchor="middle" x="327" y="-492.8" font-family="Times,serif" font-size="14.00">i += 1</text>
<text text-anchor="middle" x="327" y="-477.8" font-family="Times,serif" font-size="14.00">跳过当前字形</text>
</g>
<!-- check_i_offset2&#45;&gt;skip_grapheme2 -->
<g id="edge27" class="edge">
<title>check_i_offset2&#45;&gt;skip_grapheme2</title>
<path fill="none" stroke="black" d="M441.99,-562.18C421.15,-549.1 389.44,-529.2 364.6,-513.6"/>
<polygon fill="black" stroke="black" points="366.45,-510.63 356.12,-508.28 362.73,-516.56 366.45,-510.63"/>
<text text-anchor="middle" x="414.5" y="-529.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- calculate_width2 -->
<g id="node30" class="node">
<title>calculate_width2</title>
<path fill="none" stroke="black" d="M509,-507C509,-507 419,-507 419,-507 413,-507 407,-501 407,-495 407,-495 407,-483 407,-483 407,-477 413,-471 419,-471 419,-471 509,-471 509,-471 515,-471 521,-477 521,-483 521,-483 521,-495 521,-495 521,-501 515,-507 509,-507"/>
<text text-anchor="middle" x="464" y="-485.3" font-family="Times,serif" font-size="14.00">计算字形宽度w</text>
</g>
<!-- check_i_offset2&#45;&gt;calculate_width2 -->
<g id="edge29" class="edge">
<title>check_i_offset2&#45;&gt;calculate_width2</title>
<path fill="none" stroke="black" d="M464,-558.6C464,-546.75 464,-530.82 464,-517.29"/>
<polygon fill="black" stroke="black" points="467.5,-517.08 464,-507.08 460.5,-517.08 467.5,-517.08"/>
<text text-anchor="middle" x="471.5" y="-529.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- skip_grapheme2&#45;&gt;second_half_loop -->
<g id="edge28" class="edge">
<title>skip_grapheme2&#45;&gt;second_half_loop</title>
<path fill="none" stroke="black" d="M326.22,-508.15C325.76,-529.34 326.4,-565.26 334,-595 336.38,-604.31 340.33,-613.98 344.39,-622.52"/>
<polygon fill="black" stroke="black" points="341.34,-624.24 348.95,-631.61 347.6,-621.1 341.34,-624.24"/>
</g>
<!-- check_col_overflow2 -->
<g id="node31" class="node">
<title>check_col_overflow2</title>
<path fill="none" stroke="black" d="M452.07,-431.67C452.07,-431.67 314.38,-416.33 314.38,-416.33 308.42,-415.66 308.42,-414.34 314.38,-413.67 314.38,-413.67 452.07,-398.33 452.07,-398.33 458.04,-397.66 469.96,-397.66 475.93,-398.33 475.93,-398.33 613.62,-413.67 613.62,-413.67 619.58,-414.34 619.58,-415.66 613.62,-416.33 613.62,-416.33 475.93,-431.67 475.93,-431.67 469.96,-432.34 458.04,-432.34 452.07,-431.67"/>
<text text-anchor="middle" x="464" y="-411.3" font-family="Times,serif" font-size="14.00">col + w &gt; max_width?</text>
</g>
<!-- calculate_width2&#45;&gt;check_col_overflow2 -->
<g id="edge30" class="edge">
<title>calculate_width2&#45;&gt;check_col_overflow2</title>
<path fill="none" stroke="black" d="M464,-470.94C464,-462.81 464,-452.88 464,-443.7"/>
<polygon fill="black" stroke="black" points="467.5,-443.44 464,-433.44 460.5,-443.44 467.5,-443.44"/>
</g>
<!-- write_ellipsis2 -->
<g id="node32" class="node">
<title>write_ellipsis2</title>
<path fill="none" stroke="black" d="M585.5,-345C585.5,-345 402.5,-345 402.5,-345 396.5,-345 390.5,-339 390.5,-333 390.5,-333 390.5,-321 390.5,-321 390.5,-315 396.5,-309 402.5,-309 402.5,-309 585.5,-309 585.5,-309 591.5,-309 597.5,-315 597.5,-321 597.5,-321 597.5,-333 597.5,-333 597.5,-339 591.5,-345 585.5,-345"/>
<text text-anchor="middle" x="494" y="-323.3" font-family="Times,serif" font-size="14.00">在max_width&#45;1位置写省略号</text>
</g>
<!-- check_col_overflow2&#45;&gt;write_ellipsis2 -->
<g id="edge31" class="edge">
<title>check_col_overflow2&#45;&gt;write_ellipsis2</title>
<path fill="none" stroke="black" d="M469.78,-397.42C474,-385.32 479.81,-368.67 484.68,-354.71"/>
<polygon fill="black" stroke="black" points="488.04,-355.71 488.03,-345.12 481.43,-353.41 488.04,-355.71"/>
<text text-anchor="middle" x="487.5" y="-367.8" font-family="Times,serif" font-size="14.00">是</text>
</g>
<!-- write_grapheme2 -->
<g id="node33" class="node">
<title>write_grapheme2</title>
<path fill="none" stroke="black" d="M360.5,-346C360.5,-346 247.5,-346 247.5,-346 241.5,-346 235.5,-340 235.5,-334 235.5,-334 235.5,-320 235.5,-320 235.5,-314 241.5,-308 247.5,-308 247.5,-308 360.5,-308 360.5,-308 366.5,-308 372.5,-314 372.5,-320 372.5,-320 372.5,-334 372.5,-334 372.5,-340 366.5,-346 360.5,-346"/>
<text text-anchor="middle" x="304" y="-330.8" font-family="Times,serif" font-size="14.00">在col位置写入字形</text>
<text text-anchor="middle" x="304" y="-315.8" font-family="Times,serif" font-size="14.00">col += w, i += 1</text>
</g>
<!-- check_col_overflow2&#45;&gt;write_grapheme2 -->
<g id="edge33" class="edge">
<title>check_col_overflow2&#45;&gt;write_grapheme2</title>
<path fill="none" stroke="black" d="M437.58,-399.8C412.91,-386.54 375.66,-366.52 346.76,-350.99"/>
<polygon fill="black" stroke="black" points="348.17,-347.77 337.7,-346.11 344.85,-353.93 348.17,-347.77"/>
<text text-anchor="middle" x="405.5" y="-367.8" font-family="Times,serif" font-size="14.00">否</text>
</g>
<!-- write_ellipsis2&#45;&gt;check_leading_ellipsis -->
<g id="edge32" class="edge">
<title>write_ellipsis2&#45;&gt;check_leading_ellipsis</title>
<path fill="none" stroke="black" d="M491.39,-308.7C490.1,-300.09 488.5,-289.49 487.05,-279.86"/>
<polygon fill="black" stroke="black" points="490.5,-279.29 485.55,-269.92 483.58,-280.33 490.5,-279.29"/>
</g>
<!-- update_cursor_col2 -->
<g id="node34" class="node">
<title>update_cursor_col2</title>
<path fill="none" stroke="black" d="M297,-271C297,-271 123,-271 123,-271 117,-271 111,-265 111,-259 111,-259 111,-245 111,-245 111,-239 117,-233 123,-233 123,-233 297,-233 297,-233 303,-233 309,-239 309,-245 309,-245 309,-259 309,-259 309,-265 303,-271 297,-271"/>
<text text-anchor="middle" x="210" y="-255.8" font-family="Times,serif" font-size="14.00">如果i == cursor_idx</text>
<text text-anchor="middle" x="210" y="-240.8" font-family="Times,serif" font-size="14.00">更新prev_cursor_col = col</text>
</g>
<!-- write_grapheme2&#45;&gt;update_cursor_col2 -->
<g id="edge34" class="edge">
<title>write_grapheme2&#45;&gt;update_cursor_col2</title>
<path fill="none" stroke="black" d="M280.76,-307.96C268.9,-298.74 254.3,-287.4 241.44,-277.42"/>
<polygon fill="black" stroke="black" points="243.34,-274.46 233.29,-271.09 239.05,-279.99 243.34,-274.46"/>
</g>
<!-- update_cursor_col2&#45;&gt;second_half_loop -->
<g id="edge35" class="edge">
<title>update_cursor_col2&#45;&gt;second_half_loop</title>
<path fill="none" stroke="black" d="M208.83,-271.29C207.99,-286.05 207,-307.35 207,-326 207,-578 207,-578 207,-578 207,-601.45 222.03,-617.17 242.64,-627.7"/>
<polygon fill="black" stroke="black" points="241.24,-630.91 251.78,-631.91 244.16,-624.55 241.24,-630.91"/>
</g>
</g>
</svg>
