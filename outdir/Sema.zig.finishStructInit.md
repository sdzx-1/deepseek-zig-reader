graph TD
    A[开始finishStructInit] --> B[初始化变量: pt, zcu, ip, root_msg]
    B --> C{检查struct_ty类型}
    C -->|tuple_type| D[遍历元组字段]
    C -->|struct_type| E[遍历结构体字段]
    
    D --> F{字段是否有初始化值?}
    F -->|是| G[强制类型转换并更新field_inits]
    F -->|否| H{是否有默认值?}
    H -->|是| I[使用默认值填充field_inits]
    H -->|否| J[记录错误信息]
    
    E --> K{字段是否有初始化值?}
    K -->|是| L[强制类型转换并更新field_inits]
    K -->|否| M{是否有默认初始化?}
    M -->|是| N[使用默认初始化填充field_inits]
    M -->|否| O[记录错误信息]
    
    J --> P[收集错误信息]
    O --> P
    P --> Q{存在错误?}
    Q -->|是| R[添加错误注释并返回错误]
    Q -->|否| S[检查所有字段是否编译时已知]
    
    S --> T{所有字段编译时已知?}
    T -->|是| U[创建常量结构体并返回]
    T -->|否| V[确定运行时字段索引]
    
    V --> W{结构体是否仅允许编译时?}
    W -->|是| X[返回编译时错误]
    W -->|否| Y[验证运行时值]
    
    Y --> Z{是否为引用(is_ref)?}
    Z -->|是| AA[分配内存并逐个字段存储]
    AA --> AB[返回引用指针]
    Z -->|否| AC[生成运行时聚合初始化]
    AC --> AD[强制类型转换并返回结构体值]
    
    R --> AE[结束]
    U --> AE
    X --> AE
    AB --> AE
    AD --> AE
