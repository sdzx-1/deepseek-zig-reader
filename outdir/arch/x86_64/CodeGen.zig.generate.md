flowchart TD
    A[开始] --> B[初始化变量和结构体]
    B --> C[设置defer释放资源]
    C --> D[确保inst_tracking容量并填充temp_index]
    D --> E[记录日志]
    E --> F[初始化frame_allocs的各个索引]
    F --> G{调用resolveCallingConventionValues}
    G -->|成功| H[设置args/ret_mcv/err_ret_trace_reg]
    G -->|失败| Z[返回错误]
    H --> I[设置ret_addr/base_ptr/args_frame的frame_allocs]
    I --> J{判断调用约定类型}
    J -->|x86_64_sysv| K[初始化va_info.sysv]
    J -->|x86_64_win| L[初始化va_info.win64]
    K --> M[处理err_ret_trace_reg]
    L --> M
    M --> N{调用gen()生成代码}
    N -->|成功| O[创建Mir结构]
    N -->|失败| P[返回错误或注册不足错误]
    O --> Q[创建Emit结构并调用emitMir()]
    Q --> R{emitMir结果}
    R -->|成功| S[流程结束]
    R -->|LowerFail/EmitFail| T[返回错误信息]
    R -->|其他错误| U[返回通用错误]
    Z --> S
    P --> S
    T --> S
    U --> S
