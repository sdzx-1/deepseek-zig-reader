<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="823pt" height="941pt"
 viewBox="0.00 0.00 823.00 941.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 937)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-937 819,-937 819,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<path fill="none" stroke="black" d="M203,-933C203,-933 126,-933 126,-933 120,-933 114,-927 114,-921 114,-921 114,-909 114,-909 114,-903 120,-897 126,-897 126,-897 203,-897 203,-897 209,-897 215,-903 215,-909 215,-909 215,-921 215,-921 215,-927 209,-933 203,-933"/>
<text text-anchor="middle" x="164.5" y="-911.3" font-family="Courier New" font-size="14.00">开始 airCtz</text>
</g>
<!-- resolve_inst -->
<g id="node2" class="node">
<title>resolve_inst</title>
<path fill="none" stroke="black" d="M293,-860C293,-860 36,-860 36,-860 30,-860 24,-854 24,-848 24,-848 24,-834 24,-834 24,-828 30,-822 36,-822 36,-822 293,-822 293,-822 299,-822 305,-828 305,-834 305,-834 305,-848 305,-848 305,-854 299,-860 293,-860"/>
<text text-anchor="middle" x="164.5" y="-844.8" font-family="Courier New" font-size="14.00">解析指令参数</text>
<text text-anchor="middle" x="164.5" y="-829.8" font-family="Courier New" font-size="14.00">ty_op = self.air.instructions...</text>
</g>
<!-- start&#45;&gt;resolve_inst -->
<g id="edge1" class="edge">
<title>start&#45;&gt;resolve_inst</title>
<path fill="none" stroke="black" d="M164.5,-896.94C164.5,-888.99 164.5,-879.31 164.5,-870.31"/>
<polygon fill="black" stroke="black" points="168,-870.2 164.5,-860.2 161,-870.2 168,-870.2"/>
</g>
<!-- check_vector -->
<g id="node3" class="node">
<title>check_vector</title>
<path fill="none" stroke="black" d="M297,-785C297,-785 32,-785 32,-785 26,-785 20,-779 20,-773 20,-773 20,-744 20,-744 20,-738 26,-732 32,-732 32,-732 297,-732 297,-732 303,-732 309,-738 309,-744 309,-744 309,-773 309,-773 309,-779 303,-785 297,-785"/>
<text text-anchor="middle" x="164.5" y="-769.8" font-family="Courier New" font-size="14.00">检查源类型是否为向量</text>
<text text-anchor="middle" x="164.5" y="-754.8" font-family="Courier New" font-size="14.00">if (src_ty.zigTypeTag == .vector)</text>
<text text-anchor="middle" x="164.5" y="-739.8" font-family="Courier New" font-size="14.00">返回未实现错误</text>
</g>
<!-- resolve_inst&#45;&gt;check_vector -->
<g id="edge2" class="edge">
<title>resolve_inst&#45;&gt;check_vector</title>
<path fill="none" stroke="black" d="M164.5,-821.73C164.5,-813.85 164.5,-804.34 164.5,-795.15"/>
<polygon fill="black" stroke="black" points="168,-795.02 164.5,-785.02 161,-795.02 168,-795.02"/>
</g>
<!-- handle_vector -->
<g id="node4" class="node">
<title>handle_vector</title>
<path fill="none" stroke="black" d="M249,-625C249,-625 12,-625 12,-625 6,-625 0,-619 0,-613 0,-613 0,-599 0,-599 0,-593 6,-587 12,-587 12,-587 249,-587 249,-587 255,-587 261,-593 261,-599 261,-599 261,-613 261,-613 261,-619 255,-625 249,-625"/>
<text text-anchor="middle" x="130.5" y="-609.8" font-family="Courier New" font-size="14.00">返回错误：TODO implement airCtz</text>
<text text-anchor="middle" x="130.5" y="-594.8" font-family="Courier New" font-size="14.00">对于向量类型</text>
</g>
<!-- check_vector&#45;&gt;handle_vector -->
<g id="edge3" class="edge">
<title>check_vector&#45;&gt;handle_vector</title>
<path fill="none" stroke="black" d="M158.73,-731.97C152.65,-705.05 143.1,-662.76 136.82,-634.96"/>
<polygon fill="black" stroke="black" points="140.2,-634.06 134.58,-625.08 133.37,-635.6 140.2,-634.06"/>
<text text-anchor="middle" x="177" y="-702.8" font-family="Courier New" font-size="14.00">是向量</text>
</g>
<!-- resolve_src_mcv -->
<g id="node5" class="node">
<title>resolve_src_mcv</title>
<path fill="none" stroke="black" d="M535.5,-681C535.5,-681 171.5,-681 171.5,-681 165.5,-681 159.5,-675 159.5,-669 159.5,-669 159.5,-655 159.5,-655 159.5,-649 165.5,-643 171.5,-643 171.5,-643 535.5,-643 535.5,-643 541.5,-643 547.5,-649 547.5,-655 547.5,-655 547.5,-669 547.5,-669 547.5,-675 541.5,-681 535.5,-681"/>
<text text-anchor="middle" x="353.5" y="-665.8" font-family="Courier New" font-size="14.00">解析源操作数</text>
<text text-anchor="middle" x="353.5" y="-650.8" font-family="Courier New" font-size="14.00">src_mcv = try self.resolveInst(ty_op.operand)</text>
</g>
<!-- check_vector&#45;&gt;resolve_src_mcv -->
<g id="edge4" class="edge">
<title>check_vector&#45;&gt;resolve_src_mcv</title>
<path fill="none" stroke="black" d="M215.65,-731.93C244.52,-717.49 280.29,-699.6 308.16,-685.67"/>
<polygon fill="black" stroke="black" points="309.91,-688.71 317.29,-681.11 306.78,-682.45 309.91,-688.71"/>
<text text-anchor="middle" x="303" y="-702.8" font-family="Courier New" font-size="14.00">非向量</text>
</g>
<!-- end -->
<g id="node15" class="node">
<title>end</title>
<path fill="none" stroke="black" d="M223.5,-38C223.5,-38 57.5,-38 57.5,-38 51.5,-38 45.5,-32 45.5,-26 45.5,-26 45.5,-12 45.5,-12 45.5,-6 51.5,0 57.5,0 57.5,0 223.5,0 223.5,0 229.5,0 235.5,-6 235.5,-12 235.5,-12 235.5,-26 235.5,-26 235.5,-32 229.5,-38 223.5,-38"/>
<text text-anchor="middle" x="140.5" y="-22.8" font-family="Courier New" font-size="14.00">返回结果</text>
<text text-anchor="middle" x="140.5" y="-7.8" font-family="Courier New" font-size="14.00">return finishAir(...)</text>
</g>
<!-- handle_vector&#45;&gt;end -->
<g id="edge5" class="edge">
<title>handle_vector&#45;&gt;end</title>
<path fill="none" stroke="black" d="M129.87,-586.67C129.28,-568.11 128.5,-538.56 128.5,-513 128.5,-513 128.5,-513 128.5,-93 128.5,-78.1 130.96,-61.72 133.66,-48.25"/>
<polygon fill="black" stroke="black" points="137.15,-48.68 135.83,-38.16 130.3,-47.21 137.15,-48.68"/>
</g>
<!-- materialize_src -->
<g id="node6" class="node">
<title>materialize_src</title>
<path fill="none" stroke="black" d="M540.5,-569C540.5,-569 168.5,-569 168.5,-569 162.5,-569 156.5,-563 156.5,-557 156.5,-557 156.5,-543 156.5,-543 156.5,-537 162.5,-531 168.5,-531 168.5,-531 540.5,-531 540.5,-531 546.5,-531 552.5,-537 552.5,-543 552.5,-543 552.5,-557 552.5,-557 552.5,-563 546.5,-569 540.5,-569"/>
<text text-anchor="middle" x="354.5" y="-553.8" font-family="Courier New" font-size="14.00">物化源操作数到寄存器</text>
<text text-anchor="middle" x="354.5" y="-538.8" font-family="Courier New" font-size="14.00">mat_src_mcv = 立即数 ? 复制到临时寄存器 : src_mcv</text>
</g>
<!-- resolve_src_mcv&#45;&gt;materialize_src -->
<g id="edge6" class="edge">
<title>resolve_src_mcv&#45;&gt;materialize_src</title>
<path fill="none" stroke="black" d="M353.67,-642.84C353.82,-625.56 354.06,-599.31 354.24,-579.29"/>
<polygon fill="black" stroke="black" points="357.74,-579.22 354.33,-569.19 350.74,-579.16 357.74,-579.22"/>
</g>
<!-- lock_registers -->
<g id="node7" class="node">
<title>lock_registers</title>
<path fill="none" stroke="black" d="M437.5,-494C437.5,-494 271.5,-494 271.5,-494 265.5,-494 259.5,-488 259.5,-482 259.5,-482 259.5,-468 259.5,-468 259.5,-462 265.5,-456 271.5,-456 271.5,-456 437.5,-456 437.5,-456 443.5,-456 449.5,-462 449.5,-468 449.5,-468 449.5,-482 449.5,-482 449.5,-488 443.5,-494 437.5,-494"/>
<text text-anchor="middle" x="354.5" y="-478.8" font-family="Courier New" font-size="14.00">锁定相关寄存器</text>
<text text-anchor="middle" x="354.5" y="-463.8" font-family="Courier New" font-size="14.00">mat_src_lock/dst_lock</text>
</g>
<!-- materialize_src&#45;&gt;lock_registers -->
<g id="edge7" class="edge">
<title>materialize_src&#45;&gt;lock_registers</title>
<path fill="none" stroke="black" d="M354.5,-530.96C354.5,-522.88 354.5,-513.18 354.5,-504.18"/>
<polygon fill="black" stroke="black" points="358,-504.09 354.5,-494.09 351,-504.09 358,-504.09"/>
</g>
<!-- check_abi_size -->
<g id="node8" class="node">
<title>check_abi_size</title>
<path fill="none" stroke="black" d="M441.5,-419C441.5,-419 267.5,-419 267.5,-419 261.5,-419 255.5,-413 255.5,-407 255.5,-407 255.5,-393 255.5,-393 255.5,-387 261.5,-381 267.5,-381 267.5,-381 441.5,-381 441.5,-381 447.5,-381 453.5,-387 453.5,-393 453.5,-393 453.5,-407 453.5,-407 453.5,-413 447.5,-419 441.5,-419"/>
<text text-anchor="middle" x="354.5" y="-403.8" font-family="Courier New" font-size="14.00">检查abi_size和src_bits</text>
<text text-anchor="middle" x="354.5" y="-388.8" font-family="Courier New" font-size="14.00">if (src_bits &gt; 64/128)</text>
</g>
<!-- lock_registers&#45;&gt;check_abi_size -->
<g id="edge8" class="edge">
<title>lock_registers&#45;&gt;check_abi_size</title>
<path fill="none" stroke="black" d="M354.5,-455.96C354.5,-447.88 354.5,-438.18 354.5,-429.18"/>
<polygon fill="black" stroke="black" points="358,-429.09 354.5,-419.09 351,-429.09 358,-429.09"/>
</g>
<!-- handle_large_bits -->
<g id="node9" class="node">
<title>handle_large_bits</title>
<path fill="none" stroke="black" d="M334,-274C334,-274 155,-274 155,-274 149,-274 143,-268 143,-262 143,-262 143,-233 143,-233 143,-227 149,-221 155,-221 155,-221 334,-221 334,-221 340,-221 346,-227 346,-233 346,-233 346,-262 346,-262 346,-268 340,-274 334,-274"/>
<text text-anchor="middle" x="244.5" y="-258.8" font-family="Courier New" font-size="14.00">处理大位宽（&gt;64/128）情况</text>
<text text-anchor="middle" x="244.5" y="-243.8" font-family="Courier New" font-size="14.00">分配帧地址、循环查找非零块</text>
<text text-anchor="middle" x="244.5" y="-228.8" font-family="Courier New" font-size="14.00">计算最终结果</text>
</g>
<!-- check_abi_size&#45;&gt;handle_large_bits -->
<g id="edge9" class="edge">
<title>check_abi_size&#45;&gt;handle_large_bits</title>
<path fill="none" stroke="black" d="M287.65,-380.91C279.24,-376.23 271.5,-370.36 265.5,-363 247.62,-341.07 243.02,-308.88 242.52,-284.21"/>
<polygon fill="black" stroke="black" points="246.02,-284.16 242.53,-274.15 239.02,-284.15 246.02,-284.16"/>
<text text-anchor="middle" x="336" y="-351.8" font-family="Courier New" font-size="14.00">src_bits &gt; 64/128</text>
</g>
<!-- check_bmi_support -->
<g id="node10" class="node">
<title>check_bmi_support</title>
<path fill="none" stroke="black" d="M564.5,-330C564.5,-330 398.5,-330 398.5,-330 392.5,-330 386.5,-324 386.5,-318 386.5,-318 386.5,-304 386.5,-304 386.5,-298 392.5,-292 398.5,-292 398.5,-292 564.5,-292 564.5,-292 570.5,-292 576.5,-298 576.5,-304 576.5,-304 576.5,-318 576.5,-318 576.5,-324 570.5,-330 564.5,-330"/>
<text text-anchor="middle" x="481.5" y="-314.8" font-family="Courier New" font-size="14.00">检查BMI指令支持</text>
<text text-anchor="middle" x="481.5" y="-299.8" font-family="Courier New" font-size="14.00">if (hasFeature(.bmi))</text>
</g>
<!-- check_abi_size&#45;&gt;check_bmi_support -->
<g id="edge10" class="edge">
<title>check_abi_size&#45;&gt;check_bmi_support</title>
<path fill="none" stroke="black" d="M383.17,-380.97C392,-375.31 401.71,-368.98 410.5,-363 423.12,-354.42 436.79,-344.7 448.73,-336.08"/>
<polygon fill="black" stroke="black" points="451.04,-338.72 457.08,-330.02 446.93,-333.06 451.04,-338.72"/>
<text text-anchor="middle" x="504" y="-351.8" font-family="Courier New" font-size="14.00">src_bits &lt;= 64/128</text>
</g>
<!-- finalize -->
<g id="node14" class="node">
<title>finalize</title>
<path fill="none" stroke="black" d="M379.5,-113C379.5,-113 213.5,-113 213.5,-113 207.5,-113 201.5,-107 201.5,-101 201.5,-101 201.5,-87 201.5,-87 201.5,-81 207.5,-75 213.5,-75 213.5,-75 379.5,-75 379.5,-75 385.5,-75 391.5,-81 391.5,-87 391.5,-87 391.5,-101 391.5,-101 391.5,-107 385.5,-113 379.5,-113"/>
<text text-anchor="middle" x="296.5" y="-97.8" font-family="Courier New" font-size="14.00">生成最终结果</text>
<text text-anchor="middle" x="296.5" y="-82.8" font-family="Courier New" font-size="14.00">break :result dst_mcv</text>
</g>
<!-- handle_large_bits&#45;&gt;finalize -->
<g id="edge11" class="edge">
<title>handle_large_bits&#45;&gt;finalize</title>
<path fill="none" stroke="black" d="M212.28,-220.99C207.48,-215.6 203.23,-209.54 200.5,-203 191.42,-181.26 188.69,-170.38 200.5,-150 208.32,-136.5 220.84,-126.04 234.29,-118.03"/>
<polygon fill="black" stroke="black" points="236.15,-121.01 243.23,-113.12 232.78,-114.87 236.15,-121.01"/>
</g>
<!-- handle_bmi_small -->
<g id="node11" class="node">
<title>handle_bmi_small</title>
<path fill="none" stroke="black" d="M371.5,-203C371.5,-203 221.5,-203 221.5,-203 215.5,-203 209.5,-197 209.5,-191 209.5,-191 209.5,-162 209.5,-162 209.5,-156 215.5,-150 221.5,-150 221.5,-150 371.5,-150 371.5,-150 377.5,-150 383.5,-156 383.5,-162 383.5,-162 383.5,-191 383.5,-191 383.5,-197 377.5,-203 371.5,-203"/>
<text text-anchor="middle" x="296.5" y="-187.8" font-family="Courier New" font-size="14.00">BMI处理小位宽（&lt;=64）</text>
<text text-anchor="middle" x="296.5" y="-172.8" font-family="Courier New" font-size="14.00">使用tzcnt指令</text>
<text text-anchor="middle" x="296.5" y="-157.8" font-family="Courier New" font-size="14.00">处理掩码和计数</text>
</g>
<!-- check_bmi_support&#45;&gt;handle_bmi_small -->
<g id="edge12" class="edge">
<title>check_bmi_support&#45;&gt;handle_bmi_small</title>
<path fill="none" stroke="black" d="M410.46,-291.99C399.41,-287.26 388.65,-281.35 379.5,-274 357.86,-256.63 364.5,-242.12 346.5,-221 343.35,-217.31 339.89,-213.65 336.29,-210.12"/>
<polygon fill="black" stroke="black" points="338.48,-207.37 328.79,-203.08 333.69,-212.48 338.48,-207.37"/>
<text text-anchor="middle" x="430" y="-243.8" font-family="Courier New" font-size="14.00">支持BMI且&lt;=64</text>
</g>
<!-- handle_bmi_large -->
<g id="node12" class="node">
<title>handle_bmi_large</title>
<path fill="none" stroke="black" d="M571.5,-203C571.5,-203 413.5,-203 413.5,-203 407.5,-203 401.5,-197 401.5,-191 401.5,-191 401.5,-162 401.5,-162 401.5,-156 407.5,-150 413.5,-150 413.5,-150 571.5,-150 571.5,-150 577.5,-150 583.5,-156 583.5,-162 583.5,-162 583.5,-191 583.5,-191 583.5,-197 577.5,-203 571.5,-203"/>
<text text-anchor="middle" x="492.5" y="-187.8" font-family="Courier New" font-size="14.00">BMI处理大位宽（&lt;=128）</text>
<text text-anchor="middle" x="492.5" y="-172.8" font-family="Courier New" font-size="14.00">分离高低位寄存器</text>
<text text-anchor="middle" x="492.5" y="-157.8" font-family="Courier New" font-size="14.00">两次tzcnt + 结果合并</text>
</g>
<!-- check_bmi_support&#45;&gt;handle_bmi_large -->
<g id="edge13" class="edge">
<title>check_bmi_support&#45;&gt;handle_bmi_large</title>
<path fill="none" stroke="black" d="M483.01,-291.85C484.68,-271.67 487.43,-238.56 489.54,-213.15"/>
<polygon fill="black" stroke="black" points="493.03,-213.4 490.37,-203.14 486.06,-212.82 493.03,-213.4"/>
<text text-anchor="middle" x="543" y="-243.8" font-family="Courier New" font-size="14.00">支持BMI且&lt;=128</text>
</g>
<!-- handle_non_bmi -->
<g id="node13" class="node">
<title>handle_non_bmi</title>
<path fill="none" stroke="black" d="M803,-195.5C803,-195.5 614,-195.5 614,-195.5 608,-195.5 602,-189.5 602,-183.5 602,-183.5 602,-169.5 602,-169.5 602,-163.5 608,-157.5 614,-157.5 614,-157.5 803,-157.5 803,-157.5 809,-157.5 815,-163.5 815,-169.5 815,-169.5 815,-183.5 815,-183.5 815,-189.5 809,-195.5 803,-195.5"/>
<text text-anchor="middle" x="708.5" y="-180.3" font-family="Courier New" font-size="14.00">无BMI支持处理</text>
<text text-anchor="middle" x="708.5" y="-165.3" font-family="Courier New" font-size="14.00">使用bsf指令 + cmov修正结果</text>
</g>
<!-- check_bmi_support&#45;&gt;handle_non_bmi -->
<g id="edge14" class="edge">
<title>check_bmi_support&#45;&gt;handle_non_bmi</title>
<path fill="none" stroke="black" d="M560.06,-291.9C574.32,-287.11 588.71,-281.2 601.5,-274 634.51,-255.42 665.9,-225.07 686.04,-203.36"/>
<polygon fill="black" stroke="black" points="688.79,-205.54 692.93,-195.79 683.61,-200.83 688.79,-205.54"/>
<text text-anchor="middle" x="702.5" y="-243.8" font-family="Courier New" font-size="14.00">不支持BMI</text>
</g>
<!-- handle_bmi_small&#45;&gt;finalize -->
<g id="edge15" class="edge">
<title>handle_bmi_small&#45;&gt;finalize</title>
<path fill="none" stroke="black" d="M296.5,-149.59C296.5,-141.31 296.5,-132.11 296.5,-123.65"/>
<polygon fill="black" stroke="black" points="300,-123.47 296.5,-113.47 293,-123.47 300,-123.47"/>
</g>
<!-- handle_bmi_large&#45;&gt;finalize -->
<g id="edge16" class="edge">
<title>handle_bmi_large&#45;&gt;finalize</title>
<path fill="none" stroke="black" d="M430.22,-149.92C404.37,-139.3 374.69,-127.11 349.87,-116.92"/>
<polygon fill="black" stroke="black" points="351.19,-113.68 340.61,-113.12 348.53,-120.15 351.19,-113.68"/>
</g>
<!-- handle_non_bmi&#45;&gt;finalize -->
<g id="edge17" class="edge">
<title>handle_non_bmi&#45;&gt;finalize</title>
<path fill="none" stroke="black" d="M628.07,-157.46C616.16,-154.9 604.02,-152.34 592.5,-150 529.32,-137.19 458.3,-123.95 401.67,-113.68"/>
<polygon fill="black" stroke="black" points="402.1,-110.2 391.63,-111.86 400.85,-117.09 402.1,-110.2"/>
</g>
<!-- finalize&#45;&gt;end -->
<g id="edge18" class="edge">
<title>finalize&#45;&gt;end</title>
<path fill="none" stroke="black" d="M257.94,-74.96C236.94,-65.13 210.76,-52.88 188.46,-42.44"/>
<polygon fill="black" stroke="black" points="189.7,-39.16 179.16,-38.09 186.73,-45.5 189.7,-39.16"/>
</g>
</g>
</svg>
