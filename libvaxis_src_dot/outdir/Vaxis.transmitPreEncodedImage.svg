<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: transmitPreEncodedImage Pages: 1 -->
<svg width="798pt" height="755pt"
 viewBox="0.00 0.00 797.80 755.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 751)">
<title>transmitPreEncodedImage</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-751 793.8,-751 793.8,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<polygon fill="none" stroke="black" points="277.3,-747 68.3,-747 68.3,-711 277.3,-711 277.3,-747"/>
<text text-anchor="middle" x="172.8" y="-725.3" font-family="Arial" font-size="14.00">开始 transmitPreEncodedImage</text>
</g>
<!-- check_caps -->
<g id="node2" class="node">
<title>check_caps</title>
<polygon fill="none" stroke="black" points="172.8,-674 0.2,-656 172.8,-638 345.4,-656 172.8,-674"/>
<text text-anchor="middle" x="172.8" y="-652.3" font-family="Arial" font-size="14.00">检查 self.caps.kitty_graphics</text>
</g>
<!-- start&#45;&gt;check_caps -->
<g id="edge1" class="edge">
<title>start&#45;&gt;check_caps</title>
<path fill="none" stroke="black" d="M172.8,-710.81C172.8,-702.79 172.8,-693.05 172.8,-684.07"/>
<polygon fill="black" stroke="black" points="176.3,-684.03 172.8,-674.03 169.3,-684.03 176.3,-684.03"/>
</g>
<!-- error -->
<g id="node3" class="node">
<title>error</title>
<polygon fill="none" stroke="black" points="250.3,-586 39.3,-586 39.3,-550 250.3,-550 250.3,-586"/>
<text text-anchor="middle" x="144.8" y="-564.3" font-family="Arial" font-size="14.00">返回 error.NoGraphicsCapability</text>
</g>
<!-- check_caps&#45;&gt;error -->
<g id="edge2" class="edge">
<title>check_caps&#45;&gt;error</title>
<path fill="none" stroke="black" d="M167.4,-638.42C163.46,-626.32 158.04,-609.67 153.5,-595.71"/>
<polygon fill="black" stroke="black" points="156.8,-594.54 150.38,-586.12 150.14,-596.71 156.8,-594.54"/>
<text text-anchor="middle" x="169.3" y="-608.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- increment_id -->
<g id="node4" class="node">
<title>increment_id</title>
<polygon fill="none" stroke="black" points="467.3,-587 286.3,-587 286.3,-549 467.3,-549 467.3,-587"/>
<text text-anchor="middle" x="376.8" y="-571.8" font-family="Arial" font-size="14.00">defer self.next_img_id += 1</text>
<text text-anchor="middle" x="376.8" y="-556.8" font-family="Arial" font-size="14.00">获取 id = self.next_img_id</text>
</g>
<!-- check_caps&#45;&gt;increment_id -->
<g id="edge3" class="edge">
<title>check_caps&#45;&gt;increment_id</title>
<path fill="none" stroke="black" d="M205.58,-641.18C237.66,-627.66 287.05,-606.84 324.55,-591.03"/>
<polygon fill="black" stroke="black" points="325.95,-594.23 333.81,-587.12 323.23,-587.78 325.95,-594.23"/>
<text text-anchor="middle" x="295.3" y="-608.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- determine_fmt -->
<g id="node5" class="node">
<title>determine_fmt</title>
<polygon fill="none" stroke="black" points="479.3,-512 274.3,-512 274.3,-474 479.3,-474 479.3,-512"/>
<text text-anchor="middle" x="376.8" y="-496.8" font-family="Arial" font-size="14.00">根据 format 确定 fmt 值</text>
<text text-anchor="middle" x="376.8" y="-481.8" font-family="Arial" font-size="14.00">(rgb→24, rgba→32, png→100)</text>
</g>
<!-- increment_id&#45;&gt;determine_fmt -->
<g id="edge4" class="edge">
<title>increment_id&#45;&gt;determine_fmt</title>
<path fill="none" stroke="black" d="M376.8,-548.96C376.8,-540.88 376.8,-531.18 376.8,-522.18"/>
<polygon fill="black" stroke="black" points="380.3,-522.09 376.8,-512.09 373.3,-522.09 380.3,-522.09"/>
</g>
<!-- check_bytes_len -->
<g id="node6" class="node">
<title>check_bytes_len</title>
<polygon fill="none" stroke="black" points="376.8,-437 240.73,-419 376.8,-401 512.87,-419 376.8,-437"/>
<text text-anchor="middle" x="376.8" y="-415.3" font-family="Arial" font-size="14.00">检查 bytes.len &lt; 4096</text>
</g>
<!-- determine_fmt&#45;&gt;check_bytes_len -->
<g id="edge5" class="edge">
<title>determine_fmt&#45;&gt;check_bytes_len</title>
<path fill="none" stroke="black" d="M376.8,-473.83C376.8,-465.89 376.8,-456.41 376.8,-447.63"/>
<polygon fill="black" stroke="black" points="380.3,-447.42 376.8,-437.42 373.3,-447.42 380.3,-447.42"/>
</g>
<!-- small_data -->
<g id="node7" class="node">
<title>small_data</title>
<polygon fill="none" stroke="black" points="385.8,-294 251.8,-294 251.8,-256 385.8,-256 385.8,-294"/>
<text text-anchor="middle" x="318.8" y="-278.8" font-family="Arial" font-size="14.00">发送单帧数据:</text>
<text text-anchor="middle" x="318.8" y="-263.8" font-family="Arial" font-size="14.00">tty.print(...;{s}\x1b\&quot;)</text>
</g>
<!-- check_bytes_len&#45;&gt;small_data -->
<g id="edge6" class="edge">
<title>check_bytes_len&#45;&gt;small_data</title>
<path fill="none" stroke="black" d="M370.15,-401.71C360.41,-377.86 342.13,-333.11 330.21,-303.94"/>
<polygon fill="black" stroke="black" points="333.31,-302.27 326.29,-294.33 326.83,-304.91 333.31,-302.27"/>
<text text-anchor="middle" x="370.3" y="-371.8" font-family="Arial" font-size="14.00">是</text>
</g>
<!-- large_data -->
<g id="node8" class="node">
<title>large_data</title>
<polygon fill="none" stroke="black" points="562.3,-350 419.3,-350 419.3,-312 562.3,-312 562.3,-350"/>
<text text-anchor="middle" x="490.8" y="-334.8" font-family="Arial" font-size="14.00">初始化 n=4096</text>
<text text-anchor="middle" x="490.8" y="-319.8" font-family="Arial" font-size="14.00">发送首帧数据 (m=1)</text>
</g>
<!-- check_bytes_len&#45;&gt;large_data -->
<g id="edge7" class="edge">
<title>check_bytes_len&#45;&gt;large_data</title>
<path fill="none" stroke="black" d="M396.14,-403.41C413.22,-390.52 438.48,-371.47 458.61,-356.29"/>
<polygon fill="black" stroke="black" points="460.73,-359.07 466.6,-350.26 456.51,-353.48 460.73,-359.07"/>
<text text-anchor="middle" x="448.3" y="-371.8" font-family="Arial" font-size="14.00">否</text>
</g>
<!-- return_img -->
<g id="node12" class="node">
<title>return_img</title>
<polygon fill="none" stroke="black" points="464.3,-38 331.3,-38 331.3,0 464.3,0 464.3,-38"/>
<text text-anchor="middle" x="397.8" y="-22.8" font-family="Arial" font-size="14.00">返回 Image 结构体</text>
<text text-anchor="middle" x="397.8" y="-7.8" font-family="Arial" font-size="14.00">{id, width, height}</text>
</g>
<!-- small_data&#45;&gt;return_img -->
<g id="edge8" class="edge">
<title>small_data&#45;&gt;return_img</title>
<path fill="none" stroke="black" d="M309.81,-255.92C293.96,-221.29 265.37,-144.14 294.8,-89 305.43,-69.08 324.64,-53.9 343.62,-42.92"/>
<polygon fill="black" stroke="black" points="345.49,-45.89 352.58,-38.02 342.13,-39.75 345.49,-45.89"/>
</g>
<!-- loop_start -->
<g id="node9" class="node">
<title>loop_start</title>
<polygon fill="none" stroke="black" points="563.8,-238 449.8,-238 449.8,-202 563.8,-202 563.8,-238"/>
<text text-anchor="middle" x="506.8" y="-216.3" font-family="Arial" font-size="14.00">循环: n += 4096</text>
</g>
<!-- large_data&#45;&gt;loop_start -->
<g id="edge9" class="edge">
<title>large_data&#45;&gt;loop_start</title>
<path fill="none" stroke="black" d="M493.52,-311.51C496.07,-294.11 499.93,-267.84 502.83,-248.08"/>
<polygon fill="black" stroke="black" points="506.3,-248.54 504.29,-238.14 499.37,-247.53 506.3,-248.54"/>
</g>
<!-- check_end -->
<g id="node10" class="node">
<title>check_end</title>
<polygon fill="none" stroke="black" points="506.8,-165 312.8,-127 506.8,-89 700.8,-127 506.8,-165"/>
<text text-anchor="middle" x="506.8" y="-130.8" font-family="Arial" font-size="14.00">end = min(n+4096, bytes.len)</text>
<text text-anchor="middle" x="506.8" y="-115.8" font-family="Arial" font-size="14.00">m = (end==bytes.len)?0:1</text>
</g>
<!-- loop_start&#45;&gt;check_end -->
<g id="edge10" class="edge">
<title>loop_start&#45;&gt;check_end</title>
<path fill="none" stroke="black" d="M506.8,-201.88C506.8,-194.25 506.8,-184.83 506.8,-175.31"/>
<polygon fill="black" stroke="black" points="510.3,-175.02 506.8,-165.02 503.3,-175.02 510.3,-175.02"/>
</g>
<!-- send_chunk -->
<g id="node11" class="node">
<title>send_chunk</title>
<polygon fill="none" stroke="black" points="698.3,-38 531.3,-38 531.3,0 698.3,0 698.3,-38"/>
<text text-anchor="middle" x="614.8" y="-22.8" font-family="Arial" font-size="14.00">发送分块数据:</text>
<text text-anchor="middle" x="614.8" y="-7.8" font-family="Arial" font-size="14.00">tty.print(...m={d};...\x1b\&quot;)</text>
</g>
<!-- check_end&#45;&gt;send_chunk -->
<g id="edge11" class="edge">
<title>check_end&#45;&gt;send_chunk</title>
<path fill="none" stroke="black" d="M538.33,-95.06C554.34,-79.34 573.56,-60.48 588.73,-45.59"/>
<polygon fill="black" stroke="black" points="591.56,-47.71 596.25,-38.21 586.66,-42.71 591.56,-47.71"/>
<text text-anchor="middle" x="614.8" y="-59.8" font-family="Arial" font-size="14.00">n &lt; bytes.len</text>
</g>
<!-- check_end&#45;&gt;return_img -->
<g id="edge13" class="edge">
<title>check_end&#45;&gt;return_img</title>
<path fill="none" stroke="black" d="M474.98,-95.06C458.67,-79.2 439.07,-60.13 423.7,-45.18"/>
<polygon fill="black" stroke="black" points="426.13,-42.67 416.52,-38.21 421.25,-47.69 426.13,-42.67"/>
<text text-anchor="middle" x="492.8" y="-59.8" font-family="Arial" font-size="14.00">n &gt;= bytes.len</text>
</g>
<!-- send_chunk&#45;&gt;loop_start -->
<g id="edge12" class="edge">
<title>send_chunk&#45;&gt;loop_start</title>
<path fill="none" stroke="black" d="M660.72,-38.05C682.49,-49.22 706.4,-65.9 718.8,-89 734.77,-118.76 739.53,-138.33 718.8,-165 701.03,-187.87 629.19,-202.65 574.02,-210.87"/>
<polygon fill="black" stroke="black" points="573.32,-207.44 563.92,-212.33 574.32,-214.36 573.32,-207.44"/>
<text text-anchor="middle" x="760.8" y="-123.3" font-family="Arial" font-size="14.00">继续循环</text>
</g>
</g>
</svg>
