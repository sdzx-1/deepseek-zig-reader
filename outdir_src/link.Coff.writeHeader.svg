<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: flowchart Pages: 1 -->
<svg width="378pt" height="1124pt"
 viewBox="0.00 0.00 377.50 1124.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1120)">
<title>flowchart</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1120 373.5,-1120 373.5,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<path fill="none" stroke="black" d="M233.25,-1116C233.25,-1116 136.25,-1116 136.25,-1116 130.25,-1116 124.25,-1110 124.25,-1104 124.25,-1104 124.25,-1092 124.25,-1092 124.25,-1086 130.25,-1080 136.25,-1080 136.25,-1080 233.25,-1080 233.25,-1080 239.25,-1080 245.25,-1086 245.25,-1092 245.25,-1092 245.25,-1104 245.25,-1104 245.25,-1110 239.25,-1116 233.25,-1116"/>
<text text-anchor="middle" x="184.75" y="-1094.3" font-family="Arial" font-size="14.00">开始 writeHeader</text>
</g>
<!-- init_vars -->
<g id="node2" class="node">
<title>init_vars</title>
<path fill="none" stroke="black" d="M258.25,-1043C258.25,-1043 111.25,-1043 111.25,-1043 105.25,-1043 99.25,-1037 99.25,-1031 99.25,-1031 99.25,-1017 99.25,-1017 99.25,-1011 105.25,-1005 111.25,-1005 111.25,-1005 258.25,-1005 258.25,-1005 264.25,-1005 270.25,-1011 270.25,-1017 270.25,-1017 270.25,-1031 270.25,-1031 270.25,-1037 264.25,-1043 258.25,-1043"/>
<text text-anchor="middle" x="184.75" y="-1027.8" font-family="Arial" font-size="14.00">初始化变量:</text>
<text text-anchor="middle" x="184.75" y="-1012.8" font-family="Arial" font-size="14.00">&#45; target, gpa, buffer, writer</text>
</g>
<!-- start&#45;&gt;init_vars -->
<g id="edge1" class="edge">
<title>start&#45;&gt;init_vars</title>
<path fill="none" stroke="black" d="M184.75,-1079.94C184.75,-1071.99 184.75,-1062.31 184.75,-1053.31"/>
<polygon fill="black" stroke="black" points="188.25,-1053.2 184.75,-1043.2 181.25,-1053.2 188.25,-1053.2"/>
</g>
<!-- ensure_capacity -->
<g id="node3" class="node">
<title>ensure_capacity</title>
<path fill="none" stroke="black" d="M265.25,-968C265.25,-968 104.25,-968 104.25,-968 98.25,-968 92.25,-962 92.25,-956 92.25,-956 92.25,-942 92.25,-942 92.25,-936 98.25,-930 104.25,-930 104.25,-930 265.25,-930 265.25,-930 271.25,-930 277.25,-936 277.25,-942 277.25,-942 277.25,-956 277.25,-956 277.25,-962 271.25,-968 265.25,-968"/>
<text text-anchor="middle" x="184.75" y="-952.8" font-family="Arial" font-size="14.00">确保 buffer 容量</text>
<text text-anchor="middle" x="184.75" y="-937.8" font-family="Arial" font-size="14.00">(buffer.ensureTotalCapacity)</text>
</g>
<!-- init_vars&#45;&gt;ensure_capacity -->
<g id="edge2" class="edge">
<title>init_vars&#45;&gt;ensure_capacity</title>
<path fill="none" stroke="black" d="M184.75,-1004.96C184.75,-996.88 184.75,-987.18 184.75,-978.18"/>
<polygon fill="black" stroke="black" points="188.25,-978.09 184.75,-968.09 181.25,-978.09 188.25,-978.09"/>
</g>
<!-- write_msdos -->
<g id="node4" class="node">
<title>write_msdos</title>
<path fill="none" stroke="black" d="M239.25,-893C239.25,-893 130.25,-893 130.25,-893 124.25,-893 118.25,-887 118.25,-881 118.25,-881 118.25,-867 118.25,-867 118.25,-861 124.25,-855 130.25,-855 130.25,-855 239.25,-855 239.25,-855 245.25,-855 251.25,-861 251.25,-867 251.25,-867 251.25,-881 251.25,-881 251.25,-887 245.25,-893 239.25,-893"/>
<text text-anchor="middle" x="184.75" y="-877.8" font-family="Arial" font-size="14.00">写入 MS&#45;DOS stub</text>
<text text-anchor="middle" x="184.75" y="-862.8" font-family="Arial" font-size="14.00">并设置 PE 头偏移</text>
</g>
<!-- ensure_capacity&#45;&gt;write_msdos -->
<g id="edge3" class="edge">
<title>ensure_capacity&#45;&gt;write_msdos</title>
<path fill="none" stroke="black" d="M184.75,-929.96C184.75,-921.88 184.75,-912.18 184.75,-903.18"/>
<polygon fill="black" stroke="black" points="188.25,-903.09 184.75,-893.09 181.25,-903.09 188.25,-903.09"/>
</g>
<!-- write_pe_sig -->
<g id="node5" class="node">
<title>write_pe_sig</title>
<path fill="none" stroke="black" d="M250.75,-818C250.75,-818 118.75,-818 118.75,-818 112.75,-818 106.75,-812 106.75,-806 106.75,-806 106.75,-794 106.75,-794 106.75,-788 112.75,-782 118.75,-782 118.75,-782 250.75,-782 250.75,-782 256.75,-782 262.75,-788 262.75,-794 262.75,-794 262.75,-806 262.75,-806 262.75,-812 256.75,-818 250.75,-818"/>
<text text-anchor="middle" x="184.75" y="-796.3" font-family="Arial" font-size="14.00">写入 &#39;PE\x00\x00&#39; 签名</text>
</g>
<!-- write_msdos&#45;&gt;write_pe_sig -->
<g id="edge4" class="edge">
<title>write_msdos&#45;&gt;write_pe_sig</title>
<path fill="none" stroke="black" d="M184.75,-854.83C184.75,-846.89 184.75,-837.41 184.75,-828.63"/>
<polygon fill="black" stroke="black" points="188.25,-828.42 184.75,-818.42 181.25,-828.42 188.25,-828.42"/>
</g>
<!-- set_flags -->
<g id="node6" class="node">
<title>set_flags</title>
<path fill="none" stroke="black" d="M325.75,-745C325.75,-745 43.75,-745 43.75,-745 37.75,-745 31.75,-739 31.75,-733 31.75,-733 31.75,-689 31.75,-689 31.75,-683 37.75,-677 43.75,-677 43.75,-677 325.75,-677 325.75,-677 331.75,-677 337.75,-683 337.75,-689 337.75,-689 337.75,-733 337.75,-733 337.75,-739 331.75,-745 325.75,-745"/>
<text text-anchor="middle" x="184.75" y="-729.8" font-family="Arial" font-size="14.00">设置 COFF 头标志:</text>
<text text-anchor="middle" x="184.75" y="-714.8" font-family="Arial" font-size="14.00">&#45; EXECUTABLE_IMAGE</text>
<text text-anchor="middle" x="184.75" y="-699.8" font-family="Arial" font-size="14.00">&#45; DEBUG_STRIPPED</text>
<text text-anchor="middle" x="184.75" y="-684.8" font-family="Arial" font-size="14.00">&#45; 根据 ptr_width 设置 32BIT/LARGE_ADDRESS</text>
</g>
<!-- write_pe_sig&#45;&gt;set_flags -->
<g id="edge5" class="edge">
<title>write_pe_sig&#45;&gt;set_flags</title>
<path fill="none" stroke="black" d="M184.75,-781.81C184.75,-774.1 184.75,-764.63 184.75,-755.17"/>
<polygon fill="black" stroke="black" points="188.25,-755 184.75,-745 181.25,-755 188.25,-755"/>
</g>
<!-- check_dll -->
<g id="node7" class="node">
<title>check_dll</title>
<path fill="none" stroke="black" d="M173.14,-636.96C173.14,-636.96 51.36,-605.04 51.36,-605.04 45.55,-603.52 45.55,-600.48 51.36,-598.96 51.36,-598.96 173.14,-567.04 173.14,-567.04 178.95,-565.52 190.55,-565.52 196.36,-567.04 196.36,-567.04 318.14,-598.96 318.14,-598.96 323.95,-600.48 323.95,-603.52 318.14,-605.04 318.14,-605.04 196.36,-636.96 196.36,-636.96 190.55,-638.48 178.95,-638.48 173.14,-636.96"/>
<text text-anchor="middle" x="184.75" y="-605.8" font-family="Arial" font-size="14.00">检查是否动态链接库</text>
<text text-anchor="middle" x="184.75" y="-590.8" font-family="Arial" font-size="14.00">设置 DLL 标志</text>
</g>
<!-- set_flags&#45;&gt;check_dll -->
<g id="edge6" class="edge">
<title>set_flags&#45;&gt;check_dll</title>
<path fill="none" stroke="black" d="M184.75,-676.73C184.75,-668.44 184.75,-659.39 184.75,-650.56"/>
<polygon fill="black" stroke="black" points="188.25,-650.35 184.75,-640.35 181.25,-650.35 188.25,-650.35"/>
</g>
<!-- build_coff_header -->
<g id="node8" class="node">
<title>build_coff_header</title>
<path fill="none" stroke="black" d="M245.75,-513C245.75,-513 123.75,-513 123.75,-513 117.75,-513 111.75,-507 111.75,-501 111.75,-501 111.75,-427 111.75,-427 111.75,-421 117.75,-415 123.75,-415 123.75,-415 245.75,-415 245.75,-415 251.75,-415 257.75,-421 257.75,-427 257.75,-427 257.75,-501 257.75,-501 257.75,-507 251.75,-513 245.75,-513"/>
<text text-anchor="middle" x="184.75" y="-497.8" font-family="Arial" font-size="14.00">构建 COFF 头结构:</text>
<text text-anchor="middle" x="184.75" y="-482.8" font-family="Arial" font-size="14.00">&#45; machine</text>
<text text-anchor="middle" x="184.75" y="-467.8" font-family="Arial" font-size="14.00">&#45; sections count</text>
<text text-anchor="middle" x="184.75" y="-452.8" font-family="Arial" font-size="14.00">&#45; timestamp</text>
<text text-anchor="middle" x="184.75" y="-437.8" font-family="Arial" font-size="14.00">&#45; symbol table</text>
<text text-anchor="middle" x="184.75" y="-422.8" font-family="Arial" font-size="14.00">&#45; optional header size</text>
</g>
<!-- check_dll&#45;&gt;build_coff_header -->
<g id="edge7" class="edge">
<title>check_dll&#45;&gt;build_coff_header</title>
<path fill="none" stroke="black" d="M146.94,-573.77C135.03,-561.69 126.24,-546.67 131.75,-531 132.79,-528.05 134.02,-525.13 135.41,-522.25"/>
<polygon fill="black" stroke="black" points="138.6,-523.73 140.32,-513.27 132.46,-520.37 138.6,-523.73"/>
<text text-anchor="middle" x="174.75" y="-534.8" font-family="Arial" font-size="14.00">是动态链接库</text>
</g>
<!-- check_dll&#45;&gt;build_coff_header -->
<g id="edge8" class="edge">
<title>check_dll&#45;&gt;build_coff_header</title>
<path fill="none" stroke="black" d="M207.4,-569.76C211.67,-562.32 215.49,-554.16 217.75,-546 219.84,-538.47 219.75,-530.7 218.28,-523.08"/>
<polygon fill="black" stroke="black" points="221.6,-521.94 215.62,-513.19 214.84,-523.75 221.6,-521.94"/>
<text text-anchor="middle" x="268.75" y="-534.8" font-family="Arial" font-size="14.00">不是动态链接库</text>
</g>
<!-- calc_section_sizes -->
<g id="node9" class="node">
<title>calc_section_sizes</title>
<path fill="none" stroke="black" d="M262.25,-378C262.25,-378 107.25,-378 107.25,-378 101.25,-378 95.25,-372 95.25,-366 95.25,-366 95.25,-322 95.25,-322 95.25,-316 101.25,-310 107.25,-310 107.25,-310 262.25,-310 262.25,-310 268.25,-310 274.25,-316 274.25,-322 274.25,-322 274.25,-366 274.25,-366 274.25,-372 268.25,-378 262.25,-378"/>
<text text-anchor="middle" x="184.75" y="-362.8" font-family="Arial" font-size="14.00">计算各节大小:</text>
<text text-anchor="middle" x="184.75" y="-347.8" font-family="Arial" font-size="14.00">&#45; size_of_code</text>
<text text-anchor="middle" x="184.75" y="-332.8" font-family="Arial" font-size="14.00">&#45; size_of_initialized_data</text>
<text text-anchor="middle" x="184.75" y="-317.8" font-family="Arial" font-size="14.00">&#45; size_of_uninitialized_data</text>
</g>
<!-- build_coff_header&#45;&gt;calc_section_sizes -->
<g id="edge9" class="edge">
<title>build_coff_header&#45;&gt;calc_section_sizes</title>
<path fill="none" stroke="black" d="M184.75,-414.66C184.75,-405.98 184.75,-396.97 184.75,-388.43"/>
<polygon fill="black" stroke="black" points="188.25,-388.3 184.75,-378.3 181.25,-388.3 188.25,-388.3"/>
</g>
<!-- ptr_width_check -->
<g id="node10" class="node">
<title>ptr_width_check</title>
<path fill="none" stroke="black" d="M172.81,-271.83C172.81,-271.83 12.19,-256.17 12.19,-256.17 6.22,-255.58 6.22,-254.42 12.19,-253.83 12.19,-253.83 172.81,-238.17 172.81,-238.17 178.78,-237.58 190.72,-237.58 196.69,-238.17 196.69,-238.17 357.31,-253.83 357.31,-253.83 363.28,-254.42 363.28,-255.58 357.31,-256.17 357.31,-256.17 196.69,-271.83 196.69,-271.83 190.72,-272.42 178.78,-272.42 172.81,-271.83"/>
<text text-anchor="middle" x="184.75" y="-251.3" font-family="Arial" font-size="14.00">ptr_width 是 32位 还是 64位？</text>
</g>
<!-- calc_section_sizes&#45;&gt;ptr_width_check -->
<g id="edge10" class="edge">
<title>calc_section_sizes&#45;&gt;ptr_width_check</title>
<path fill="none" stroke="black" d="M184.75,-309.61C184.75,-300.85 184.75,-291.51 184.75,-283.12"/>
<polygon fill="black" stroke="black" points="188.25,-283.12 184.75,-273.12 181.25,-283.12 188.25,-283.12"/>
</g>
<!-- build_pe32_header -->
<g id="node11" class="node">
<title>build_pe32_header</title>
<path fill="none" stroke="black" d="M164.75,-186C164.75,-186 60.75,-186 60.75,-186 54.75,-186 48.75,-180 48.75,-174 48.75,-174 48.75,-160 48.75,-160 48.75,-154 54.75,-148 60.75,-148 60.75,-148 164.75,-148 164.75,-148 170.75,-148 176.75,-154 176.75,-160 176.75,-160 176.75,-174 176.75,-174 176.75,-180 170.75,-186 164.75,-186"/>
<text text-anchor="middle" x="112.75" y="-170.8" font-family="Arial" font-size="14.00">构建 PE32 可选头</text>
<text text-anchor="middle" x="112.75" y="-155.8" font-family="Arial" font-size="14.00">并写入 buffer</text>
</g>
<!-- ptr_width_check&#45;&gt;build_pe32_header -->
<g id="edge11" class="edge">
<title>ptr_width_check&#45;&gt;build_pe32_header</title>
<path fill="none" stroke="black" d="M171.54,-238.23C161.23,-225.9 146.67,-208.51 134.62,-194.12"/>
<polygon fill="black" stroke="black" points="136.97,-191.48 127.87,-186.05 131.6,-195.97 136.97,-191.48"/>
<text text-anchor="middle" x="170.75" y="-207.8" font-family="Arial" font-size="14.00">32位</text>
</g>
<!-- build_pe64_header -->
<g id="node12" class="node">
<title>build_pe64_header</title>
<path fill="none" stroke="black" d="M310.75,-186C310.75,-186 206.75,-186 206.75,-186 200.75,-186 194.75,-180 194.75,-174 194.75,-174 194.75,-160 194.75,-160 194.75,-154 200.75,-148 206.75,-148 206.75,-148 310.75,-148 310.75,-148 316.75,-148 322.75,-154 322.75,-160 322.75,-160 322.75,-174 322.75,-174 322.75,-180 316.75,-186 310.75,-186"/>
<text text-anchor="middle" x="258.75" y="-170.8" font-family="Arial" font-size="14.00">构建 PE64 可选头</text>
<text text-anchor="middle" x="258.75" y="-155.8" font-family="Arial" font-size="14.00">并写入 buffer</text>
</g>
<!-- ptr_width_check&#45;&gt;build_pe64_header -->
<g id="edge12" class="edge">
<title>ptr_width_check&#45;&gt;build_pe64_header</title>
<path fill="none" stroke="black" d="M198.32,-238.23C209.03,-225.79 224.17,-208.19 236.62,-193.72"/>
<polygon fill="black" stroke="black" points="239.35,-195.92 243.22,-186.05 234.04,-191.35 239.35,-195.92"/>
<text text-anchor="middle" x="240.75" y="-207.8" font-family="Arial" font-size="14.00">64位</text>
</g>
<!-- write_to_file -->
<g id="node13" class="node">
<title>write_to_file</title>
<path fill="none" stroke="black" d="M251.75,-111C251.75,-111 117.75,-111 117.75,-111 111.75,-111 105.75,-105 105.75,-99 105.75,-99 105.75,-85 105.75,-85 105.75,-79 111.75,-73 117.75,-73 117.75,-73 251.75,-73 251.75,-73 257.75,-73 263.75,-79 263.75,-85 263.75,-85 263.75,-99 263.75,-99 263.75,-105 257.75,-111 251.75,-111"/>
<text text-anchor="middle" x="184.75" y="-95.8" font-family="Arial" font-size="14.00">将 buffer 内容写入文件</text>
<text text-anchor="middle" x="184.75" y="-80.8" font-family="Arial" font-size="14.00">(coff.pwriteAll)</text>
</g>
<!-- build_pe32_header&#45;&gt;write_to_file -->
<g id="edge13" class="edge">
<title>build_pe32_header&#45;&gt;write_to_file</title>
<path fill="none" stroke="black" d="M130.55,-147.96C139.38,-139.01 150.18,-128.05 159.82,-118.28"/>
<polygon fill="black" stroke="black" points="162.38,-120.67 166.91,-111.09 157.39,-115.75 162.38,-120.67"/>
</g>
<!-- build_pe64_header&#45;&gt;write_to_file -->
<g id="edge14" class="edge">
<title>build_pe64_header&#45;&gt;write_to_file</title>
<path fill="none" stroke="black" d="M240.46,-147.96C231.39,-139.01 220.28,-128.05 210.37,-118.28"/>
<polygon fill="black" stroke="black" points="212.67,-115.62 203.09,-111.09 207.75,-120.6 212.67,-115.62"/>
</g>
<!-- end -->
<g id="node14" class="node">
<title>end</title>
<path fill="none" stroke="black" d="M199.75,-36C199.75,-36 169.75,-36 169.75,-36 163.75,-36 157.75,-30 157.75,-24 157.75,-24 157.75,-12 157.75,-12 157.75,-6 163.75,0 169.75,0 169.75,0 199.75,0 199.75,0 205.75,0 211.75,-6 211.75,-12 211.75,-12 211.75,-24 211.75,-24 211.75,-30 205.75,-36 199.75,-36"/>
<text text-anchor="middle" x="184.75" y="-14.3" font-family="Arial" font-size="14.00">结束</text>
</g>
<!-- write_to_file&#45;&gt;end -->
<g id="edge15" class="edge">
<title>write_to_file&#45;&gt;end</title>
<path fill="none" stroke="black" d="M184.75,-72.83C184.75,-64.89 184.75,-55.41 184.75,-46.63"/>
<polygon fill="black" stroke="black" points="188.25,-46.42 184.75,-36.42 181.25,-46.42 188.25,-46.42"/>
</g>
</g>
</svg>
